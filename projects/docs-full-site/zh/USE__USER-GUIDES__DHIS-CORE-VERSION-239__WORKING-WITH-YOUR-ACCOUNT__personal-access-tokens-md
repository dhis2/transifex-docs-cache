---
edit_url: "https://github.com/dhis2/dhis2-docs/blob/2.39/src/user/personal-access-tokens.md"
revision_date: '2022-03-21'
tags:
- 使用
- DHIS 核心 2.39 版
---

# 个人访问令牌{ #personal_access_tokens }

## 关于个人访问令牌{ #about-personal-access-tokens } 

个人访问令牌 (PAT) 是使用 API 时对 DHIS2 进行身份验证的密码替代方法。
个人访问令牌（PAT）是在使用 API 时对 DHIS2 进行身份验证的一种替代方式。

PAT 可作为 HTTP 基本身份验证的一种更安全的替代方式、
在创建新应用程序/脚本等时，PAT 应该是您的首选。

HTTP 基本身份验证被认为是不安全的，原因包括
它会以明文发送用户名和密码。在
在未来的 DHIS2 版本中可能会被弃用或改为选择启用，这意味着基本身份验证需要在配置中明确启用。
需要在配置中明确启用。

#### 重要的安全问题！ { #important-security-concerns } 

您的 PAT 将自动继承用户拥有的所有权限和授权。
用户拥有的所有权限和授权。因此，根据您打算使用令牌的方式，限制授予令牌的访问权限极为重要。
请参阅 **配置您的令牌**。

> **注意事项** 
> 
> 如果您只想让令牌访问服务器的某一特定部分，建议您创建一个新的特殊用户。
> 服务器，建议创建一个新的特殊用户，并只为其分配
> 如果您只想让令牌访问服务器的特定部分，建议您创建一个新的特殊用户，并只分配给它您想让它访问的角色/权限。


## 服务器/脚本和浏览器上下文{ #serverscript-and-browser-contexts } 

使用用户配置文件应用程序创建 PAT 时，系统会提示您选择
令牌的使用环境。

虽然这两种上下文都允许您指定令牌的过期日期和允许的 HTTP
方法，但它们提供的附加限制有所不同。

### 服务器/脚本上下文{ #serverscript-context } 

服务器/脚本上下文适用于 DHIS2 实例不会被浏览器访问的用例，如集成和脚本。
的使用情况，如集成和脚本。

As well as allowing you to set token expiration and allowed HTTP methods, in
this context you are able to restrict the set of IP addresses from which this
token may be used. For example, if you restrict your token to the IP address
`91.242.200.159` and a malicious party obtains your token and attempts to use it
from IP address `142.250.187.206`, your DHIS2 instance will reject these
malicious requests.

> **Important**
> 
> IP address validation relies on the `X-Forwarded-For` header, which can be spoofed.
> For security, make sure a load balancer or reverse proxy overwrites this header.

### 浏览器上下文{ #browser-context } 

浏览器上下文适用于 DHIS2 实例将由网络浏览器访问的使用情况
浏览器访问您的 DHIS2 实例的使用情况，如公共门户网站和其他公共访问应用程序。
应用。

除了可以设置令牌有效期和允许的 HTTP 方法外，在这种情况下
在这种情况下，你还可以限制嵌入令牌的网站。
嵌入的网站。这种限制是通过[HTTP 引用
标头](https://en.wikipedia.org/wiki/HTTP_referer) 来实现这一限制。

> **Important**
> 
> This is not a security feature. The `referer` header can easily be spoofed.
> This setting is intended to discourage unauthorized third-party developers from connecting
> to public access instances.


## 使用案例{ #use-cases } 

当外部服务和集成必须与 DHIS2 实例进行安全通信时，PAT 非常有用。
与您的 DHIS2 实例进行安全通信的情况下非常有用。由于令牌继承了
的权限，因此您可以确保您的集成只能
读取和修改相关数据。

PAT 也是 HTTP 基本身份验证的一种更安全的替代方法，在创建新应用程序/脚本等时应作为首选。
是创建新应用程序/脚本等时的首选。


## 安全考虑{ #security-considerations } 

### 像对待密码一样对待您的 PAT{ #treat-your-pats-like-passwords } 

像对待密码一样对待令牌，并对其保密。如果您认为令牌
已泄露或被盗，请立即撤销。

如果可能，请将标记作为环境变量传递给您的脚本和应用程序
而不是硬编码。

### 在某些情况下可以绕过 IP 地址验证{ #ip-address-validation-can-be-bypassed-in-some-cases } 

IP address restrictions for server context tokens rely on the
`X-Forwarded-For` header, which can be spoofed. To prevent spoofing, configure
your load balancer or reverse proxy to overwrite this header.

### The `referer` header is not a security feature { #the-referer-header-is-not-a-security-feature } 

虽然浏览器上下文标记的引用源限制在限制滥用方面很有用
滥用，但 `referer` 标头可以被欺骗。请勿依赖参考源限制
因为 `referer` 标头不是一种安全功能。


## 创建 PAT{ #creating-pats } 

个人访问令牌通过用户配置文件应用程序创建。

1. 使用用户名和密码登录，进入个人资料页面。用户
   点击右上角的用户头像可进入个人资料应用程序
   角，然后从下拉菜单中选择 "编辑个人资料"。

   ![](resources/images/personal_access_tokens/user_profile.png)
2. 从左侧导航侧边栏选择 "个人访问令牌

   ![](resources/images/personal_access_tokens/manage_tokens.png)
3. 点击 "生成新令牌 "按钮，弹出新令牌窗口

   ![](resources/images/personal_access_tokens/contexts.png)
4. 为新标记选择合适的语境
5. 为令牌输入适当的失效日期
6. 可选择配置令牌的特定上下文限制（IP
   服务器上下文中的地址或浏览器上下文中的引用地址）。
7. 可选择在使用令牌时，令牌应能访问哪些 HTTP 方法。
   实例的 REST API
8. 点击 "生成新令牌 "按钮
9. 您的令牌只会生成并向您显示一次，因此，重要的是
   现在就复制令牌密钥，并将其保存在安全的地方，以备日后使用。

   ![](resources/images/personal_access_tokens/new_token.png)

> **Important**
> 
> This generated secret token key will only be shown once, so it is important
> that you copy the token key now and save it in a secure place for use later.
> The secret token key will be securely hashed on the server, and only the hash of this secret token
> key will be saved to the database. This is done to minimize the security impact if someone gets
> unauthorized access to the database, similar to the way passwords are handled.

### 服务器上下文{ #server-context } 

服务器上下文的令牌可以限制使用这些令牌的 IP 地址。

这些 IP 地址可在 "允许的 IP 地址 "输入区中提供、
每行一个地址。

### 浏览器上下文{ #browser-context } 

浏览器上下文的标记可限制可使用这些标记的网页。

这些 URL 可在 "允许的推荐人 "输入区中提供，每行一个 URL
每行一个。


## 使用 PAT{ #using-pats } 

要使用新创建的令牌发出请求，请相应地使用授权标头
相应地

授权标头格式为

```
Authorization: ApiToken [YOUR_SECRET_API_TOKEN_KEY]
```

使用 JavaScript `fetch` API 的示例：

```js
fetch(url, {
  headers: {
    'Authorization': 'ApiToken d2pat_5xVA12xyUbWNedQxy4ohH77WlxRGVvZZ1151814092',
  }
})
```

### 服务器配置{ #server-configuration } 

> **Important**
>
> Before the DHIS2 2.38 version, the PATs feature is default disabled.
> To enable PATs, set the `enable.api_token.authentication` property to `on` in the dhis.conf file.

