---
edit_url: "https://github.com/dhis2/dhis2-docs/blob/2.39/src/user/sms-configuration.md"
revision_date: '2021-06-14'
tags:
- DHIS core version 2.39
- 使用
---

# 配置短信{ #sms-configuration-intro }

本文件介绍 SMS 配置应用程序的功能。有关
有关 SMS 服务集成的其他信息，请参阅
[移动](#mobile_intro) 文档。

## 短信命令 { #sms-configuration-commands }

短信命令处理 DHIS2 实例接收到的短信，并根据命令和短信内容采取特定行动。
根据命令和信息内容采取特定行动。可设置多个 SMS 命令
以多种方式处理数据。SMS 命令是一个
对象，其中包含每种 SMS 形式的配置：报告来自
手机或 j2me 应用程序报告数据、提醒用户、登记患者或用户等。

### 列出可用命令{ #sms-configuration-commands-list }

要查看所有可用命令，请导航至 "命令 "页面。  所有命令
将以表格形式列出。该页面提供以下操作：

* 添加命令 (1)
* 编辑命令 (2)
* 删除命令 (3)
* 批量删除命令 (4)

![SMS Commands - List](resources/images/sms-configuration/commands-list.png)

### 删除可用命令{ #sms-configuration-commands-delete }

要删除命令，可以逐个选中要删除的每个命令的复选框 (1)
(1) 或通过选中表头 (2) 的复选框来选择所有显示的命令。
选中表头的复选框 (2)，选择所有显示的命令。选择要删除的命令后
选择要删除的命令后，点击 "删除所选 "按钮 (3)。

![SMS Commands - Delete selection](resources/images/sms-configuration/commands-delete-selection.png)

为防止误删，将显示确认对话框。

![SMS Commands - Delete confirmation](resources/images/sms-configuration/commands-delete-confirmation.png)

### 添加命令{ #sms-configuration-commands-add }

> **注意事项**
>
> 命令添加后不会立即生效！ 
> 然后必须对它们进行编辑，以便配置必要的字段！

在命令概览页面点击 "添加命令 "按钮后，会出现一个动态表单。
会出现一个动态表格。根据解析器类型，将显示不同的输入内容
显示：

| 解析器类型 | 用户组 | 程序 | 程序阶段 | 资料集 |
|-|-|-|-|-|
| 警报器 | ✓ | ✕ | ✕ | ✕ |
| 事件注册解析器 | ✕ | ✓ | ✓ | ✕ |
| J2ME 解析器 | ✕ | ✕ | ✕ | ✓ |
| 键值解析器 | ✕ | ✕ | ✕ | ✓ |
| 程序阶段数据输入解析器 | ✕ | ✓ | ✓ | ✕ |
| 跟踪实体注册解析器 | ✕ | ✓ | ✕ | ✕ |
| 未注册的解析器 | ✓ | ✕ | ✕ | ✕ |

#### 事件注册解析器{ #sms-configuration-commands-add-eventregistration }

这些命令可以为相关的程序阶段设置简码。
该命令只能选择 "事件程序 "类型的程序。
因此只存在一个程序级，该程序级将被自动选择。

#### 程序阶段数据输入解析器{ #sms-configuration-commands-add-programstagedataentry }

这些命令可以为相关的程序阶段设置简码。
该命令只能选择 "跟踪程序 "类型的程序。
与 "事件注册 "分析程序不同，该分析程序类型必须选择一个程序阶段。
解析器类型。

### 编辑命令{ #sms-configuration-commands-edit }

编辑命令时，无法更改解析器类型以及添加命令时提供的附加数据。
是不可能的。目前
是创建新命令并删除旧命令。

有某些对于所有SMS命令类型都通用的参数。
如果用户使用这些参数，则在系统中配置默认值
确实为这些参数提供了任何值，那么那些默认参数将
使用。这是这些参数的列表

这些常见的字段有

| 参数 | 类型 | 描述 |
|---|---|---|
| 现场分隔器 | 串 | 提供自定义字段分隔符。默认为"|"。 |
| 如果没有发送代码（只有命令），则回复信息 | 串 | 在 SMS 文本输入中找不到代码时提供信息。默认为 "缺少参数"。 |
| 格式错误信息 | 串 | 在命令格式不正确时提供信息。命令格式应与代码值分隔符一致。如果缺少任何必选参数，也会返回该信息。 |
| 无用户信息 | 串 | 如果发送的电话号码未在 DHIS2 中注册，则提供信息。 |
| 用户属于多个机关单位的信息 | 串 | 某些 SMS 命令类型要求用户（从发送电话号码中获取）只与一个组织单位相关联。如果该要求未得到满足，则可将该信息配置为回发。 |
| 成功信息 | 串 | 提供流程成功完成后将发送的信息。 |

有些命令可以选择添加简码，下文将针对每种解析器类型的个别章节进行解释。
下面针对每种分析程序类型的单独章节中进行了解释。

#### 编辑警报解析器命令{ #sms-configuration-commands-edit-alertparser }

编辑警报解析器命令时，只有两个字段可编辑，大多数解析器类型共享的字段都不存在。
大多数解析器类型共享的字段都不存在：

* 姓名（必填）
* 确认信息

两者都是文本字段。

#### 编辑事件注册解析器命令{ #sms-configuration-commands-edit-eventregistration }

这种解析器类型的命令具有所有共享字段。
此外，还可以定义短代码。
与添加命令时所选择的程序阶段相连接的每个数据元素都可以添加一个短代码。
的每个数据元素都可添加一个短代码：

![短信命令 - 事件注册解析器简码](resources/images/sms-configuration/commands-edit-eventregistrationparse-shortcodes.png)

#### 编辑 J2ME 分析器命令{ #sms-configuration-commands-edit-j2me }

该解析器类型的命令具有所有共享字段。SMS 命令将
有一个数据集，因为这些数据集用于报告数据。如果报告的数据
如果报告的数据涉及已获批准的周期，则会发回 SMS 响应，其中包含有关周期批准状态的信息。
包含有关该周期批准状态的信息。此外，还可定义短
短代码。每条命令都与一个数据集相连。数据集有
数据元素，这些数据元素有类别组合，这些类别组合至少有一个类别
选项组合。对于每一个现有的 "数据元素 - 类别选项组合 "组合，都可以提供一个简短代码。
组合，都可以提供一个简短代码。

必填值 注意 当选择完整性方法 "接收至少一个数据值 "时，确保至少提供了一个 SMS 短代码。
完整性方法 "接收至少一个数据值 "时，确保提供至少一个短信短代码，否则
收到的信息将不会被处理。

##### 短代码公式{ #sms-configuration-commands-edit-j2me-shortcodeformulas }

每个短代码都可以有一个可选公式。通过提供公式
不同数据元素的值可以相加或相减。

点击下方的 "添加公式"/"编辑公式 "按钮即可完成此操作
按钮：

![SMS Commands - J2Me parser short codes - Add/Edit formula button](resources/images/sms-configuration/commands-edit-j2meparser-shortcodes-formulabutton.png)

单击该按钮后，将出现一个模态对话框，其中提供了一个下拉菜单，用于选择数据元素和公式运算符。
数据元素和公式运算符，公式运算符可以是 "+"或"-"：

![SMS Commands - J2Me parser short codes - Add/Edit formula modal](resources/images/sms-configuration/commands-edit-j2meparser-shortcodes-formulamodal.png)

点击 "保存 "后，公式将被添加到主编辑表单中，但不会自动保存到命令中。
不会自动保存到命令中！要保存更改后的公式
需要提交整个表单。

###### 删除短代码公式{ #sms-configuration-commands-edit-j2me-removingshortcodeformula }

如果简短代码中有公式，可点击 "编辑公式 "按钮将其删除。
按钮将其删除。出现的模式窗中有一个 "删除 "按钮。点击该
按钮，主表单中的简短代码中的公式将被移除，模态将关闭。
模态将关闭。公式不会自动保存到命令中！为了
要保存删除的公式，您需要提交整个表单。

![短信命令 - J2Me 解析器简码 - 添加/编辑公式模式](resources/images/sms-configuration/commands-edit-j2meparser-shortcodes-formulamodalremove.png)

#### 编辑键值分析器命令{ #sms-configuration-commands-edit-keyvalue }

该命令类型的工作原理与 J2ME 解析器命令的工作原理相同。请查看
上述文档。

#### 编辑程序阶段数据输入解析器命令{ #sms-configuration-commands-edit-programstagedataentry }

这种解析器类型的命令具有所有共享字段。  此外，还可定义短
代码。可以为每个数据元素添加一个短代码
与添加命令时选择的程序阶段相连的每个数据元素都可添加一个短代码：

![短信命令 - 程序阶段数据录入解析器简码](resources/images/sms-configuration/commands-edit-programstagedataentryparser-shortcodes.png)

#### 编辑跟踪实体注册解析器命令{ #sms-configuration-commands-edit-trackedentityregistration }

这种解析器类型的命令具有所有共享字段。  此外，还可定义短
代码。与添加命令时选择的程序相连的每个被跟踪实体的
属性添加一个简码：

![短信命令 - 程序阶段数据录入解析器简码](resources/images/sms-configuration/commands-edit-trackedentityregistrationparser-shortcodes.png)

#### 编辑未注册的解析器命令{ #sms-configuration-commands-edit-unregistered }

该命令类型的工作原理与警报解析器命令的工作原理相同。请查看
上述文档。

## 短信网关{ #sms-configuration-gateways }

短信网关可让 DHIS2 实例发送和接收短信。不同的
网关类型。至少需要一个网关
才能收发短信。如果有多个可用网关，负载平衡将使用所有网关。
多个可用网关。

SMS 服务支持四种类型的网关：
* 通用网关
* 群发短信网关
* Clickatell 网关
* SMPP 网关

### 上市网关{ #sms-configuration-gateways-listing }

要查看所有可用网关，请导航至 "网关配置 "页面。
所有网关将以表格形式列出。在此页面上，可以执行以下操作
可用：

* 添加网关 (1)
* 编辑网关 (2)
* 删除网关 (3)
* 批量删除网关 (4)
* 设置默认网关 (5)

![SMS Gateways - List](resources/images/sms-configuration/gateways-list.png)

### 添加网关{ #sms-configuration-gateways-add }

在网关配置概览页面点击 "添加网关 "按钮后
概览页面上点击 "添加网关 "按钮后，会出现一个动态表单。它分为两个部分：

1. 网关类型 (1)
1. 网关配置取决于网关类型 (2)

![SMS Gateways - Adding gateways](resources/images/sms-configuration/gateways-addinggateways.png)

有关配置网关的更多详情，请参阅[网关
配置](#gateway.configuration)部分。
文件中的 [网关配置]（#gateway.configuration）部分。

### 编辑网关{ #sms-configuration-gateways-edit }

编辑与添加网关类似，但网关类型
不能更改。如果网关类型错误，则需要删除并重新添加。
重新添加。有关如何编辑网关的更多信息，请参阅上文 "添加网关 "部分。
"添加网关 "部分。

## 查看入站短信{ #sms-configuration-inbound }

要查看所有收到的短信，请导航至 "已收 "页面。  所有收到的短信将
将以分页表格的形式列出。在此页面上，可以执行以下操作
可用：

* 过滤接收到的短信息 (1)
* 删除短信 (2)
* 批量删除短信 (3)

![SMS Inbound SMSes - Listing inbound SMSes](resources/images/sms-configuration/inboundsms-list.png)

### 筛选 { #sms-configuration-inbound-filtering }

#### 重置过滤器{ #sms-configuration-inbound-filtering-resetting }

点击 "重置过滤器 "按钮可重置所有已设置的过滤器。

![SMS Inbound SMSes - Filter inbound SMSes by status](resources/images/sms-configuration/inboundsms-resetfilters.png)

#### 按状态筛选{ #sms-configuration-inbound-filtering-status }

可按以下状态过滤接收到的短信列表：

* 所有
* 失败
* 传入
* 已处理
* 加工
* 发送
* 未处理

![SMS Inbound SMSes - Filter inbound SMSes by status](resources/images/sms-configuration/inboundsms-filterbystatus.png)

#### 按电话号码筛选{ #sms-configuration-inbound-filtering-phonenumber }

在短信表上方的输入框中输入电话号码、
就可以通过该电话号码对表格进行筛选。

![SMS Inbound SMSes - Filter inbound SMSes by status](resources/images/sms-configuration/inboundsms-filterbyphonenumber.png)

## 查看出站短信{ #sms-configuration-outbound }

该部分与 "入站"/"接收 "短信部分完全相同，唯一不同的是
不同之处：该列表不能按电话号码筛选。请参考
查看入站短信"](#sms-configuration-inbound) 部分。

