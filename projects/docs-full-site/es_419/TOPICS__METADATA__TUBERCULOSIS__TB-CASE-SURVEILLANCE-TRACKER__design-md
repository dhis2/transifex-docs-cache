---
edit_url: "https://github.com/dhis2-metadata/TB_CS/blob/master/docs/tb_cs-design.md"
revision_date: "2022-09-12"
---

# TB Case Surveillance Program (Tracker) { #tb-case-surveillance-program-tracker }

## Summary { #summary }

The TB Case Surveillance Tracker digital data package for DHIS2 is based on the [WHO recording and reporting framework from 2013.](https://www.who.int/tb/publications/definitions/en/) It provides a set of recommended metadata (data elements, program rules, etc) to enable electronic capture of individual/case-based TB surveillance data. The tracker metadata is configured to ensure that aggregated standard quarterly TB report indicators on notifications, first-line outcomes and second-line outcomes as defined by the [WHO Definitions and reporting framework for TB (2013)](https://www.who.int/tb/publications/definitions/en/) can be automatically generated from the individual data captured. The TB Case Surveillance Tracker is **not** intended to support patient management or patient care. This requires more detailed analysis of roles, responsibilities, workflows and decision-making within the settings in which such systems would be implemented.

## Purpose & Intended Audience { #purpose-intended-audience }

This document describes the conceptual design, content and functionality for a standard DHIS2 tracker program for case-based surveillance of tuberculosis (TB) based on WHO technical guidance and metadata requirements.

This document is intended for audiences responsible for implementing TB data systems and/or HMIS in countries, including:

1. System admins/HMIS focal points: those responsible for installing metadata packages, designing and maintaining HMIS and/or TB data systems
2. TB program focal points responsible for overseeing data collection, management, analysis and reporting functions of the national TB programme
3. Implementation support specialists, e.g. those providing technical assistance to the TB programme or the core HMIS unit to support & maintain DHIS2 as a national health information system and/or TB data system

The system design document explains how the tracker program was configured to meet the data entry and analysis requirements and support a typical workflow. The document does not include an exhaustive listing of all metadata captured. This document also does not consider the resources and infrastructure needed to implement such a system, such as servers, power, internet connections, backups, training and user support. More information on the TB programme technical aspects informing this system design is available in the _[WHO publication on electronic recording and reporting for tuberculosis care and control](http://www.who.int/tb/publications/electronic_recording_reporting/en/)_. Supplementary implementation guidance for DHIS2 can be found in the [General DHIS2 Implementation Guide](https://docs.dhis2.org/en/implement/configuring-the-android-app/about-this-guide.html) and [DHIS2 tracker implementation guide](https://docs.dhis2.org/en/implement/understanding-dhis2-implementation/a-quick-guide-to-dhis2-implementation.html)

## Background { #background }

Reliable epidemiological data is required for staff at all levels of a national TB programme to plan and provide effective tuberculosis care and control services, as well as monitor the performance of programmatic actions. A case-based surveillance system has clear advantages over an aggregate data collection system. Like an aggregate surveillance system a **_minimum set_** of epidemiological indicators can be captured, validated, aggregated, calculated and displayed but these can be disaggregated by **any combination** of time, location/area, age, sex, case type, previous treatment history, HIV status, drug resistance status and treatment regimens. This helps us to understand TB epidemiology in depth and monitor changes over time.

It is expected that case-based electronic data will result in **improved data quality** because the number of data entry steps are reduced, automatic calculations and validations can be built into the system, inconsistent, erroneous or incomplete data can be corrected or completed rapidly for an individual record and de-duplication can be carried out to remove duplicate records. A case-based surveillance system should also allow the linking of surveillance records to the same case even if a TB case is transferred or referred between facilities during the course of treatment.

At the national level, case-based data can either be matched routinely to other data sources, such as HIV or diabetes databases, to measure the burden of co-morbidities and improve patient care, or to other TB data sources to quantify the level of under-reporting of TB cases to the NTP. Matching TB clinical data to TB genotyping data from the laboratory can also lead to the detection and investigation of outbreaks for public health action.

Finally case-based data can be used in epidemiological observational research studies support making informed decisions on programmatic changes based on scientific evidence. The data captured should not exceed the purposes outlined.

See principle 2.4, page 16, of _Policy on the Protection of personal Data of Persons of Concern to UNHCR_ ([http://www.refworld.org/docid/55643c1d4.html](http://www.refworld.org/docid/55643c1d4.html))

## System Design Overview { #system-design-overview }

### Use Case { #use-case }

The TB Case Surveillance Tracker enables registration and longitudinal tracking of TB cases from the point of notification to final case outcome, inclusive of laboratory results. The program captures a minimum set of data points required for epidemiological analysis of case surveillance data as described in the background section. These include baseline and demographic information about the case, risk factors, laboratory results, drug resistance type classification, treatment regimens provided, and case outcome. This tracker program is _not_ designed to support clinical management nor patient care. The program serves as an electronic registry that supports decentralized electronic data capture of case surveillance data down to health facility level; parts of the tracker program are also configured to allow data entry directly by laboratories. Depending on infrastructure and resource availability in-country, data entry can also be conducted at the district or higher levels based on paper registers.

Workflows in countries may vary and the case surveillance program should be adapted as needed to local context. For example, this design assumes that a case is first entered into the DHIS2-based electronic registry when baseline information and risk factors become available at a clinical visit. However, the program stages can be re-ordered in contexts where a case may first be entered into the electronic system when a laboratory result becomes available and baseline information entered retrospectively.

### Program Structure { #program-structure }

The structure of the program in DHIS2 is as follows:

![System Design](resources/images/TB_CS_System_Design.png)

## Tracker Program Configuration { #tracker-program-configuration }

### Program Details { #program-details }

The **Tracked Entity Type** for this program is a ‘person’. Tracked entity types are often shared across programs in an integrated DHIS2 instance. The program is configured to **require the user to search a minimum 1 attribute** before registering a new TEI.

#### Access { #access }

The **access** level is configured as **protected** in order to protect personally identifiable data from unauthorized access, The user may search and read tracked entity instances that are owned by the organisation unit to which the user is assigned data capture access. If a user searches for a TEI that exists outside of their organisation unit, that the user does not have data capture authority for, the user is presented with the option to access the patient record by first recording a reason. This approach to privacy is known as ‘breaking the glass’, since it allows the user to perform their work without outside permission or assistance, but leaves a clear trail to be audited. Once the user gives a reason for breaking the glass, then gain temporary ownership of the tracked entity instance (see the [Tracker User Guide](https://docs.dhis2.org/en/implement/configuring-the-android-app/features-supported.html#breaking-the-glass) for more information.)

### Enrollment Details { #enrollment-details }

The **enrollment date** is conceptualized as the ‘date of TB diagnosis’. A TEI is allowed to have multiple enrollments, as it is possible that a case would enter the system more than once (i.e. recovers and becomes a case again). In situations where a case was previously enrolled in a TB Case Surveillance tracker, it is possible to see Enrollment History using the [Enrollment Widget](https://docs.dhis2.org/en/use/user-guides/dhis-core-version-master/tracking-individual-level-data/tracker-capture.html#manage_tracked_entity_instance_enrollment).

### Attributes { #attributes }

When a case is enrolled into the TB case surveillance as a tracked entity instance (TEI), TEI attributes are recorded to form the case profile. Note that where the TB tracker program is installed alongside other programs in a DHIS2 instance, these common attributes may be shared across different programs (e.g. first name, last name, date of birth).

### Stage 1: TB Registration { #stage-1-tb-registration }

The TB registration stage captures baseline information, risk factors and comorbidities including HIV status. This is a non-repeatable program stage. While most of the information on the baseline stage should be completed when a case is first enrolled, this stage can be updated at any point during the enrollment if new information is available (most notably updates to the site of disease or HIV status).

The **event date** for TB Registration is the date of data capture (or reporting) in DHIS2.

The TB Registration Event is automatically generated after the enrollment stage.

![Enrollment](resources/images/TB_CS_Enrollment.png)

The data element **[Current Address (on map)]** is configured as type ‘coordinates’ to enable geospatial analysis in the Maps app.

The data element **[History of Previous Treatment]** follows the standard WHO definitions:

|  |  |
| :-- | :-- |
| **New** | New patients have never been treated for TB or have taken anti-TB drugs for less than 1 month |
| **Relapse** | Previously treated patients have received 1 month or more of anti-TB drugs in the past. Relapse patients have previously been treated for TB, were declared cured or treatment completed at the end of their most recent course of treatment, and are now diagnosed with a recurrent episode of TB (either a true relapse or a new episode of TB caused by reinfection). |
| **Treatment after failure of first-line treatment** | Previously treated patients have received 1 month or more of anti-TB drugs in the past. Treatment after failure patients are those who have previously been treated for TB and whose treatment failed at the end of their most recent course of treatment. |
| **Treatment after failure of second-line treatment** | Previously treated patients have received 1 month or more of anti-TB drugs in the past. Treatment after failure patients are those who have previously been treated for TB and whose treatment failed at the end of their most recent course of treatment. |
| **Treatment after lost to follow-up** | Previously treated patients have received 1 month or more of anti-TB drugs in the past. Treatment after loss to follow-up patients have previously been treated for TB and were declared lost to follow-up at the end of their most recent course of treatment. (These were previously known as treatment after default patients. |
| **Other previously treated** | Previously treated patients have received 1 month or more of anti-TB drugs in the past. Other previously treated patients are those who have previously been treated for TB but whose outcome after their most recent course of treatment is unknown or undocumented. |
| **Unknown** | Patients with unknown previous TB treatment history do not fit into any of the categories listed. |

Several **program rules** have been configured in this stage to improve data quality and ease of data entry. If the case is not listed with an HIV diagnosis and has not been tested more in more than 6 months, a program rule will show the following warning to prompt re-testing:

![Warning HIV retesting](resources/images/TB_CS_HIV_Warning.png)

### Stage 2: Laboratory Results { #stage-2-laboratory-results }

This stage is repeatable. Data can be entered by clinicians, facility staff, lab staff or district TB staff depending on country context. The **event date** is the ‘date of sample collection.’

Results for multiple test types for the same sample collection can be entered in one event.

The TB Case Surveillance Tracker package allows capturing data for 14 types of diagnostic tests. Data elements captured for each type of test are specific to the test, including which type of test was conducted, the date of lab results, specimen number, and case whether resistance was detected. Relevant tests can be included in or excluded from the Laboratory Results stage in DHIS2 depending on their availability in the National Reference Laboratory (NRL) in the implementing country. Similarly, the list of drugs for Phenotypic DST can be adapted according to first- and second-line drugs relevant to the country. In both cases, this is done through Constants during initial configuration of the package. (See Section [Constants](#Constants))

A sample of the data entry form for select test types is shown below:

![Sputum Smear Microscopy](resources/images/TB_CS_SSM.png)

![Xpert MTB/RIF](resources/images/TB_CS_Xpert.png)

![DST](resources/images/TB_CS_DST.png)

![LPA](resources/images/TB_CS_LPA.png)

Data entered in the Laboratory Stage are used to calculate case and resistance classification using program rules, which can also be displayed in the Top Bar Widget and Feedback widget in the Tracker Capture App. Program uses data elements automatically filled by program rules, including a DE ‘resistance classification’ based on laboratory results. DE’s also include the date when resistance to rifampicin was detected, when resistance was ‘first detected’ in the case of multiple tests in the Status section. These dates are required for specific indicator calculations.

### Stage 3: Treatment { #stage-3-treatment }

The treatment stage is a repeatable stage that should be limited to two events to account for _one_ change of treatment regimen. Program rules are used to ensure that the same regimen cannot be entered twice. The **event date** is the ‘**date of treatment initiation**’. If there is a change in treatment regimen, a second event will be recorded and the date of treatment initiated reflects the initiation of the new treatment regimen. The ‘expected date of treatment initiation’ is automatically scheduled three days from enrollment; it can be rescheduled manually.

![Treatment](resources/images/TB_CS_Treatment.png)

#### Section: TB Drug Resistance Type Classification { #section-tb-drug-resistance-type-classification }

This section allows a user to overwrite the DE [Resistance Classification] that was automatically generated by a Program Rule based on laboratory results in the system. For example, a doctor/clinician may determine classification status other than the one automatically calculated by the formulas included in this program.

![Assigning resistance classification](resources/images/TB_CS_Treatment_classification.png)

#### Section: Treatment Regimen { #section-treatment-regimen }

The program supports first-ling and second-line treatment regimens, with a complete list of drugs that can be modified according to national availability and treatment guidelines. The use of Constants helps an implementer to enable/disable the treatments from appearing for the data entry user.

#### Start dates for treatment { #start-dates-for-treatment }

Capturing treatment start dates are important because outcomes for cases with second-line treatment are evaluated based on the date started on second-line treatment; while outcomes for cases on first-line treatment are evaluated based on the enrollment (the date of diagnosis). First-line and second-line treatment start dates are automatically calculated based on program rules and included in this stage as data elements to ensure they can be used properly for analysis (e.g. to calculate number of days delay in receiving treatment, for example).

#### Outcome due dates { #outcome-due-dates }

A DE ‘outcome due’ automatically calculates a date using a program rule based on the type of treatment (first-line or second-line) and treatment initiation date. When a treatment regimen is selected, the “Outcome Due” date is calculated and assigned according to the length of that treatment (for first-line treatments, outcome due date is scheduled 9 months from treatment initiation date; for second-line treatment, the outcome date is scheduled for 24 months from treatment initiation date).

![Outcome due date](resources/images/TB_CS_Outcome_due.png)

### Stage 4: Outcome { #stage-4-outcome }

#### Outcome date and due date { #outcome-date-and-due-date }

The outcome stage is completed at the end of the enrollment. The **event date** for this program stage is conceptualized as the ‘date of outcome’. The **event due date** is configured with the description ‘expected date of outcome. By default, the due date for outcome section is scheduled for 180 days after enrollment date’. Current functionality of DHIS2 v 2.33 does not allow assigning the calculated DE ‘Outcome Due’ from the Treatment stage as the due date for the Outcome stage. The Outcome stage due date may be changed manually, but can only be rescheduled once. For a user, this may be done after Treatment has been initiated and the DE in the Treatment stage ‘Outcome Due’ has been generated. When an Outcome stage is overdue (the current date is later than the calculated DE ‘Outcome due’ from the Treatment stage, a message is displayed in the Feedback Widget.

#### Treatment Outcome { #treatment-outcome }

When an outcome is selected as part of the option set, program rules show the user the WHO outcome definition to help ensure that correct outcome definitions are recorded. These program rules take into account the type of treatment (first-line or second-line) in order to display the proper outcome definition.

In addition, outcomes ‘cured’, ‘completed’ and ‘not evaluated’ can only be entered after 6 months have passed from the Enrollment Date (date of diagnosis). A treatment outcome of ‘failed’ can only be entered 5 months after the Enrollment Date (date of diagnosis).

![Outcome](resources/images/TB_CS_Outcome.png)

#### Denotifying a TB Case { #denotifying-a-tb-case }

This stage also allows a user to ‘denotify’ the TB case. For example, if laboratory results for a clinically diagnosed TB case are negative, a user may denotify the case because it is not TB. The denotification can also be used if a duplicate case is found in the system. When the ‘Denotify case’ DE is checked, the user is prompted to select a reason for denotifying from the option set and provide additional evidence for denotification or provide duplicate TB record number in case of duplication. **_When a case has been denotified for any reason, the case is excluded from analysis of TB cases._**

#### Completing Outcome Stage { #completing-outcome-stage }

A prompt **Select an outcome or specify if this is not a TB case.** appears next to the Treatment Outcome triggered by a program rule. It is not possible for the user to complete the Outcome stage without specifying an outcome or denotifying the case. The Outcome stage is configured to block data entry after the stage is completed.

![Completing outcome stage](resources/images/TB_CS_Complete_outcome.png)

### Program Rules { #program-rules }

Program rules are used extensively in the TB Case Surveillance Program to show/hide data elements to optimize the data entry form, show warnings/feedback to the data entry user and autocalculate & assign data values to data elements. Selected program rules for understanding the configuration of this program for TB Case Surveillance are described below. A complete list of program rules can be found in the Metadata Reference File.

#### Limit Number of Treatment Events { #limit-number-of-treatment-events }

For TB Case surveillance, only one Treatment event should be captured for each change in treatment regimen (e.g. from first-line to second-line). Program rules are used to limit the number of events to one change in treatment regimen. To ensure that the same regimen cannot be entered twice, an event that has first-line treatment will only allow selection of second-line treatment regimen in a second event and vice versa.

#### Limit Outcome options and Show outcome definitions { #limit-outcome-options-and-show-outcome-definitions }

In the Outcome stage, program rules are configured to ‘show warning’ that provides the data entry user with the WHO case outcome definition depending on whether first- or second-line treatment was provided.

|  |  |
| :-- | :-- |
| **Outcome** | **Cured** |
| Definition (First-line Treatment) | A pulmonary TB patient with bacteriologically confirmed TB at the beginning of treatment who was smear- or culture-negative in the last month of treatment and on at least one previous occasion. |
| Definition (Second-line Treatment) | Treatment completed as recommended by the national policy without evidence of failure AND three or more consecutive cultures taken at least 30 days apart are negative after the intensive phase. For Treatment failed, lack of conversion by the end of the intensive phase implies that the patient does not convert within the maximum duration of intensive phase applied by the programme. If no maximum duration is defined, an 8-month cut-off is proposed. For regimens without a clear distinction between intensive and continuation phases, a cut-off 8 months after the start of treatment is suggested to determine when the criteria for Cured, Treatment completed and Treatment failed start to apply. |
| Program rules | 1. Option is not available for outcomes that are recorded within the period of 6 months after enrollment. 2. Option is not available for cases that are clinically diagnosed. 3. Option is not available for extra-pulmonary TB cases undergoing second-line treatment (Error message is displayed). |
| **Outcome** | **Completed** |
| Definition (First-line Treatment) | A TB patient who completed treatment without evidence of failure BUT with no record to show that sputum smear or culture results in the last month of treatment and on at least one previous occasion were negative, either because tests were not done or because results are unavailable. |
| Definition (Second-line Treatment) | Treatment completed as recommended by the national policy without evidence of failure BUT no record that three or more consecutive cultures taken at least 30 days apart are negative after the intensive phase. For Treatment failed, lack of conversion by the end of the intensive phase implies that the patient does not convert within the maximum duration of intensive phase applied by the programme. If no maximum duration is defined, an 8-month cut-off is proposed. For regimens without a clear distinction between intensive and continuation phases, a cut-off 8 months after the start of treatment is suggested to determine when the criteria for Cured, Treatment completed and Treatment failed start to apply. |
| Program rules | Option is not available for outcomes that are recorded within the period of 6 months after enrollment. |
| **Outcome** | **Failed** |
| Definition (First-line Treatment) | A TB patient whose sputum smear or culture is positive at month 5 or later during treatment. |
| Definition (Second-line Treatment) | Treatment terminated or need for permanent regimen change of at least two anti-TB drugs because of: lack of conversion by the end of the intensive phase, or bacteriological reversion in the continuation phase after conversion to negative, or evidence of additional acquired resistance to fluoroquinolones or second-line injectable drugs, or adverse drug reactions (ADRs). For Treatment failed, lack of conversion by the end of the intensive phase implies that the patient does not convert within the maximum duration of intensive phase applied by the programme. If no maximum duration is defined, an 8-month cut-off is proposed. For regimens without a clear distinction between intensive and continuation phases, a cut-off 8 months after the start of treatment is suggested to determine when the criteria for Cured, Treatment completed and Treatment failed start to apply. The terms “conversion” and “reversion” of culture as used here are defined as follows: Conversion (to negative): culture is considered to have converted to negative when two consecutive cultures, taken at least 30 days apart, are found to be negative. In such a case, the specimen collection date of the first negative culture is used as the date of conversion. Reversion (to positive): culture is considered to have reverted to positive when, after an initial conversion, two consecutive cultures, taken at least 30 days apart, are found to be positive. For the purpose of defining Treatment failed, reversion is considered only when it occurs in the continuation phase. |
| Program rules | Option is not available for outcomes that are recorded within the period of 5 months after enrollment. |
| **Outcome** | **Died** |
| Definition (First-line Treatment) | A TB patient who dies for any reason before starting or during the course of treatment. |
| Definition (Second-line Treatment) | A patient who dies for any reason during the course of treatment. |
| Program rules | -/- |
| **Outcome** | **Lost to follow-up** |
| Definition (First-line Treatment) | A TB patient who did not start treatment or whose treatment was interrupted for 2 consecutive months or more. |
| Definition (Second-line Treatment) | A patient whose treatment was interrupted for 2 consecutive months or more. |
| Program rules | -/- |
| **Outcome** | **Not evaluated** |
| Definition (First-line Treatment) | A TB patient for whom no treatment outcome is assigned. This includes cases “transferred out” to another treatment unit as well as cases for whom the treatment outcome is unknown to the reporting unit. |
| Definition (Second-line Treatment) | A patient for whom no treatment outcome is assigned. (This includes cases “transferred out” to another treatment unit and whose treatment outcome is unknown). |
| Program rules | Option is not available for outcomes that are recorded within the period of 6 months after enrollment. |

#### Auto-assigned data element values { #auto-assigned-data-element-values }

Data values (options within an option set) are automatically assigned to the data elements Case Classification and Resistance Classification when data is entered in the laboratory stage. These classification data elements are also displayed in the top bar as part of the TEI dashboard for easy access when a user has the data entry forms open for a given TEI in theTracker Capture app.

**_Case Classification (DE)_**

This data element is automatically populated by program rules based on the following criteria. The Case Classification is assigned a value as ‘clinically diagnosed’ until lab data are entered upon enrollment in the program.

|  |  |
| :-- | :-- |
| Clinically diagnosed | Default classification status when enrolling a case in TB Case Surveillance. |
| Bacteriologically confirmed | If Laboratory Results are entered in DHIS2 for the following types of tests: _Positive results for Sputum Smear Microscopy or Culture_; _MTB/Drug Resistance detected by WHO Rapid Diagnostic Tests or LPA_. The program does not prevent users from entering DST results prior to entering results of preceding tests in the Lab stage. Entering **only** DST results does not change the confirmation method from “Clinically diagnosed” to “Bacteriologically confirmed” since DST testing is dependent on Culture. |

**_Resistance Classification (DE)_**

This data element is automatically populated by program rules based on the following criteria. However, in practice a data entry user can manually change the classification (e.g. if a doctor/clinician has determined the case is DR).

|  |  |
| :-- | :-- |
| DS (Drug susceptible) | Default classification when enrolling a case in TB Case Surveillance. The Classification is automatically assigned the option ‘DS (drug susceptible)’ until additional lab data are entered. |
| DR (Drug resistant) | Resistance to any drug |
| Mono Res (Mono-resistant) | Resistance to one first-line anti-TB drug only |
| Poly Res (Poly-resistant) | Resistance to more than one first-line anti-TB drug, other than both isoniazid and rifampicin |
| RR (Rifampicin resistant) | Resistance to rifampicin detected using phenotypic or genotypic methods, with or without resistance to other anti-TB drugs. It includes any resistance to rifampicin, in the form of mono-resistance, poly-resistance, MDR or XDR. |
| MDR (Multidrug resistant) | Resistance to at least both isoniazid and rifampicin |
| XDR (Extensive drug resistant) | Extensive drug resistance (XDR): resistance to any fluoroquinolones (levofloxacin or moxifloxacin, and one second-line injectable drug (amikacin), in addition to multidrug resistance |
| RR/MDR | Not-laboratory confirmed cases that began on second-line treatment (More information in the Treatment section). |

**_Treatment Initiation & Outcome Due Dates_**

Program rules are used to assign the event date of the Treatment Program stage as DEs for ‘First-line treatment start’ and ‘Second-line treatment start.’ In addition, a DE ‘Expected date of outcome’ is completed by a program rule and included in both the Treatment and Outcome stages. For first-line treatment, the expected outcome date is 9 months from treatment initiation date. For second-line treatment, the expected outcome date is 24 months from treatment initiation. The dates are also used for analysis. For example, the number of days delay in treatment is calculated based on the time between diagnosis and initiation of treatment.

#### Illustrative Scenarios { #illustrative-scenarios }

In the context of TB Case Surveillance, combinations of program rules apply the following to difference case scenarios:

|  |  |  |
| :-- | :-- | :-- |
| **No laboratory results or treatment for the case has been recorded** | Available outcomes in the Outcome stage: died, lost to follow up. | If the case is not TB, it is possible to “denotify” the case in the Outcome stage. This will remove the case from analytics processes. |
| **No laboratory results have been recorded.** The case is placed on first-line treatment and no previous treatment event has been registered. | First-line treatment start date is recorded in the status section. An expected date of treatment outcome (9 months from treatment initiation date) is also displayed in the Status section in the Treatment stage. | When adding a second Treatment event, the user will be prevented from selecting first-line treatment in the treatment regimen. |
| **Laboratory results have been recorded and drug resistance has been detected.** The case is placed on first-line Treatment and no previous treatment event has been registered. | First-line treatment start date is recorded in the status section. An expected date of treatment outcome (9 months from treatment initiation date) is also displayed in the status section. A warning message is displayed in the Feedback Widget: _**Drug resistance detected and patient is on first-line treatment.**_ | When adding a second Treatment event, the user will be prevented from selecting First-line treatment in the treatment regimen. |
| **No laboratory results have been recorded and no previous treatment recorded, but the case is placed on second-line treatment** | The case is registered as a clinically diagnosed RR/MDR case. Second-line treatment start date is recorded in the status section. Expected date of treatment outcome (24 months from treatment initiation date) is displayed in the status section. | Once laboratory results are entered in the Laboratory Results stage the classification is automatically reassigned by the system. When adding a second Treatment event, the user is prevented from selecting Second-line treatment in the treatment regimen. |
| **Laboratory results have been recorded in DHIS2 and drug resistance has been detected.** No previous treatment event is registered. The case is placed on second-line treatment | Second-line treatment start date is recorded in the status section. Expected date of treatment outcome (24 months from treatment initiation date) is displayed in the status section. | When adding a second Treatment event, the user will be prevented from selecting Second-line treatment in the treatment regimen. |
| **No laboratory results have been recorded in DHIS2.** Previous treatment event was first-line treatment. The case is placed on second-line treatment. | Second-line treatment start date is recorded in the status section. Expected date of treatment outcome (24 months from treatment initiation date) is displayed in the status section. | It is not possible to create new Treatment events. |
| **Laboratory results have been recorded in DHIS2 and drug resistance has been detected.** Previous treatment event was First-line Treatment. The case is placed on Second-line Treatment. | Second-line treatment start date is recorded in the status section. Expected date of treatment outcome (24 months from treatment initiation date) is displayed in the status section. | It is not possible to create new Treatment events. |

### Top Bar Widget { #top-bar-widget }

The top bar widget within the Tracker Capture app is useful for the data entry user to have a snapshot overview of information about the TEI (case) every time the TEI enrollment is opened for this program.

The table below summarizes program indicators and variables displayed in the Top Bar Widget and how they are calculated. “Type” refers to whether a particular variable is configured as a program indicator with the “display in form” option enabled, or if it is calculated and displayed using program rules.

| Variable | Tipo | Calculation |
| :-- | :-- | :-- |
| Current age (years) | Program indicator | Number of years between current date and the “Date of birth (age)” tracked entity attribute. |
| Months since enrolment | Program indicator | Number of months from enrolment in the program (notification date) to the current date. |
| Treatment regimen | Regla de programa | Showing the current (latest) treatment regimen recorded (initial first-line, retreatment first-line, second line) |
| Case classification | Regla de programa | If no positive culture, smear or Xpert MTB result is recorded in the lab stage, the classification is “clinically diagnosed”. If a positive result is recorded for any of the tests, the classification is “Bacteriologically confirmed”. |
| Resistance classification | Regla de programa | Based on Xpert RIF results and any resistance results from the DST program stage, the case is classified as drug susceptible (DS), or with different types of drug resistance (DR, RR, MDR, XDR). The case is classified as a “Non-lab confirmed DR” case if this is selected on the treatment page AND no drug resistance results are recorded. |
| Resistance | Regla de programa | Lists the drugs for which drug resistance have been detected through Xpert RIF or DST testing. |

### Feedback Widget { #feedback-widget }

The following feedback messages are configured to display in the Feedback Widget when certain conditions are met as outlined in the table below:

| Message | Condition |
| :-- | :-- |
| Drug resistance detected and the patient is on first-line treatment. | Patient is on first-line treatment, despite having lab/DST results indicating drug resistance. |
| GeneXpert MTB not detected. This may not be a TB case. | Xpert MTB results are “Not detected”, which indicate that this is not a TB case |
| No drug resistance detected, but patient is on second-line treatment. | Patient is on second-line treatment, without lab/DST results indicating drug resistance. |
| Only two treatment events can be added. | User adds a third treatment event. Only two are supported, to account for initial treatment regimen, and one change in regimen. |
| Outcome is overdue. | If the current date is later than the calculated DE ‘Outcome due’ in the treatment section, then the message appears in the feedback widget. |
| Please immediately complete the treatment outcome. | The “Not TB” checkbox is completed, indicating that a case is not TB and the enrollment should be closed. |
| Positive smear result recorded. Review the reported "Site of disease". | A positive smear result has been recorded, but the value entered for “Site of disease” does not include “Pulmonary”. |

## Additional features { #additional-features }

### Constants { #constants }

TB Case Surveillance Tracker package includes a set of tests and a list of drugs that can be modified by the implementing country according to national context (e.g. which drugs and tests are used/available in country). The use of constants enables a system admin in an implementing country to easily ‘turn on’ or ‘turn off’ types of drugs and tests depending on availability in country. When the complete package is installed into a DHIS2 instance, all data elements for all tests and drugs included in this package are included in the system. By default, all constants are set to ‘1’ (enabling the related data elements for data entry) and can be configured to ‘2’ by an implementer or system admin according to country context if not needed (disabling the related data elements for data entry). If a test or drug later becomes available in the country, an admin can simply re-enable the data elements by changing the constant from a value of ‘2’ to a value of ‘1’.

![Constants](resources/images/TB_CS_Constants.png)

## Analytics and program indicators { #analytics-and-program-indicators }

### Reporting case-based data into aggregate TB reports { #reporting-case-based-data-into-aggregate-tb-reports }

The TB case-based surveillance tracker captures data that can be fed into standard, aggregate reporting (i.e. monthly, quarterly, or more frequently as determined by the country). An aggregate TB system design in DHIS2 can be accessed at [who.dhis2.org/documentation/#tb](https://who.dhis2.org/documentation/#tb).

The package includes a set of program indicators that are mapped to the corresponding data elements and category option combinations of the data sets in the TB aggregate package. The mapping is based on codes of metadata objects.

The custom attribute **Data element for aggregate data export** `vudyDP7jUy5` contains the reference code of the aggregate data elements. The **Category option combination for agggregate export** field contains reference codes of the category option combinations.

The suggested transfer of the tracker-to-aggregate values is based on the following GET and POST API requests:

1. Source request: `../api/analytics/dataValueSet.json?dimension=dx:` "{program indicator uid/s}" `&dimension=pe:` "{relative period/s}" `&dimension=ou:` {organisation unit level} `&outputIdScheme=ATTRIBUTE:` {"custom attribute:`vudyDP7jUy5`"}
2. Target request: `..api/dataValueSets?dataElementIdScheme=CODE&categoryOptionComboIdScheme=CODE&importStrategy=CREATE_AND_UPDATE&mergeMode=REPLACE&dryRun=false`

In addition, the package comes with a set of indicators that can be fed into a GTB Report form.

### Dashboard { #dashboard }

A subset of data visualizations from the WHO Aggregate TB Package have been recreated using program indicators. These visualizations display data from the Tracker program. These visualizations were selected by WHO as the most useful for monitoring at a facility level more frequently, e.g. in between submitting monthly/quarterly aggregate reports to the HMIS. These visualizations may also support the facility or district level user to compare the TB case surveillance data captured in the Tracker Program with the aggregated data submitted to the HMIS.

## User Groups { #user-groups }

The following user groups are included in the TB Case Surveillance Tracker Package:

-   TB Admin: can edit/view metadata; no access to data [all program stages]
-   TB Data capture: can view metadata, can capture data [all program stages]
-   TB Access: cam view metadata, can view data [all program stages]
-   TB Lab data capture: can view metadata, can capture data [TB registration stage and Laboratory stage only]

## Referencias { #references }

-   _Definitions and reporting framework for tuberculosis (2013 revision, updated December 2014)._ ([http://www.who.int/tb/publications/definitions/en](http://www.who.int/tb/publications/definitions/en))
-   _Understanding and using tuberculosis data._ ([http://www.who.int/tb/publications/understanding_and_using_tb_data/en](http://www.who.int/tb/publications/understanding_and_using_tb_data/en))
-   _Standards and benchmarks for tuberculosis surveillance and vital registration systems: Checklist and user guide._ ([http://www.who.int/tb/publications/standardsandbenchmarks/en](http://www.who.int/tb/publications/standardsandbenchmarks/en))
-   _Assessment of Uganda DHIS2 MDR-TB case-based module (Report by Arax Hovhanisyan following an assessment and visit conducted in June 2017)_
-   _Assessment of Ghana DHIS2 case-based tracker (Report by Arax Hovhanisyan following an assessment and visit conducted in August 2018)_
-   _Assessment of Tanzania case-based tracker (ETL) (Report by Laura Anderson, Tomas Matas and Debora Pedrazzoli following an assessment and visit conducted in July 2018)_
-   _Electronic recording and reporting for tuberculosis care and control_ ([http://www.who.int/tb/publications/electronic_recording_reporting/en](http://www.who.int/tb/publications/electronic_recording_reporting/en))
-   _Digital health for the End TB Strategy: developing priority products and making them work_ ([http://erj.ersjournals.com/content/48/1/29](http://erj.ersjournals.com/content/48/1/29)), especially item 2.2 (Digital notification of TB cases) in the online supplement ([http://erj.ersjournals.com/content/erj/suppl/2016/05/26/13993003.00424-2016.DC1/ERJ-00424-2016_supplement.pdf](http://erj.ersjournals.com/content/erj/suppl/2016/05/26/13993003.00424-2016.DC1/ERJ-00424-2016_supplement.pdf))
-   _Principles for digital development_ ([https://digitalprinciples.org/](https://digitalprinciples.org/)), in particular the sections on ‘Design With the User’ ([https://digitalprinciples.org/principle/design-with-the-user/](https://digitalprinciples.org/principle/design-with-the-user/)), ‘Be Data Driven’ ([https://digitalprinciples.org/principle/be-data-driven/](https://digitalprinciples.org/principle/be-data-driven/)) and ‘Address Privacy and Security’ ([https://digitalprinciples.org/principle/address-privacy-security/](https://digitalprinciples.org/principle/address-privacy-security/))
-   _Policy on the Protection of personal Data of Persons of Concern to UNHCR_ ([http://www.refworld.org/docid/55643c1d4.html](http://www.refworld.org/docid/55643c1d4.html)), particularly chapter 2.
-   _Ethics guidance for the implementation of the End TB Strategy_ [http://www.who.int/tb/publications/2017/ethics-guidance](http://www.who.int/tb/publications/2017/ethics-guidance)), pages 40-41 and 53-54 on privacy and security.
-   _WHO guidelines on ethical issues in public health surveillance_ ([http://www.who.int/ethics/publications/public-health-surveillance](http://www.who.int/ethics/publications/public-health-surveillance))
