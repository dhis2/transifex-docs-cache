---
revision_date: '2024-05-28'
tags:
- 用
template: single.html
---

# 关于本指南 { #about_this_guide_ } 

<!--DHIS2-SECTION-ID:about_this_guide_-->

DHIS 2文档是集体努力的成果，它是由
开发团队和用户。在指南力求完善的同时，
可能有某些功能已被忽略或
尚未记录。本节说明一些约定
在整个文档中使用。

DHIS 2 is a browser-based application. In many cases, screenshots have
been included for enhanced clarity. Shortcuts to various functionalities
are displayed such as **Data element** \> **Data element group**. The
"\>" symbol indicates that you should click **Data element** and then
click **Data element group** in the user interface.

已使用不同样式的文本突出显示以下内容的重要部分：
文本或特定类型的文本，例如源代码。每个
本文档中使用的约定在下面进行了说明。

> **Note**
>
> A note contains additional information which should be considered or a
> reference to more information which may be helpful.

> **Tip**
>
> A tip can be a useful piece of advice, such as how to perform a
> particular task more efficiently.

> **Important**
>
> Important information should not be ignored, and usually indicates
> something which is required by the application.

> **Caution**
>
> Information contained in these sections should be carefully
> considered, and if not heeded, could result in unexpected results in
> analysis, performance, or functionality.

> **Warning**
>
> Information contained in these sections, if not heeded, could result
> in permanent data loss or affect the overall usability of the system.

> **Complete**
>
> Information contained in these sections, will indicate that these 
> are issues that have been fully implemented.

> **Incomplete**
>
> Information contained in these sections, will indicate that these 
> are issues that are not implemented and will be ignored.

> **Not_applicable**
>
> Information contained in these sections, will indicate that these 
> are issues not applicable.

> **Work_in_progress**
>
> Information contained in these sections, will indicate that these 
> are issues or freatures not completely implemented or with unexpected
> behaviour already reported.

    程序列表通常包含某种类型的计算机代码。
    它们将以带阴影的背景和不同的字体显示。

`命令将以粗体文本显示，并代表一个命令
需要在操作系统或数据库上执行`。

指向外部网站或交叉引用的链接将显示在
蓝色文本，并带有下划线，例如[this。]（http://www.dhis2.org）。

<!--
Bibliographic references will displayed in square brackets like this
Store2007. A full reference can be found in the bibliography contained
at the end of this document.
-->



# 介绍 { #capture_app_introduction }

本指南旨在帮助您配置DHIS 2以与Android Capture App一起使用。

它不是教程或培训手册；它旨在通过针对Android应用程序的特定参考资料来补充DHIS 2核心文档和培训资料。

本文档分为多个部分，旨在描述应用程序中已实现的所有功能，尚未实现的功能以及将不支持的功能。在适用的情况下，将提供有关在Android应用中使用特定功能的问题的说明。还将提供建议或技巧，以更好地理解和使用该应用程序。

此外，该文档还包含有关登录，视觉配置，同步管理和已知重要错误列表的新功能的部分。







# DHIS 2移动部署的建议 { #capture_app_recommendations }

如果您打算在现场部署DHIS2 Android应用，我们强烈建议您阅读[移动实施准则]（https://docs.dhis2.org/master/zh/dhis2_android_implementation_guideline/about-this-guide.html）由UiO发布。它包括有关技术要求，安全性和配置方面以及测试和推出建议的章节。在下面，您会发现一些简要介绍的关键方面，我们建议您阅读扩展文档。

## 移动设备规格 { #capture_app_recommendations_mobile_specs }

DHIS2 Android 应用程序兼容并支持 DHIS 2 版本 2.35 至 2.37。从 2.30 到 2.34 没有重大变化。

它需要运行 Android v4.4（不推荐但支持到 2022 年 4 月）或更高版本的设备。新设备的最低推荐：Android 7 或更高版本。

在 [移动实施指南的特定部分](https://docs.dhis2.org/master/en/dhis2_android_implementation_guideline/mobile-device-specifications.html) 中，您将找到有关为 Dhis2 Android 部署购买新移动设备的建议。

## 测试和试点 { #capture_app_recommendations_testing }

如果您打算在现场部署DHIS 2 Android应用程序，则应首先在自己的配置中对该应用程序进行全面测试。

该应用程序已通过演示服务器进行了广泛测试，并且在Beta测试期间，还针对某些实际配置进行了测试。但是，我们知道，每种DHIS 2配置在很多方面都是特殊的，并且可能会导致我们无法识别的不一致。

强烈建议在试用之前在您自己的服务器中对应用程序进行全面测试。



# 贡献应用 { #capture_app_contribute }

## 如何报告错误 { #capture_app_contribute_report }


首先，请检查 [JIRA 中已报告的错误列表](https://dhis2.atlassian.net/issues/?filter=10252)

当您添加新错误时，该列表始终会更新，我们会处理它们。您需要一个有效的免费 DHIS 2 Jira 帐户。

报告错误时，请与您的描述一起指定：

- DHIS 2版本和内部版本
- DHIS 2 Android App版本
- Android OS版本
- 设备（如果可能）
- 错误日志（如果可能）

## 如何向图书馆建议图标 { #capture_app_contribute_icons }


DHIS 2和新的DHIS 2 Android App允许您为程序，数据集和选项集的选项选择图标。 DHIS 2 2.30包含125个图标。我们计划在每个以后的DHIS 2-版本上扩展图标的收集，为此我们需要您的帮助：我们正在寻找有关新图标的想法-请使用 [this form](https://forms.gle/FkUmwfZGYAScd2326).

## 如何添加翻译 { #capture_app_contribute_translations }


有助于翻译应用程序的步骤如下：

1. 在[Transifex]中创建一个帐户（https://www.transifex.com/signin/?next=/hisp-uio/）
2. 加入现有组织
3. 搜索HISP UiO，然后选择组织而不是项目
4. 选择ANDROID：捕获项目
5. 加入团队以选择语言

请告诉我们它是否无法正常运行，或者您是否需要通过向社区dhis2-android用户发送消息来添加新语言。


# 外观配置 { #capture_app_visual }

##  Local Analytics (Improved 3.0) { #local-analytics-improved-30 } 

### Data Visualizations { #capture_app_visual_data_visualizations }

The DHIS2 Android App can now render analytics that have been created in the Data Visualizer app in DHIS2. Analytics to be displayed require to be configured using the Android Settings WebApp where administrators will be able to decide the charts and tables to be displayed for end users.

To configure analytics open the Android Settings WebApp on your DHIS2 server and follow the steps below:

   1. Select Home, Program or Data set from the Analytics menu
   2. Select the visualization type "Data visualization"
   3. Click on the  "Add Visualization" button
   4. Search by typing the name of the visualization and select it by clicking on it
   5. Add an alternative title, otherwise, the app will display the name of the visualization

![](resources/images/capture-app-image162.png){ width=25%}
![](resources/images/capture-app-image164.png){ width=25%}

Analytics are created and configured using the web tools, however, the data aggregation happens offline using only data stored in the device.  

![](resources/images/capture-app-image165.png){ width=25%}
![](resources/images/capture-app-image166.png){ width=25%}
![](resources/images/capture-app-image167.png){ width=25%}

#### Analytics Types and Filters { #analytics-types-and-filters } 

The analytics supported in the Android App are:

   - 数据透视表
   - Column Chart
   - Line Chart
   - Pie Chart
   - Radar chart
   - Single Value

For each visualization object, the user will be able to filter in the app by:

   * Relative Period: Daily, Weekly, Monthly, Yearly, This Quarter, Last Quarter, Last 4 Quarters and Quarter this year.
   * OrgUnit: Select "All" to display all the org units available to the user or "Selection" to specify one or multiple org units.

![](resources/images/capture-app-image180.png){ width=25%}
![](resources/images/capture-app-image168.png){ width=25%}
![](resources/images/capture-app-image169.png){ width=25%}

A reset button will be displayed if a filter is applied. Select Reset to display the default visualization.

![](resources/images/capture-app-image170.png){ width=25%}

Users can also change The anlytics type between chart, table or single value.

![](resources/images/capture-app-image166.png){ width=25%}
![](resources/images/capture-app-image171.png){ width=25%}

#### Legends { #capture_app_visual_data_visualizations_legends }

Legends are displayed in pivot tables by enabling the feature "Use legends for chart color" in the Data Visualizer App.

The Android app will color the cells using either the pre-defined legend per data item or a single legend for the entire pivot table, depending on the settings in Web.

The style for legends in tables has a new design which ensures good contrast and visibility independently from the selected colour for the legend.

![](resources/images/capture-app-image183.png){ width=25%}

#### Groups { #capture_app_visual_data_visualizations_groups }

All these visualizations can be organised and displayed in groups. Groups are also configured using the Android Settings Webapp following the steps below:

   1. Open the Android Settings App
   2. Click to Add a new visualization in the Analytics Menu (Home, Program or Data set)
   3. Select a visualization
   4. Mark the "Use a group visualization" checkbox
   5. Create or select a created group
   6. Save the visualization

You can name your different groups, they will be displayed as a button in the top bar of the analytics screen.

![](resources/images/capture-app-image173.png){ width=25%}

#### Limitations { #capture_app_visual_data_visualizations_limitations }

Android uses tables and charts created using the web Visualizer app, however only the configuration parameters of the object are used by the Android App: data elements, indicators, chart type, title, periods...; all the aggregations are calculated offline by the android application. The results will be based on the data stored in the device at that exact moment.

Since the aggregations and calculations displayed are calculated in the device, the implementation of analytics is limited compared to web. In summary the compatible and suported objects and features are:

   - Well formed analytic objects (series, categories, filters)
   - Use of relative periods (Fix periods are not supported)
   - User has view access
   - Limitations for Pivot Tables
      - Number of header lines: 1 or 2 (from 2.3)
      - Number of header columns: 2
   - Limitations for Charts
      - Number of Series: No limit (but remember you are rendering in a small screen)
      - Number of Categories (doesn’t apply for pie chart): No limit

There are many more restrictions which apply to Android Analytics regarding the many configuration options available in the Web Visualizer as well as the supported functions and calculations related to indicators and program indicators. [This table](https://docs.google.com/spreadsheets/d/1127cz7M0K4fux5CU0V54V2Z77NZWCr0BTrZ6jcCec4Q) summarises all supported features.

> **Note**
>
> The following aggreagation functions are supported now in local analytics: LAST, FIRST, AVERAGE_SUM_ORG_UNIT, LAST_AVERAGE_ORG_UNIT, LAST_IN_PERIOD, LAST_IN_PERIOD_AVERAGE_ORG_UNIT, FIRST_AVERAGE_ORG_UNIT
> 
> 

### Event Visualizations (New 3.0) { #capture_app_visual_event_visualizations }

The DHIS2 Android App can now render analytics that have been created in the line listing app.Analytics to be displayed require to be configured using the Android Settings WebApp where administrators will be able to decide the tables to be displayed for end users.

To configure analytics open the Android Settings WebApp on your DHIS2 server and follow the steps below:

   1. Select Home or Program from the Analytics menu
   2. Select the visualization type "Event visualization"
   3. Click on the  "Add Visualization" button
   4. Search by typing the name of the visualization and select it by clicking on it
   5. Add an alternative title, otherwise, the app will display the name of the visualization 

In the app, the users will be able to search by period, Org. unit, or any of the columns added in the Line List.

![](resources/images/capture-app-image265.png){ width=25%}
![](resources/images/capture-app-image266.png){ width=25%}
![](resources/images/capture-app-image267.png){ width=25%}

#### Limitations { #capture_app_visual_event_visualizations_limitations }

To add an event visualization in the Android Settings WebApp, the table must:

- be created in the Line Listing app
- use relative periods
- not exceed 15 columns

## Interface language { #interface-language } 

The language of the interface will corespond to the language set in the DHIS2 user configuration. If the language is not available in the app, it will pick the language of the device. 

If none of the language configurations are available, the app will default to English.

Translations set up in DHIS2 for metadata will also be shown according to the language in the user configuration.

![](resources/images/capture-app-image182.png){ width=25%}


## 个性化您的图标 { #capture_app_visual_icon }

您可以使用DHIS 2 App Widget在墙纸中设置图标。该图标将是服务器中配置的标志。

![](resources/images/capture-app-image32.jpg){ width=25%}

> **注意**
>
>如何添加小部件：
>
>-长按墙纸
>-选择小部件
>-查找DHIS 2小部件
>-选择
>
>它将为您的应用添加快捷方式。

## 个性化应用程序的颜色 { #capture_app_visual_colour }

您可以通过在我们的服务器中进行配置来设置应用的通用主题：

![](resources/images/capture-app-image28.png){width=80% }

> **Note**
>
> How to set the server theme and flag:
>
> Go to **System Settings > Appearance > Style**
>
> - Select your style
>   - Green,
>   - India (Orange),
>   - Light Blue,
>   - Myanmar (red),
>   - Vietnam
> - Select your flag
>
>![](resources/images/capture-app-image23.png){ width=25%}

## Icon library for metadata (Improved 3.0) { #capture_app_visual_icon_lib }

There are currently 134 icons available that you can choose from. You can search by name in the icon picker widget. Icons are available in positive, negative and outlined shapes.

图标可以与程序，阶段，数据元素和选项集的选项相关联。这可以通过维护应用程序进行配置。

> **注意**
>
>从DHIS 2 2.30起可以使用此功能

![](resources/images/capture-app-image13.png){ .center width=80% }

In the DHIS2 Android App icons render in the home screen to illustrate all the programs available to a user, or while adding an stage. For data elements and options, the icons render for single event programs, when a section contains a single or more DEs, showing the option set as a matrix or sequence of images.

The icon based data entry can now be used in enrollment forms. When an enrollment section contains one or more Tracked Entity Attributes with option sets and icons assigned, the app is able to display them as a matrix or sequence based on the section rendering type. In previous sections of the App this feature was only available for Data elements.

![](resources/images/capture-app-image19.png){ width=25%}
![](resources/images/capture-app-image26.png){ width=25%}

From 3.0 it is possible to display custom icons in the Android App. DHIS2 (41 version) now allows uploading custom Icons to be used in addition to the built-in Icon library. This is useful for use cases not related to health or that require very specific iconography. The Android App will render the custom icons that need to be uploaded and configured using the Maintenance DHIS2 Web App.

To upload and assign the custome icons through the instance, the admin must:

1. Open the object (program, data element, option, etc.)
2. Click on the "Select icon"
3. Click on the "Choose file to upload"
4. Add a key and description
5. 保存

![](resources/images/capture-app-image290.png){ width=25%}

> **注意**
>
>图标最初只会在新的Android应用中呈现。新的基于Web的Capture App将在不久的将来将其合并。

We plan to expand the collection of icons on each future version of DHIS2 for that we need your help: we are seeking ideas for new icons - please submit yours using [this form](https://www.google.com/url?q=https://drive.google.com/open?id%3D1LmfYJQAu3KyDfkY3X6ne7qSsuTa9jXZhoQHzkDxeCdg&sa=D&ust=1557433016147000).

## 元数据的调色板 { #capture_app_visual_colour_palette }


跟踪器和事件捕获现在可以为程序，阶段，数据元素和选项集中的选项渲染颜色。维护应用程序中集成了一个颜色选择器，该颜色选择器显示为调色板，但允许选择任何颜色的选项除外。

![](resources/images/capture-app-image20.png){ .center width=80% }

在Android App中，该颜色将与带有图标（如果已选择）组合的程序和阶段显示为背景色。对于选项，它在单个事件程序的数据输入表单期间呈现为背景色。当用户选择具有指定颜色的程序时，该颜色将成为该程序域中所有屏幕的背景主题。

![](resources/images/capture-app-image19.png){ width=25%}
![](resources/images/capture-app-image2.jpg){ width=25%}

> **注意**
>
>颜色将首先在新的Android应用程序中可用，然后在以后的版本中将发布新的基于Web的Capture App。

## 程序部分的渲染类型 { #capture_app_visual_rendering_type }


![](resources/images/capture-app-image16.png){width=80% }

**Program Section**: when used in combination with icons, a Program Section with one or more data elements and associated Option Sets can render the options in sequential or matrix layout (see screenshots). If the icon is not found, the app displays the DHIS logo.

![](resources/images/capture-app-image26.png){ width=25%}
![](resources/images/capture-app-image36.png){ width=25%}

From 2.8, the app will render option set with any value type as matrix or sequential layout.

![](resources/images/capture-app-image226.png){ width=25%}
![](resources/images/capture-app-image227.png){ width=25%}

> **注意**
>
>区域的渲染类型将首先在Android应用程序中提供，然后在以后的版本中提供新的基于Web的Capture App UI。

## 日历 { #capture_app_visual_calendar }


现在可以使用两个不同的日历。左边的是第一个出现的，但是您可以通过单击左下角的日历图标来更改它。

在以下情况下可用：

1. 进行新的注册。
2. 创建一个新事件（带有和不带有注册的程序）。
3. 在注册和不注册的情况下在数据集和程序中使用周期过滤器。

![](resources/images/capture-app-image60.jpg){ width=25%}
![](resources/images/capture-app-image61.jpg){ width=25%}

> **注意**
>
>对于Android 4.4、5.1版和小型设备，“接受”选项在第二个日历视图中不可见。

## 渲染类型 { #capture_app_visual_render }

The available rendering options have been expanded to include horizontal and vertical radio buttons, checkboxes and toggles for any value type.

![](resources/images/capture-app-image111.png){ width=100%}
![](resources/images/capture-app-image224.png){ width=25%}
![](resources/images/capture-app-image225.png){ width=25%}

> **Note** 
>
> The default rendering option will automatically display a search box whenever there are more than 15 elements in the option set to ease the selection.
> 
> ![](resources/images/options_no_search.png){ width=25% } ![](resources/images/options_search.png){ width=60% }

Render types are available in event and registration forms

### QR和条形码 { #capture_app_visual_render_qr }


Data elements or attributes type text can be also configured as QR or barcodes. When a Data Element or Attribute is rendered as QR/Barcode, the app will open the device camera to read the code image. When the QR/Barcode is a TEI attribute configured as searchable, the user will be allowed to scan the code in order to search and identify the Tracked Entity Instance. This will also work for option sets.

Barcodes also allow the user to manually enter the value.

![](resources/images/capture-app-image118.png){ width=20%}
![](resources/images/capture-app-image119.png){ width=20%}
![](resources/images/capture-app-image120.png){ width=20%}
![](resources/images/capture-app-image121.png){ width=20%}


#### Export/Share { #exportshare } 

Users are now able to display a bar or QR code in an image so that it can be shared for printing, take a screenshot or show it on the screen for scanning.

Non-editable fields can still share the bar or QR code, but will prevent the user from capturing a new one.

![](resources/images/capture-app-image181.png){ width=20%}
![](resources/images/capture-app-image174.png){ width=20%}

#### GS1 Data Matrix codes { #capture_app_visual_gs1 }

If an attribute or data element rendering type is configured as QR code, the Android App will be able to read and process the string as GS1 Data Matrix codes.

Combined with the use of d2 functions in program rules, the different fields of a GS1 code can be saved into different data elements or attributes (d2:extractDataMatrixValue(key, dataMatrixText)).

![](resources/images/capture-app-image184.png){ width=20%}
![](resources/images/capture-app-image200.png){ width=20%}

### Signature (Improved 3.0) { #capture_app_visual_signature }

This feature allows users to collect handwritten signatures from the device. The signatures will be saved as an image data element in the app.

This configuration must be done in web ( available from 2.40 version) by selecting the "canvas" rendering type on an image value type.

![](resources/images/capture-app-image231.png){ width=20%}
![](resources/images/capture-app-image232.png){ width=20%}

From 3.0, signatures are allowed to be opened in full screen for better visibility.

## User Experience { #capture_app_visual_user_experience }

### Tappable areas in icons and buttons { #capture_app_visual_tappable_areas }

Some buttons or tappable labels of the Android App had small sensitive areas for the user to tap. The whole user interface was reviewed and the tappable areas has been increased. For example the "+" button to create a new stage or the "˅" icon to open TEI details or expand a section.

![](resources/images/capture-app-image208.png){ width=20%}

### Loading Banners { #capture_app_visual_loading_banners}

The Android App provides visual animations to users when they perform actions that take longer than usual to complete, such loading maps or searching, so that they know that the system is processing their request.

![](resources/images/capture-app-image228.png){ width=20%}

### Offline Buttons { #capture_app_visual_offline_buttons}

This feature enhances the functionality of the app when it is used offline, ensuring that menus are disabled when the online actions are not available.

### Long Texts Management { #capture_app_visual_longtext_management}

The Android App enables users to view long text in fields that are limited in size, such as a stage names or datasets headers.

### Legends (Improved 3.0) { #capture_app_visual_legends_descriptions}

The Android App displays the full description of the legend when tapping on the information icon once a legend is active. These feature is available only in event and registration forms.

![](resources/images/capture-app-image276.png){ width=25%}
![](resources/images/capture-app-image277.png){ width=25%}

### Input fields (Improved 3.0) { #capture_app_visual_input_fields }

The new input fields are now displayed by default in the Android app and admin users are able to opt-out to use the old forms through the Android Settings web app.

![](resources/images/capture-app-image289.png){ width=25%}


# 设定值 { #capture_app_settings }

![Settings window](resources/images/capture-app-image17.png){  width=25%}

Sync data
:   User is able to choose from a drop-down list if the data entered in the app is uploaded to the server manually or scheduled every 15 min, 1 hour or 1 Day. By default the app will sync every 24h. This kind of Syncing includes new and updated events and TEI’s.

Sync configuration (also known as sync metadata)
:   User is able to choose from a drop-down list  if the data entered in the app is uploaded to the server manually or scheduled every day or week. By default the app will sync every 24h.  This sync will update changes in programs or configurations in web.

Sync parameters
:   These parameters allow the user to specify the maximum number of TEI’s and events that can be stored in the local device. The user can also specify if limits apply per organisation unit or in total. Values can be set to default by clicking on “Reset to default”.

> **Note** 
>
> Sync data, Sync configuration and Sync parameters can be overwritten using the Android Settings Web App as described [in the specific section][#capture_app_andoid_settings_webapp_synchronization]
>
>

Reserved values
:   This will specify the number of reserved Id's available in your device and will allow you to refill them.

Open sync errors log
:   The sync error log gives details about the error and is prepared to be shared with admins.

Export database (New 3.0)
:   Users are now be able to export the local database and share it with an admin, who will be able to import it for troubleshooting, being able to replicate the exact environment (database, device, configuration). The exported database is encrypted and the administrator will require the user credentials to be able to access the database

![](resources/images/capture-app-image260.png){ width=25%}

The import button can be found by tapping on the tree dots menu at the login screen.

![](resources/images/capture-app-image261.png){ width=25%}

Delete local data
:   This action will delete local data without having to log out.

> **Warning** 
>
> Using this functionality might lead to data loss if changes have not been previously synced to the server.
>
>

Reset app data & configuration
:   This action will log out the user and delete all data and metadata, this means user and server information is also deleted. It is similar to resetting the App.

> **Warning** 
>
> Using this functionality might lead to data loss if changes have not been previously synced to the server.
>
>

SMS Settings
:   This sections allows to check or edit the parameters related to the sms gateway.

Software Update
:   This feature enables implementation administrators to manage and control the version of the Android app from the DHIS2 user web interface, making it easier to manage app updates and ensure compatibility with the DHIS2 system. Managers will be able to upload the desired version and users will get a prompt message to update when they are not in the last updated version. The management of versions is made through a new Web App.

![](resources/images/capture-app-image229.png){ width=25%}


# 通用功能 { #capture_app_generic }

## 登录 { #capture_app_generic_login }

有两种访问应用程序的方法：

1. 手动：用户必须输入要使用的服务器的相应URL，然后输入用户名和密码。

    > **Note**
    >
    > Take note that login is only possible with servers from version 2.29.

2. QR: The user can use a QR code instead of typing the URL but username and password must be entered manually.

![](resources/images/capture-app-image63.png){ width=25%}

> **Note**
>
> 1. After a succesful login the DHIS2 Android App will keep these values cached (URL and username) and will suggest them for future connections without having to type them.
>

After a succesful login the user should be able to perform an *offline* login only (only avaialble for the last combination of URL/Username). Offline usage gives the possiblity of using the application withou any type of connectivity. All data will still be stored and user can perform a synchornization once the connection is restablished or avaialble.


> **Warning**
> 
> In DHIS2 versions up to 2.30 if a user attemps an on-line login and their account has been disabled as explained in the [DHIS 2 Manual - Disable User](https://docs.dhis2.org/master/en/user/html/dhis2_user_manual_en_full.html#disable_user) all the data will be wiped from the phone. Make sure that before disabling a user all the data has been synced or that you are using this feature to remotely wipe sensitive data in case of a device getting lost.
>
> Due to a change in the login API this feature is not available in 2.31, 2.32, 2.33, 2.34, 2.35 and 2.36.

## Offline Multi-user { #capture_app_generic_multiuser}

The Android app have removed the limitation on the number of offline accounts that users can create, allowing them to work with as many offline accounts as needed.

The users will need to have access to the internet for the first login of each account and will be able to switch accounts after without requiring access to the Internet.

![](resources/images/capture-app-image185.png){ width=25%}
![](resources/images/capture-app-image186.png){ width=25%}

The users will be able to manage the user accounts and delete accounts if needed.

![](resources/images/capture-app-image187.png){ width=25%}
![](resources/images/capture-app-image188.png){ width=25%}
![](resources/images/capture-app-image189.png){ width=25%}
![](resources/images/capture-app-image190.png){ width=25%}

## 帐户恢复 { #capture_app_generic_recovery }

如果用户启用了以下设置，则他们将能够恢复自己的密码：已启用用户帐户恢复。

![](resources/images/capture-app-image64.png){ width=25%}

## 阻止会话（PIN） { #capture_app_generic_PIN }

用户可以使用4位PIN锁定会话。这样一来，您便可以移至手机中的其他应用，而无需删除本地数据。
如果用户忘记了PIN码，也可以通过输入凭据登录。

![](resources/images/capture-app-image65.png){width=25%}

## 指纹 { #capture_app_generic_fingerprint }

如果设备中的功能被激活，则用户可以使用指纹扫描仪。

* 启用指纹扫描器而不启用PIN时，每次应用关闭，进入后台或设备被阻止时，会话将被锁定。一旦再次打开该应用程序，用户需要点击指纹图标以激活扫描仪。
* 如果设置了PIN和指纹，则在会话被锁定并且用户再次打开应用程序时，将询问PIN。

![](resources/images/capture-app-image104.jpg){width=25%}
![](resources/images/capture-app-image105.jpg){width=25%}

## 说明/信息按钮 { #capture_app_generic_instructions }

A contextual guide is available in TEI dashboard screen.

![](resources/images/capture-app-image66.png){width=25%}

> **提示**
>
>用户可以通过单击屏幕右上角的三个点来重新打开说明<!-- PALD: unnecessary: (trigger)-->。

## 过滤 { #capture_app_generic_filter }

A filter can be applied in all listing screens (home, event listing, tei search and dataSets) which narrows down the data displayed. The filters available are: period, org. unit, sync state, event status, category option combination and "assigned to me".

![](resources/images/capture-app-image19.png){ width=25%}
![](resources/images/capture-app-image123.png){ width=50%}
![](resources/images/capture-app-image134.png){ width=25%}

Filters will adapt to the different programs and data sets.

1. Program without registration: Date, Org. Unit, Sync State, Event Status and, Category Combination.
2. Program with registration: Event Date, Date of enrollment, Org. Unit, Sync, Enrollment Status, Event Status and Assigned to me. The filter icon will show only if a list of events is available (Display front page list feature or search)
3. Data Sets: Period, Org. Unit, and Sync State.

### Assigned to me { #capture_app_generic_filter_assigned }

It is possible to filter events based on its assignment to the current user. The “Assigned to me” filter has been added to the single event program list, the TEI list and the TEI Dashboard and the map views. It will only be displayed when the active program is configured to assign events to users.

### Event Date/Date/Period { #capture_app_generic_filter_date }

Filter the Events, TEIs(based on their events) and data sets, the following periods of time are availables:
- Today
- This week
- This month
- Yesterday
- Last week
- Last month
- Tomorrow
- Next week
- Next month
- From-to
- Other (Opens a date picker)
- Anytime

### Org. Unit { #capture_app_generic_filter_orgunit }

Allows the user to type the search or select an organisation unit from the tree. The filter will not be visible if the user has only one Organisation Unit configured.

### Sync { #capture_app_generic_filter_sync }

Filer by:
- Synced (events, TEIs, Data Sets)
- Not Synced
- Sync Error
- SMS Synced

### Event Status { #capture_app_generic_filter_event }

Filter the events by:
- 打开
- Schedule
- Overdue
- 已完成
- Skipped

Multiple status selection is permited. Once you open a TEI, the filter will be kept in the dashboard and show only the events with the selected status.

Events shown are up to 5 years old.

### Date of Enrollment { #capture_app_generic_filter_date_enroll }

The 'Date of Enrollment' will apply to the Enrollment date of the TEI in the program. If there is more than one enrollment date, it should sort the results by the most recent one. The label of this filter will display when available.

### Enrollment Status { #capture_app_generic_filter_enroll_status }

The filter 'Enrollment status' offers three options: Active, Completed, Cancelled. Only one option can be selected at time. If you filter by "completed" and the TEI has more than one enrollment, the app will open the "active"  enrollment. To see the completed one, select the three dot menu at the top right corner of the dashboard and select "program enrollments".

### Follow-Up { #follow-up } 

The 'Follow Up' filter allowes the user to filter out the TEIs that have been marked as 'Follow-up'. TEIs can be marked to be followed up in the TEI Dashbaord.

### Filtering added in TEI Dashboard: { #capture_app_generic_filter_tei }

Filters have been added to the TEI dashboard. It is possible to filter the events of a Tracked Entity Instance enrollment per period, organisation unit, sync status, event status, and user assignment.

![](resources/images/capture-app-image114.png){ width=25%}

## 排序 { #capture_app_generic_sorting }

Sorting has been integrated in the filter menu.

The sorting button will be on the filter bars with the following behavior:
- Only one sorting applies at a time. If the user clicks a different one, the previous one is disabled.
- The icon for applied sorting shows it is active, the others are inactive.  
- Repeated clicks keep changing the order to the reverse.

![](resources/images/capture-app-image135.png){ width=25%}

### Dates (Period, Date, Event Date or Enrollment Date) { #capture_app_generic_sorting_dates }

- Event Date preceds due date, only use due date when there is no event date.
- Order from most recent to less recent. Future events (due date) goes first.

### Org. Unit { #capture_app_generic_sorting_orgunits }

- List will be sorted in alphabetical order by org unit name.

### Enrollment Status { #capture_app_generic_sorting_enrollment }
- List will be sorted in alphabetical order by status name.

![](resources/images/capture-app-image123.png){ width=100%}

## Sync Information { #capture_app_generic_sync_info }

### Login Sync {#capture_app_generic_login_sync}

During the metadata download, the app will remain in the splash screen and will open the home screen once the metadata is in the device.

In the home screen, the app will inform with a loading spinner on each program when the data is downloading. After the sync process finishes, the app will display one of the two possible icons:

* A green checkmark if the program downloads data successfully and without errors (the icon will disappear after three seconds)  or,
* A gray arrow if there is an error during the sync process and the total or partial data isn't donwloaded

The user will be able to see how many programs are downloading data, or completed, making the waiting process more transparent and informative about its progress.

![](resources/images/capture-app-image207.png){ width=20%}

**NOTE:** All programs and data sets will be blocked until the sync process is fully finished.

### Subsequent logins {#capture_app_generic_subsequent_login}

The application will launch a sync process for data and metadata only for the first time the user logs in. In order to facilitate the work in the most difficult cases, the sync process have been removed for the subsequent logins. This means that when the user opens the app, it will open without performing a full sync even if the user logs out of the account.

If the user deletes the account, then the next login will launch the sync process.

Also, users have the option to sync with the server through the Refresh button any time they wish.

### Sync Status {#capture_app_generic_sync_status}

Next to each program or data set an icon will be displayed which allows the user to check sync information. Synced records will not show display any icon. Unsynced (grey arrows), error (red arrows), warning (orange) or SMS (blue and including the SMS word inside) icons are be displayed according to the status.

![](resources/images/capture-app-image67.png){ width=20%}
![](resources/images/capture-app-image69.png){ width=20%}
![](resources/images/capture-app-sync-status.png){ width=20%}

### 细粒度同步 { #capture_app_generic_sync_granular }

Users can click on the grey arrows (which means record(s) stored online in the device) to perform a sync. These options are available at top level (programs/dataset) or individually (TEI, events, datavalues).

![](resources/images/capture-app-image89.png){ width=25%}
![](resources/images/capture-app-image161.png){ width=25%}


### 短信同步 { #capture_app_generic_sync_sms }

When there is no Internet conection (either via WiFi or Mobile Data) but there is still mobile conectivity, users can synchronize via SMS if the gateway has been previously established in the app and properly configured at server level. 

If the app has been downloaded from Google Play users will have to send manually the SMS from their default SMS app (their default SMS application will open with the message composed). Users should send the message without modifying it and then switch back to the DHIS2 app to confirm that the message was sent.

![](resources/images/capture-app-sms-sync.png){ width=25%}
![](resources/images/capture-app-sms-sync-default-app.png){ width=25%}
![](resources/images/capture-app-sms-sync-confirm.png){ width=25%}

However, if the app has been downloaded from Github (or the training version is being used) the App will just ask for a confirmation to send one or several messages (SMS) and will send them in the background (without opening the default SMS application).

![](resources/images/capture-app-sms-sync-training.png){ width=25%}
![](resources/images/capture-app-sms-sync-confirm-training.png){ width=25%}
![](resources/images/capture-app-sms-synced-training.png){ width=25%}

> **Tip**
>
>  Edit parameters related to SMS gateway in the SMS Settings (Settings Menu) or set this globally via the [#capture_app_android_settings_webapp_general](Android Settings Web App)

![](resources/images/capture-app-image90.png){ width=25%}

> **Note**
>
>  Note that in order to user the SMS sync capabilities the SMS services needs to be enabled in the server side as described in the [https://docs.dhis2.org/master/en/dhis2_user_manual_en/mobile.html#sms-service](oficial documentation). You can also find more information on how to use different gateways in the [https://docs.dhis2.org/master/en/dhis2_android_implementation_guideline/about-this-guide.html](Android Implementation Guidelines)

### 元数据同步错误 { #capture_app_visual_sync_error }

如果在同步过程中出错，则会在设置菜单中显示一条消息（“同步数据”或“同步配置”部分）。此外，在主屏幕中，该程序旁边会显示一个红色的同步图标。同步错误日志提供了有关错误的详细信息，并准备与管理员共享。

![](resources/images/capture-app-image43.jpg){ width=25%}
![](resources/images/capture-app-image11.png){ width=25%}

您也可以从**设置**中打开同步错误日志：

![](resources/images/capture-app-image15.jpg){ width=25%}

## Refresh data { #capture_app_generic_refresh_data }

Users can now retrieve the latest data from the server before entering new data. A refresh button is now located to trigger a granular synchronization in the following screens:

* 首页
* 搜索
* TEI dashboard
* Event program listing
* Event details
* Data set listing
* Data set details

![](resources/images/capture-app-image19.png){ width=25%}
![](resources/images/capture-app-image191.png){ width=25%}
![](resources/images/capture-app-image192.png){ width=25%}
![](resources/images/capture-app-image193.png){ width=25%}

## 组织单位 { #capture_app_generic_orgunit }

![](resources/images/capture-app-image30.png){ width=25%}

The whole organisation unit tree is displayed. Organisation units not available for data entry will be colored in grey.
User must check the box to select the org unit wanted. After an organisation unit is selected, the parents will be marked in bold to show hint of the organisation unit selection when opening the hierarchy.

![](resources/images/capture-app-image194.png){ width=25%}

> **注意**
>
>不希望移动用户访问组织。整个国家的单位层次结构。组织单位的最大数量很难设置，因为应用程序没有设置限制，而是设备（内存，处理器）上的资源。我们可以说低于250个单位部门应该是安全的，但仍然认为对于移动用例来说这是一个很大的数字。


## 数据集 { #capture_app_generic_datasets }

用户现在可以输入组织单位，期间和一组数据元素的汇总数据，并将其发送到服务器。

![](resources/images/capture-app-image87.png){ width=25%}
![](resources/images/capture-app-image93.png){ width=25%}
![](resources/images/capture-app-image92.png){ width=25%}


## Home {#capture_app_home}

The home screen of the DHIS2 Android App shows the list of programs and data sets available for the user. The first thing the user does when collecting data in this case is to select the program or data set to work with.


![](resources/images/capture-app-image87.png){ width=25%}

> **提示**
>
>区分它们的一种简单方法是查看左下角的单词。 “事件”一词将始终存在于事件程序中。在跟踪器中将出现被跟踪实体类型的名称（人，患者，建筑物等）。对于数据集，单词“ DataSets”将显示在记录数旁边。

For those implementations where the users have access to only one program or dataset, the App will skip the home and will open directly the program or datasaset screen with the event, TEI or dataset list to reduce the number of clicks and streamline the process of data entry.

![](resources/images/capture-app-image245.png){ width=25%}
![](resources/images/capture-app-image247.png){ width=25%}

## 共享资料 { #capture_app_generic_shargin }

Users can share TEI via QR codes. This allows transferring/sharing information between devices without the need of transferring via the server (useful when connecitivity might be missing). To do this users should open any TEI and click on the *SHARE* button.

![](resources/images/capture-app-image72.png){ width=25%}
![](resources/images/capture-app-image73.png){ width=25%}


## 捕捉坐标 { #capture_app_generic_capture_coord }

### TEI坐标 { #capture_app_generic_capture_coord_tei }

在注册表中获取TEI坐标。在TET功能类型中启用此功能。

![](resources/images/capture-app-image94.png){ width=25%}

### 多边形 { #capture_app_generic_capture_coord_polygons }

该应用程序现在支持geoJSON格式，并且用户能够捕获多边形。

![](resources/images/capture-app-image95.png){ width=25%}


## 图片 { #capture_app_generic_images }

ValueType image can be used in Android to capture data and also, depending on the program configuration to be displayed in the TEI dashboard. When this value type the first data element/attribute marked as displayed in the program configuration it will be used as the TEI profile image.

![](resources/images/capture-app-image99.png){ width=25%}
![](resources/images/capture-app-image98.png){ width=25%}
![](resources/images/capture-app-image100.png){ width=25%}

Open the TEI profile image by clicking on it.

![](resources/images/capture-app-image138.png){ width=25%}


## 在地图中显示事件和TEI { #capture_app_generic_display_events }

When a program stage or tracked entity type have a feature type (and for programs with registration the option displayFrontPageList is enabled) the listings can be switched to display the information in a map. Make the switch by clicking on the map icon in the navigation panel.


![](resources/images/capture-app-image101.png){ width=25%}
![](resources/images/capture-app-image102.png){ width=25%}

If the TEI has a profile image, the map will display it.

![](resources/images/capture-app-image103.png){ width=25%}

## Personalized Calendar View { #capture_app_personalized_calendar }

In the DHIS2 Android Capture App users can switch date selection from spinner to calendar view. In this version, the app will remember the last visualization selected by the user and use it the next time the user needs to select a date.

![](resources/images/capture-app-image177.png){ width=25%}

## Reason for non-editable data { #capture_app_reason_non_editable }

Data can be blocked for many reasons in DHIS2, because of access restrictions or expiration among others. When an Event, TEI or Data Set are not editable the user will be able to find the reason on the "Details" section.

The following list contains all possible reasons:

* Event completion
* Enrollment completion
* Expired event
* Closed organization unit
* Organization unit out of capture scope
* No access to capture data in the program or data set
* No access to a category option in the program or data set

![](resources/images/capture-app-image178.png){ width=25%}
![](resources/images/capture-app-image179.png){ width=25%}

## Configuration troubleshooting { #capture_app_configuration_troubleshooting }

This feature is for administrators. The Android App incorporates an option in the settings screen for verifying some aspects of the DHIS2 configuration.

![](resources/images/capture-app-image188.png){ width=25%}
![](resources/images/capture-app-image195.png){ width=25%}

* **Language:** the user will be able to change the language of the application user interface to identify labels, buttons or prompts with errors or without translation.

![](resources/images/capture-app-image196.png){ width=25%}
![](resources/images/capture-app-image197.png){ width=25%}

* **Program rule validation:** this validator will check the program rules in the device and display configuration inconsistencies.

![](resources/images/capture-app-image198.png){ width=25%}
![](resources/images/capture-app-image199.png){ width=25%}

## Error Navigation { #capture_app_error_navigation }

The Android App has improved the navigation of sync errors on the user interface. The app will display the sync errors in a simple and clean manner allowing the user to navigate from the home screen to the exact field that is causing the error inside the event or data set.

![](resources/images/capture-app-image217.png){ width=25%}

User must tap on any of the errors listed and the app will move to the correspondent screen. Once the error is located and fixed, the user can synced by tapping on the "Refresh" button.

![](resources/images/capture-app-image218.png){ width=25%}
![](resources/images/capture-app-image219.png){ width=25%}
![](resources/images/capture-app-image220.png){ width=25%}

## LMIS Module { #capture_app_lmis_module }

The new module for real stock monitoring use case enables users to manage and monitor their stock levels in real-time. Integrating a module implies that the app will open a completely new and different user interface and experience to respond to a different data entry flow. To use this modules the program will need to be configured using the new web app for program use case configuration.

![](resources/images/capture-app-image221.png){ width=25%}
![](resources/images/capture-app-image222.png){ width=25%}
![](resources/images/capture-app-image223.png){ width=25%}



# Data sets { #capture_app_datsets }

### Data Entry {#capture_app_data_sets_data_entry}

While entering data the new text input dialog opens an input field above the keyboard which shows the Data Element name, and category options of the field being selected, ensuring the user does not lose context when navigating the tables.

![](resources/images/capture-app-image213.png){ width=25%}

![](resources/images/capture-app-image214.png){ width=25%}


### Navigation Bar { #capture_app_data_sets_navigation_bar }

Use the navigation bar located at the bottom of the data set to switch between the data entry form and the overview screen.

![](resources/images/capture-app-image139.png){ width=25%}

### Overview Screen { #capture_app_data_sets_overview_screen }

新的概述标签包含以下详细信息：

- 数据集名称
- 最后更新
- 开/关状态
- 期
- 组织单位
- 类别选项组合
- Refresh button (To trigger a granular synchronization)

![](resources/images/capture-app-image122.png){ width=25%}

### Saving a data set { #capture_app_data_sets_saving }

验证规则和数据集完成功能集成在保存按钮操作中：

- When a Data set is configured to *complete only if validation passess*. If the validation is successful, a dialog asking to mark as complete will show up. The App will allow completion only if all mandatory fields have value.

![](resources/images/capture-app-image131.png){ width=25%}

- 如果失败，则将显示错误对话框，并且数据集将不会标记为已完成。将显示验证规则的描述和说明，以帮助用户识别错误。

![](resources/images/capture-app-image128.png){ width=25%}

- On a dataset that does not have setup "Complete allowed only if validation passes". When clicking on the save button; if the data set has validation rules associated to it, then the app will ask the user to run the validation rules.

![](resources/images/capture-app-image130.png){ width=25%}

- 如果验证不成功，将显示一个错误对话框，但是仍然有可能完成数据集。将显示验证规则的描述和说明，以帮助用户识别错误。

![](resources/images/capture-app-image129.png){ width=25%}

- If the data set does not have validation rules, the data set will be marked as complete if all mandatory fields have value.

### Increase Row and column Headers { #capture_app_data_sets_row }

Users are now allowed to resize the row headers and columns in datasets, making it easier to view and work with larger tables.

To resize any column, tap on its header and then drag and drop until the desired size. A maximum and minimum size limit is given for the columns that can be resized to ensure a good layout.

If the column have multiple headers, the resizing will be available only for the child header (lowest level). Users can also resize all collumns at once by clicking on the top left of the table.

![](resources/images/capture-app-image215.png){ width=25%}

![](resources/images/capture-app-image216.png){ width=25%}

### Indicators { #capture_app_data_sets_indicators }

Indicators are now available in default and section forms and are displayed at the bottom of the data entry form.

![](resources/images/capture-app-image140.png){ width=25%}

### Cards design { #capture_app_datsets_cards_design }

The new design of cards offers a cleaner and more intuitive layout replacing the use of coloured icons by explicit text when relevan.

#### Main changes { #capture_app_datsets_cards_design_main_changes }

**Sync button:** It now appears as a button at the bottom of the card and it is only displayed if there are unsynced data or an error or warning after a sync.

**Completion status:** After the data set is completed, the app will add a label in each card to specify the completion status.

![](resources/images/capture-app-image237.png){ width=25%}

## 支持的功能概述 { #capture_app_datsets_supported_features }


以下是DHIS2中可用于数据集的所有功能的完整列表，并说明这些功能是否已在Android Capture应用中实现。

在注释中，“管理员”是指开发和配置DHIS2系统的人员，“用户”是指使用应用程序捕获数据，更新数据并查看报告的人员。

|传说|描述|
|:--:|:------|
|![](/en/resources/images/admin/icon-complete.png)|功能已实现|
|![](/en/resources/images/admin/icon-incomplete.png)|未实现功能&nbsp;（将被忽略）|
|![](/en/resources/images/admin/icon-na.png)|不适用|
|![](/en/resources/images/admin/icon-wip.png)|工作正在进行中。该功能尚未完全实现，或者已经报告了异常行为。|


|特征|功能说明|状态|实施注意事项|
|-|---|:-:|---|
|期间类型|确定数据输入所涵盖的时间段。|![](/en/resources/images/admin/icon-complete.png) | |
|有效期|设置DHIS2在该期限内锁定所有数据输入的期限（期限后的天数）（0表示完全没有锁定）。期间仍然可以打开，但是单元格将变灰。| ![](/en/resources/images/admin/icon-complete.png) | |
|开放未来的数据录入期|此设置可用于解锁当前期间或直到将来某个特定点的所有期间。|![](/en/resources/images/admin/icon-complete.png) | |
|数据输入期|允许您为期间的数据输入设置特定日期范围，并防止捕获该日期范围以外的期间的数据。|![](/en/resources/images/admin/icon-complete.png) | |
|期满后有资格及时提交的天数|设置DHIS2将数据输入视为“迟到”的截止日期（周期后的天数）。| ![](/en/resources/images/admin/icon-complete.png)| |
|[属性]类别组合|允许管理员将类别（选项集）附加到数据集，为每个选项生成一个单独的数据输入屏幕（在DHIS2中称为属性类别组合）。| ![](/en/resources/images/admin/icon-complete.png)| |
|[属性]类别组合选项限制|如果使用了“属性类别组合”（请参见上文），则此功能使管理员能够限制下拉菜单中可用的特定选项。每个选项都可以限制在特定的日期和/或组织单位范围内，如果在这些日期或组织单位之外捕获数据，则不会显示该选项。| ![](/en/resources/images/admin/icon-complete.png)||
|完整的通知收件人|当数据集标记为“完成”时，向选定的用户组发送DHIS2消息。|![](/en/resources/images/admin/icon-incomplete.png)| |
|发送通知给完成的用户|当数据集标记为“完成”时，向数据输入用户发送DHIS2消息。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据元素的所有字段必填|如果使用一个或多个类别来分解数据元素，则此设置将强制用户完成所有分解，或者将其全部留空。|![](/en/resources/images/admin/icon-complete.png) | |
|仅在验证通过后完成|如果未触发验证规则，则仅允许将数据集标记为完整。|![](/en/resources/images/admin/icon-complete.png)| |
|离线跳过|如果值留为空白（或数据集无法“完成”），则要求用户添加“注释”。仅允许在连接到Internet时选择用于数据输入的数据集（尽管选择后，数据输入可以脱机继续）。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据元素装饰|当鼠标悬停在数据元素名称上时，显示数据元素的描述。|![](/en/resources/images/admin/icon-complete.png) | |
|剖面图-将剖面显示为选项卡|将表单中的每个部分显示为单独的选项卡，而不是在同一页面上一起显示。|![](/en/resources/images/admin/icon-incomplete.png)| |
|剖面图-垂直渲染||![](/en/resources/images/admin/icon-incomplete.png)| |
|数据元素-CatCombos|使单个数据元素能够自动分类为一个或多个类别（例如，男性/女性和儿童/成人），并为每种分类分别收集单独的字段/值。|![](/en/resources/images/admin/icon-complete.png)| |
|内联指标/部分表格总计|使每个数据元素的默认CatCombo可以仅对此数据集使用不同的CatCombo覆盖。|![](/en/resources/images/admin/icon-complete.png)| |
|剖面图-将剖面显示为选项卡|向数据集添加指标使它们可用于部分表格和自定义表格；行和/或列的总数也可以添加到这些表格中。 （两者都在屏幕上与数据捕获单元格一起显示，并在捕获值时自动更新。）|![](/en/resources/images/admin/icon-incomplete.png)| |
|组织单位分配|确保数据集仅可用于已分配了该数据集的组织单位。|![](/en/resources/images/admin/icon-complete.png) | |
|必修数据元素|这样就可以将特定的Data Elements / CatCombos标记为“必填”，这意味着用户必须输入一个值（不能留为空白）。| ![](/en/resources/images/admin/icon-complete.png)| |
|表格-默认表格|DHIS2自动将表单呈现为表格，每当类别组合更改（=不同的列标题）时都会启动一个新表格。|![](/en/resources/images/admin/icon-complete.png) | |
|表格-部分表格|可以指定表单节和节标题，从而使您可以更好地控制表单的分组和布局（但仍会自动呈现）。如果实施，此部分表单将自动覆盖默认表单。|![](/en/resources/images/admin/icon-complete.png) | |
|表格-自定义表格|可以设计自定义HTML表单，以完全控制布局，并使JavaScript代码可以包含在表单中。如果实现，此自定义表单将自动覆盖默认表单和部分表单。|![](/en/resources/images/admin/icon-incomplete.png)| |
|部分表格-禁用字段（灰色）|使用截面表单，您可以单独“灰显”字段（整个数据元素或特定的CatCombo选项），以便用户无法在其中输入数据。|![](/en/resources/images/admin/icon-complete.png) | |
|多组织单位表格|启用此服务器设置后，表单布局将更改为将多个组织单位显示为行，并将所有数据元素/ CatCombos显示为列（即，每个组织单位的宽度和宽度都非常平坦）。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据值弹出窗口：后续标记值|使用户可以标记此特定数据值以进行跟踪（可以在“数据质量” Web应用程序中查看标记的值）。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据值弹出窗口：为值添加注释|允许用户向此特定数据值添加注释。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据值弹出窗口：显示数据元素历史记录|显示此特定数据元素随时间的历史记录（即以前12个月的值）。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据值弹出窗口：显示审核记录|显示以前对此特定数据值进行编辑的历史记录。|![](/en/resources/images/admin/icon-incomplete.png)| |
|数据值弹出窗口：最小/最大范围（也可以通过数据管理应用访问）|这使用户能够设置数据元素的最小和最大期望值，从而使DHIS2可以在数据输入过程中突出显示该范围之外的值（但不会阻止保存或“完成”）。您可以自动/批量（通过“数据管理”应用程序）或手动/单独（通过“数据输入”应用程序）设置最小/最大范围。|![](/en/resources/images/admin/icon-incomplete.png)| |
|打印表格/打印空白表格|允许打印数据输入表单，以允许在纸上捕获数据，以及稍后进行数据输入。|![](/en/resources/images/admin/icon-incomplete.png)| |
|保存数据|输入到屏幕的数据只有在“保存”后才会被捕获-在此之前，它仅保存在内存中，并且在关闭电源等情况下会丢失。|![](/en/resources/images/admin/icon-complete.png)| |
|完整的数据集|这使用户可以将期间/组织单位/等的数据输入标记为“完成”。请注意，这仅用于数据输入跟踪和及时性目的，并不锁定数据集或阻止进一步的编辑。|![](/en/resources/images/admin/icon-complete.png)| |
|数据元素：验证规则|基于比较不同的值/值集合，允许创建规则（在数据元素级别）以增强数据质量。 （例如，当月见到的患者人数必须少于该月的就诊人数。）|![](/en/resources/images/admin/icon-complete.png)| |
|数据共享级别/可以捕获数据|允许用户在数据集中添加新值，编辑值和删除值。|![](/en/resources/images/admin/icon-complete.png) | |
|数据共享级别/可以查看数据|使用户能够查看数据集中的值。|![](/en/resources/images/admin/icon-complete.png) | |
|数据共享级别/无访问权限|用户将无法看到数据集。|![](/en/resources/images/admin/icon-complete.png) | |
|数据批准工作流程|如果管理员选择了预先配置的数据批准工作流程，它将用于执行“批准”或“接受和批准”级联，从而使用户可以签名和锁定数据。|![](/en/resources/images/admin/icon-complete.png) | 批准过程必须通过网络进行。数据集获得批准后，该数据将不再可在应用程序中进行编辑。 |
|缺少值需要评论完整|任何缺失的值都需要添加注释以证明其缺失。|--||



# 程式 { #capture_app_programs }

## Event and Tracker common features { #capture_app_common_features }

### Navigation Bar { #navigation-bar } 

Use the bottom navigation bar to move from one screen to another.

#### Event Dashboard { #event-dashboard } 

While entering information of the event, the bottom navigation bar allows the user to choose among:

1. Details
2. 数据输入
3. Analytics (when available)
4. 笔记

![](resources/images/capture-app-image141.jpg){ width=25%}

#### TEI Dashboard { #tei-dashboard } 

While in the TEI dashboard the bottom navigation bar allows the user to choose among:

1. Details
2. Analytics (when available)
3. 人际关系
4. 笔记

![](resources/images/capture-app-image142.jpg){ width=25%}

#### Event listing for event and tracker programs { #event-listing-for-event-and-tracker-programs } 

The bottom navigation bar also allows switching the visualization mode if the event program or the tracker program have been defined with coordinates. More information about the map view can be found on the specific section below.

  1. 列表视图
  2. Map view

![](resources/images/capture-app-image143.jpg){ width=25%}
![](resources/images/capture-app-image144.jpg){ width=25%}

### Data Entry Flow { #capture_app_common_features_Data_flow }

#### creating/editing an event (Improved 3.0) { #capture_app_common_features_newEdit_event }

When creating an event or an enrollment, there are a number of fields that are not data elements or attributes, for example, event date, org unit, coordinates, enrollment date, category combinations. 

Those elements are referred to as event/enrollment details and in previous versions they were displayed in different screens separated from the data elements or attributes. From 3.0,  the details are displayed inside the form, as the first opened section for completion. Once they are filled in, for example when the user reopens the event or enrollment form, the details section will be visible and easily available, but collapsed to leave more space for the data collection.

![](resources/images/capture-app-image284.png){ width=25%}
![](resources/images/capture-app-image285.png){ width=25%}
![](resources/images/capture-app-image286.png){ width=25%}

#### Complete/Re-open event { #capture_app_common_features_complete_reopen }

When adding an event to an event program or inside a tracker program the user should fill the information and scroll down to make the *save* icon appear at the bottom right corner.

![](resources/images/capture-app-image37.jpg){ width=25%}
![](resources/images/capture-app-image74.png){ width=25%}

After tapping on the 'save' button, if the form does not contain any errors, warnings or empty mandatory fields, the app will ask if the user wants to complete the form. Two options are given to the user:

1. 'Not now': The app saves the form and go back to the event listing screen (or TEI dashboard for tracker programs). The status of the event will remain open.
2. 'Complete': The app saves the form and go back to the event listing. The status of the event changes to completed.

![](resources/images/capture-app-image201.png){ width=25%}

> **Note**
>
> To verify if an event is completed look at the icon, it must be a green checked box.
>

> **Note**
>
> If the event is non-editable, the app will hide the 'save' button
>

To re-open an event, the app now displays a "Re-open form" button in the Details screen. This button will be available only if the user has the correct authority (‘Uncomplete events’) to reopen a completed event.

![](resources/images/capture-app-image202.png){ width=25%}

#### Schedule after completion (Improved 3.0) { #capture_app_programs_common_features_schedule_after_completion }

In 3.0, the schedule dialog after completion has been redisigned to facilitate the creation of the event.

![](resources/images/capture-app-image270.png){ width=25%}

#### Discard changes { #capture_app_programs_common_features_discard_changes }

Tapping the back arrow in an enrollment or event form now provide two options:

1. 'Discard changes',  which allows the user to restored the fields to their previous values or,
2. 'Review' to remain in the form and update the fields.

If the user is in a new enrollment or event, the options allow the user to:

1. 'Discard changes': The enrollment or event is not created or,
2. 'Keep editing': Allowing the user to finish the enrollment or event.

![](resources/images/capture-app-image203.png){ width=25%}

#### Field completion percentage { #capture_app_programs_common_features_field_percentage }

首次注册后打开的事件的右上角显示了每个事件中完成的数据百分比。

![](resources/images/capture-app-image80.png){ width=25%}

> **Note**
>
> The display of the percentage can be set up to be displayed or not using the [#capture_app_android_settings_webapp_appearance_program](Android Settings WebApp)

#### Sections Navigation { #capture_app_programs_common_features_sections_nav }

The sections can be collapsed for a simpler user experience.  Sections in enrollment forms are also supported and are aligned with the design of the event sections.

![](resources/images/capture-app-image115.png){ width=25%}
![](resources/images/capture-app-image116.png){ width=25%}

#### Error messages { #capture_app_programs_common_features_errors }

The app will list the name of the mandatory fields missing when the user tries to complete an event or enrollment. The sections containing the missing fields will be highlighted to help the user find the missing fields.

![](resources/images/capture-app-image117.png){ width=25%}

After tapping on the 'save' button, the app will display two options:

1. 'Not now': Allowing the user to save the form with an 'open' status or,
2. 'Review': The app will remain in the form for the user to fill the empty mandatory fields.

The errors and warnings are also shown as an indicator next to the section name including the number of errors for each section. A list of the fields with the errors/warnings when the user tries to save the form will be displayed.

![](resources/images/capture-app-image145.png){ width=25%}

After tapping on the 'save' button, the app will display two options:

**Warnings**

1. 'Not now': Allowing the user to save the form with an 'open' status or,
2. 'Complete': The form is saved and its status changes to 'complete'

**Errorrs**

1. 'Not now': Allowing the user to save the form with an 'open' status or,
2. 'Review': The app will remain in the form for the user to review the fields with errors

If there is a combinantion of errors, warnings and missing mandatory fields, the app will display the 'Not now' and 'Review' options only.


### Event Notes { #capture_app_programs_common_features_event_notes }

可以在单个事件程序和程序阶段事件中为事件添加注释。在数据输入表单的新选项卡中提供了注释。

![](resources/images/capture-app-image106.png){ width=25%}
![](resources/images/capture-app-image107.jpg){ width=25%}

### Maps { #capture_app_programs_common_features_maps }

#### Map Layers (Improved 3.0) { #map-layers-improved-30 } 

When displaying maps there are different layers that can be displayed by clicking on the specific button on the uppper right corner. The user can select one or more layers to be displayed. Both coordinate and polygons types will be displayed. The layers are depenandat on the type of program as explained below:

- 显示事件（对于未注册的节目）
- 卫星检视
- TEI坐标（在注册的程序中默认为）
- 入学坐标（仅适用于已注册的课程）
- 程序阶段坐标（仅适用于已注册的程序）
- 关系（仅针对注册程序）
- 热图（仅适用于已注册的程序）
- Tracked Entity Attributes (Coordinates Value Type - Only for programs with registration)
- Data Elements (Coordinates Value Type)

![](resources/images/capture-app-image125.png){ width=25%}
![](resources/images/capture-app-image136.png){ width=25%}

From 3.0 custom map layers are also supported by the Android App. These custom layers, configured in the [maintenance app](https://docs.dhis2.org/en/use/user-guides/dhis-core-version-240/configuring-the-system/metadata.html#manage_external_maplayer), will be downloaded and displayed as additional layers to the default ones.
![](resources/images/capture-app-image263.png){ width=25%}
![](resources/images/capture-app-image262.png){ width=25%}

#### Map Carousel { #capture_app_programs_common_features_map_carousel }

On the map view of the program, a carousel of cards is displayed, one for each enrolled TEI (Tracker programs) or Event (Event programs).

* 轮播上的TEI卡采用与TEI列表视图相同的设计。
* 水平滚动轮播时，地图会放大到所选坐标。如果坐标字段为空，则会显示一条消息。

![](resources/images/capture-app-image126.png){ width=25%} 
![](resources/images/capture-app-image133.png){ width=25%}

Each card displays Tracked Entity Attributes (for Tracker Programs) and Data Elements (for Event programs) configured as 'Display in list'.

![](resources/images/capture-app-image147.png){ width=25%}

#### Current Location displayed in maps { #current-location-displayed-in-maps } 

If the user has granted location permissions to the App, the map will show the current location represented as a blue color dot. The maps in the DHIS2 Android Capture App include the possibility to center the map on the user location.

![](resources/images/capture-app-image148.png){ width=25%}

#### Navigation to Specific Location { #navigation-to-specific-location } 

If the TEI or event has coordinates a navigation icon will be displayed at the top right of the card. Click to open the location in the default maps app configured in the device.

![](resources/images/capture-app-image149.png){ width=25%}
![](resources/images/capture-app-image150.png){ width=25%}
![](resources/images/capture-app-image151.jpg){ width=25%}

### Working Lists { #capture_app_programs_common_features_working_lists }

Working lists are available in Event and Tracker Programs, once a list is selected the filters will be blocked and not allowed to change until the user resets the search.

The Android App supports the new tracker working lists, allowing users to filter by data elements. The working lists need to be configured in web using the web Capture App. The Android app will download the working lists that are configured and saved on the server side.

In 2.9, the working lists have been moved from the filters section to the main program screen. In earlier versions the user had to open the filters to be able to see and select a working list, from this version the working lists are always visible under the search bar facilitating its selection for filtering out Tracked Entity Instances

![](resources/images/capture-app-image251.png){ width=25%}

### 计划指标 { #program-indicators } 

The analytics tab supports displaying text and key/value pair in feedback or indicator section.

![](resources/images/capture-app-image154.png){ width=25%}

### Legends { #legends } 

Legends can be assigned to Data Elements and they will be displayed next to value with the respective color and label.

![](resources/images/capture-app-image155.png){ width=25%}

### Data Entry Form { #capture_app_programs_common_features_data_entry_form }

#### Hint messages { #hint-messages } 

The input fields will display had a hint message saying "Insert value here" which will remain until a value is entered by the user.

![](resources/images/capture-app-image209.png){ width=25%}

#### Navigation button { #navigation-button } 

In forms with multiple sections, the App includes a "Next" button at the end of each section which calls the user to action. The funtion of the button is to close the current section and open the new one.

![](resources/images/capture-app-image210.png){ width=25%}

#### Program Stage section description { #capture_app_programs_common_features_data_entry_form_program_stage_description }

To provide more context and information at the moment of data collection the description has now been brought to the user interface and will be displayed below the section name. The description will always be visible but if the text is too long (more than 3 lines) the app will add an ellipsis and a show more/less button to expand or collapse.

![](resources/images/capture-app-image243.png){ width=25%}
![](resources/images/capture-app-image244.png){ width=25%}

#### Enable/disable collapsible sections in forms { #capture_app_programs_common_features_data_entry_form_collapsible_sections }

Stage sections in the Android App are displayed with collapsible menus that enable the user to open one section at a time. The purpose of this accordion-like implemementation is to help the user navigate very long forms, however some implementations would prefer to list the sections one after the other. 

This new version of the application enables the admin use to decide if the sections should appear in extended mode. This configuration is made through the [Android Settings Web App](https://docs.dhis2.org/en/use/android-app/settings-configuration.html#capture_app_android_settings_webapp_appearance_program_specific) and will display the sections one after the other with the name the secion acting as a separator. In extended mode, the "next" button at the end of each section is removed.

![](resources/images/capture-app-image241.png){ width=25%}

#### New inputs per value types { #capture_app_programs_common_features_data_entry_form_new_inputs }

The inputs for all value types have been redesigned. Tappable areas and texts have been increased and selection modes are improved to offer cleaner and more intuitive user experience. By default the Android App will display the current forms. Admin users are able to opt-in to use the new forms through the [Android Settings WebApp]().

![](resources/images/capture-app-image238.png){ width=25%}
![](resources/images/capture-app-image239.png){ width=25%}
![](resources/images/capture-app-image240.png){ width=25%}

### Actionable Icons  { #capture_app_programs_common_features_actionable_icons }

This feature enables users to take action on phone numbers and email addresses directly from the app.  When tapping on the icons, the app will dial a phone number or open an email app copying the address from the event or enrollment data entry form.

![](resources/images/capture-app-image230.png){ width=25%}

### Customized Tracker Terminology { #capture_app_programs_common_features_customized_terminology }

In order to facilitate the terminology used in DHIS2, it has been decided to gradually enable the possibility to customize certain terms to each particular use case. In 3.0, the terms "event" (used in a program stage context) and "enrollment" are customizable.

To customize the terms, the admin can go to the Maintenance and when creating or editing the program add a text to:

  1. "Custom label for enrollment" in the Enrollment details section OR
  2. "Custom label for event" in the stage details section

![](resources/images/capture-app-image253.png){ width=25%}
![](resources/images/capture-app-image254.png){ width=25%}
![](resources/images/capture-app-image256.png){ width=25%}
![](resources/images/capture-app-image255.png){ width=25%}


## Event Programs specific features { #capture_app_programs_events }

### Event - TEI relationships { #event-tei-relationships } 

The app allows adding relationships from single events (in event programs) to TEIs. There is a new tab in the event screen, named relationships, that will be displayed only when this type of relationships are configured in the server for the specific program.

> **Note**
>
> The current version does not allow TEIs to event relationships, or using events that belong to an enrollment.

![](resources/images/capture-app-image175.png){ width=25%}

### Cards design { #capture_app_programs_common_features_cards_design }

The new design of cards offers a cleaner and more intuitive layout replacing the use of coloured icons by explicit text when relevant.

#### Main changes { #main-changes } 

**Sync button:** It now appears as a button at the bottom of the card and it is only displayed if there are unsynced data or an error or warning after a sync.

**Event status:** After an event program is completed, the app will add a label in each card to specify the status.

![](resources/images/capture-app-image236.png){ width=25%}

## Tracker Programs (program with registration) specific features { #capture_app_programs_tracker }

### Relationships in maps { #capture_app_programs_map_relationships }

In tracker programs, the user can see relationships on a map by tapping the map icon on the relationships tab.

* 在关系的方向上显示了一个箭头。
* 对于双向关系，箭头指向两侧。
* 每种关系类型显示不同的颜色。
* 如果一个或两个TEI都具有一个多边形作为坐标，则线从（和到）两个TEI的多边形中的最近点。

![](resources/images/capture-app-image132.png){ width=50%}

### TEI Dashboard (Improved 3.0) { #capture_app_programs_TEI_Dashboard }

The TEI Dashboard has been redesigned for both portrait and landscape view. The new design offers a cleaner and more intuitive layout replacing the use of coloured icons by explicit text when relevant and moving some secondar actions to the hidden menus.

#### Dashboard card { #dashboard-card } 

Main changes in 2.9:

**Edit registration form:** In previous versions, there was a button "Open TET details" at the bottom of the TEI dashboard card. Now, the button is located at the top bar of the screen with the label "Edit TET" (For example: Edit Patient)

**Follow-up:** In previous versions, there was an icon at the top right corner of the card to mark the TEI. Now, to mark for follow up, the user needs to tap the three dot menu and select the "Mark for follow-up" option.

**Card title** In previous versions, the title included the values of the first 3 tracked entity attributes marked as Display in List. Now, the tile of the card can bdisplay the first Tracked Entity Attribute marked as Display in list OR a customize text, called TEI header, using program indicators and the Android Settings web App.

More information [here](https://docs.dhis2.org/en/use/android-app/program-features.html#capture_app_programs_tei_header) on how to configure the TEI header.

**Tracked Entity Attributes:** From 2.9, the complete list of tracked entity attributes marked as Display in List will be display in the dashboard card. The first three will always be visible and if there are more, a show "more" button will appear to expand the list.

**Programs:** From 2.9, if the TEI is enrolled to more than one program, a list of the programs will be display and will also allow the user to tap on the label and navigate to full list of enrollments.

![](resources/images/capture-app-image248.png){ width=50%}

#### Program stages { #capture_app_programs_TEI_Dashboard_program_stages }

Main changes in 3.0:

**Event list:** fresh and more clean look of the list of events, with more space and less -not critical- information displayed.

**Timeline view:** the button for creating new events has been moved to the top.

![](resources/images/capture-app-image248.png){ width=50%}

#### Navigation panel { #navigation-panel } 

To simplify and personalize the user experience, the user interface actions offered to the user at the TEI dashboard will be tailored to the specific configuration of each  program.

* Relationships tab will not be visible if the program relationships are not configured
* "Create event" button will be hidden when the user cannot create more events based on tracker configuration.
* The Indicator tab will not be visible if the program has no program indicators configured.
* Organisation Unit filter will not be visible if the user has only one Organisation Unit configured.

#### Creating A Stage { #creating-a-stage } 

To create a new event, the user needs to tap on the plus icon on the stage card. This icon is always visible unless the stage is non-repeatable and already created.

When the user taps on the button, that program stage will unfold showing to the user all the already existing events of that particular program stage

![](resources/images/capture-app-image211.png){ width=50%}

If the user is creating a new stage and there is only one option based on the program configuration, the available program stage is selected automatically and program stage selection step is skipped.

#### Share a TEI  { #share-a-tei } 

The "Share" button has been removed from the TEI dashboard and the functionality to share a TEI through QR code has been relocated on the three vertical dot menu, at the top right corner of the screen.

![](resources/images/capture-app-image212.png){ width=50%}

### TEI卡设计 { #capture_app_programs_tei_design }

The TEI Card has been designed to display as much information as possible considering the constrains of screen size.

From 2.9 the card has been redesigned to offer a cleaner and more intuitive layout replacing the use of coloured icons by explicit text when relevant.

The main changes are:

**Card title** The tile of the card can be composed by the first Tracked Entity Attribute marked as Display in list or a customize text, called TEI header, using program indicators and the Android Settings web App. More information [here](https://docs.dhis2.org/en/use/android-app/program-features.html#capture_app_programs_tei_header) on how to configure the TEI header.

**Sync button:** It now appears as a button at the bottom of the card and it is only displayed if there are unsynced data or an error or warning after a sync.

**Enrollment status:** After a program is completed or cancelled, the app will add a label in each card to specify the status.

**Overdue events:** Is now displayed as a red label with the text: "Overdue" + date of the event

**Follow-up:** After a TEI is marked for follow-up, an orange label with the text "Marked for follow-up" is added to the card

![](resources/images/capture-app-image247.png){ width=50%}

### 完成/停用注册 { #capture_app_programs_complete_deactivate_enrollment }

To complete or deactivate an enrollment, click on three dot menu in the uppper right corner and select "Complete" or "Deactivate".

![](resources/images/capture-app-image76.jpg){ width=25%}

### Search Flow (Improved 3.0) { #capture_app_programs_search }

#### Configurable TEI Search { #capture_app_programs_configurable_search }

Searching TEIs before creating is not mandatory now. Using the Android Settings App (v2.2.0) it is possible to configure the mandatoriness of the TEI search before creating an enrollment. Follow the steps below to enable the creation of TEIs without searching:

  1. Open the Appearance menu in the Android Settings App
  2. In 'Program' add a Program Setting
  3. Select a tracker program
  4. Tick the "Allow the user to create a TEI without searching" checkbox
  5. 保存

If the feature is enabled, the Android App will display a "create new" button after opening a program and a search won't be required. If the feature is not enabled or the user is in a previous version of the app, a search must be performed to avoid possible duplicates. Once the search is performed the search button will become "Add" button for the user to create a new enrollment.

![](resources/images/capture-app-image281.png){ width=25%}

#### Search by unique QR/bar Codes (new 3.0) { #capture_app_programs_unique_qrBar_search }

In 3.0, the search form has been improved to provide a cleaner look and a more intuitive user experience. The buttons have been made more explicit for differencing search from creation. In addition the flow for searching TEIs using attributes rendered as bar / QR codes has been made more agile. If there is only one result and the attribute is unique, the app will open the TEI Dashboard directly. If there are multiple results, the app will display all the cards on the TEI list (this is equal to the current workflow), and if there are no results, the app will display the create button and allow the user to “search outside the program” if the configuration allows it.

#### Offline and Online Search { #capture_app_programs_offline_online_search }

To improve the response time in the search results, the Android App now searches offline first and displays the results while making an online search as a second step, transparent to the user.

Searching outside the program is offered as a second step when  the attributes used in the search contain at least one Tracked Entity Type (TET) attribute

#### 重置搜索字段 { #capture_app_programs_reset_search }

The search fields are used to look up for a specific entity, and the circled arrow to reset the search. All fields will be blank for the user to do a new search.

![](resources/images/capture-app-image79.png){ width=25%}

#### 所有跟踪实体类型的搜索屏幕 { #capture_app_programs_search_screen }

User can search across all programs by specific tracked entity type (TET). In the Search screen there is a drop down which shows all the programs available for the active TET (active TET is defined by the selection of the program in the home screen). That drop down should also have an option with TET name, for example: *All Person*.

When the user selects that option, the search fields available will only be the TET attributes (no program specific attributes). Search restrictions do not apply, because they belong to the programs.

![](resources/images/capture-app-image44.png){ width=25%}
![](resources/images/capture-app-image22.png){ width=25%}

搜索将在本地数据库中以及用户的搜索OU中返回找到的TEI（在用户在线时）。对于那些在网上找到的用户，用户将不得不选择它们，然后将下载整个记录。

> **注意**
>
>配置搜索组织时。单位，请确保您的捕获组织。单位包含在您的搜索组织中。单位，以捕获组织。必须选择单位以及搜索单位。单位。


### 跨计划的TEI仪表板 { #capture_app_programs_tei_dashboard }

如果搜索没有程序，则用户可以通过在列表中选择TEI来查看没有任何程序的TEI仪表板。

仪表板将显示活动注册的列表。

![](resources/images/capture-app-image22.png){ width=25%}
![](resources/images/capture-app-image38.png){ width=25%}

### TEI的注册历史和新注册 { #capture_app_programs_tei_history }

User can see the complete historical records of the TEI. Clicking on the upper right corner menu, select "Program Enrollments". A list of "Active enrollments" will be displayed, followed by a list of "Past enrollments" (completed or cancelled), followed by the programs in which the TEI could be enrolled.  User can also return to the "TEI Dashboard" without any program' by selecting "All enrollments".

![](resources/images/capture-app-image40.jpg){ width=25%}
![](resources/images/capture-app-image7.png){ width=25%}

### Delete TEI's & Enrollments (Improved 3.0) { #capture_app_programs_delete_tei }

To delete a TEI or an enrollment, select the desired option in the three dots menu of TEI dashboard.  Local TEI or Enrollment will be deleted from the database. Records that has been previously synced with the server will be marked for deletion if the user has the following authorities:

* F_ENROLLMENT_CASCADE_DELETE
* F_TEI_CASCADE_DELETE

In this case they will be shown in the TEI search list, but will not be accessible.

![](resources/images/capture-app-image86.jpg){ width=25%}

From 3.0, there is a confirmation message to reduce errors when tapping on the dele button.

![](resources/images/capture-app-image269.png){ width=25%}

> **Warning**
>
> When users enter a TEI and while it is not synced to the server they will be able to delete the TEI and the enrollment even if they have not been asigned these authorities. This is by design and to allow users rolling back in case of having entered wrong data (TEI and/or enrollment) and thus preventing it reaching the server and requiring another user with higher privileges to fix the issue.

### TEI仪表板中程序阶段的组视图 { #capture_app_programs_group_view }

The TEI Dashboard offers the possibility to change the list of events from the chronological view to a stage grouping view. The stage grouping view will group and collapse the events per program stage. Each program stage group can be expanded by the user and the events will be displayed chronologically.

![](resources/images/capture-app-image108.png){ width=25%}
![](resources/images/capture-app-image109.jpg){ width=25%}

### 继承价值 { #capture_app_programs_inherit_values }

在为关系创建新的TEI时，继承Web中标记有“继承”检查的任何程序属性。

这意味着第一个TEI中的任何现有属性都应传递给新TEI，并显示在注册表格中。

### 打破玻璃 { #capture_app_programs_breaking_the_glass }

The "breaking the glass" feature is now supported in DHIS2 Android Capture App. If the program is configured with an access level of "Protected" and a search is done outside the user scope, a dialog requesting a reason for access will be displayed for the user to temporarily override the ownership privilege of the proram. This means, the user will gain access to the program related data.

After the reason is written, the app will download the TEI and the dashboard will open. If the TEI being downloaded doesn't have an enrollment in the current program, an enrollment date and organisation unit will be asked.

![](resources/images/capture-app-image205.png){ width=25%}
![](resources/images/capture-app-image206.png){ width=25%}

### Analytic charts { #analytic-charts } 

It is possible to display the evolution in data elements as charts, values or tables. These data elements must be a numeric value type and configured in a repeatable stage.

1. Single value: It will display the newest value in the program.

![](resources/images/capture-app-image156.png){ width=25%}

2. Charts: It is possible to display the values as a line chart o as a bar chart.

![](resources/images/capture-app-image157.png){ width=25%}

The Nutrition Growth charts are shown according to the WHO standards.  This option will render a background image and apply the axis (0 to 5 monthly)according to the WHO model.

 ![](resources/images/capture-app-image159.png){ width=25%}

3. Tables: It will display the data elements or indicators in the rows and the periods in the columns.

![](resources/images/capture-app-image160.png){ width=25%}

### Referrals { #capture_app_programs_referrals }

when a user makes a permanent referral of a TEI, the ownership will be updated accordingly on the server.

From 2.9, admin users can now enable or disable the referrals in the DHIS2 Android Capture App through the [Android Settings WebApp](https://docs.dhis2.org/en/use/android-app/settings-configuration.html#capture_app_android_settings_webapp_appearance_program).

When users add events (tapping on the + icon) in a tracker program, the DHIS2 Android Capture App offers three options: Add (for new events), Schedule (for planning future events) and Refer (for referrals or transfers). IF the referral option is not needed, then the admin user can remove the option from the menu to simplify the user experience. The removal can be general (for all the programs) or for specific programs.

![](resources/images/capture-app-image233.png){ width=50%}

### [EXPERIMENTAL] TEI Header  { #capture_app_programs_tei_header }

The TEI Header is a title that can be added to the TEI cards and dashboards in the app. The title helps identify a TEI by displaying a summary of key information. It is formed by a concatenation of Tracked Entity Atributes and fixed text. The title is configured through a Program Indicator in the maintenance app and its assigned to the tracker program in the Android settings webapp. This feature is experimentan and depending on feedback and adoption it will be refined and incorporated in the Web Capture app.

> **Attention**
>
>  In the Maintenace app, text expressions aren't valid. Even though the error is display in the dialog, save the program indicator and assign it in the Android Settings Web App, the DHIS2 Android capture app will read the expression accordingly.

For more information on how to configure the TEI header, click [here.](https://docs.dhis2.org/en/use/android-app/settings-configuration.html#capture_app_android_settings_webapp_appearance_program)

![](resources/images/capture-app-image249.png){ width=50%}
![](resources/images/capture-app-image250.png){ width=50%}

## 支持的功能概述 { #capture_app_programs_supported_features }

The following is a comprehensive list of all features available for Programs with and without registration in DHIS2, and notes on whether or not these have been implemented in the Android Capture app.

在注释中，“管理员”是指开发和配置DHIS2系统的人员，“用户”是指使用应用程序捕获数据，更新数据并查看报告的人员。

|传说|描述|
|:--:|:------|
|![](/en/resources/images/admin/icon-complete.png)|功能已实现|
|![](/en/resources/images/admin/icon-incomplete.png)|Feature not implemented (will be ignored)|
|![](/en/resources/images/admin/icon-na.png)|不适用|
|![](/en/resources/images/admin/icon-wip.png)|工作正在进行中。该功能尚未完全实现，或者已经报告了异常行为。|

### 程序 { #capture_app_programs_supported_features_program }

|特征|功能说明|注册程序|无需注册的程序|实施注意事项|
|-|---|:-:|:-:|---|
|选项集的数据输入方法|允许管理员选择如何在整个程序中在屏幕上显示选项（即，作为下拉列表还是单选按钮）|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-incomplete.png)|这将由新的渲染选项代替。|
|Combination of categories (Attribute CatCombo)|允许管理员将类别（选项集）附加到程序，要求用户对每个注册进行分类。 （在DHIS 2中，这称为属性类别组合。）|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据批准工作流程|If an admin selects a pre-configured Data Approval Workflow, this will be used to enforce an "approval" or "acceptance and approval" cascade, enabling users to sign-off and lock data.|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-incomplete.png)||
|显示首页列表|If this option is ticked, the landing page displays a list of active enrolments once an Org Unit and Program have been chosen. (Attributes shown are those ticked as "display in list".)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|第一阶段出现在注册页面上|选择此选项后，在程序注册期间，还将显示第一个程序阶段的屏幕（注册和第一个事件在一个屏幕上同时捕获）。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)| 在Android中，这是通过在注册完成后自动打开事件来实现的，而不是将表单添加到同一屏幕上。|
|已完成活动的有效期限|使管理员能够在事件完成后的几天内锁定数据输入。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|到期期限类型+到期天数|使管理员可以设置时间段（例如每周，每月），并在该时间段结束后一定天数内锁定数据输入。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|允许将来的注册日期|如果选中，则使用户能够在程序注册期间输入将来的注册日期；否则，用户只能使用今天或过去的日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|允许将来的事件日期|如果选中，则使用户能够在注册程序时输入将来的事件日期；否则，用户只能使用今天或过去的日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|仅注册一次（每个跟踪的实体实例生存期）|如果选中，则防止TEI（例如，人）多次注册此计划。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|显示事件日期|如果选中，则将向用户显示注册日期和事件日期，以进行数据捕获。否则，仅显示/捕获注册日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|事故日期说明|允许管理员自定义事件日期使用的标签。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|入学日期说明|允许管理员自定义用于注册日期的标签。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|捕获坐标（注册）|使用户能够在注册该程序期间捕获地理坐标。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|捕捉多边形（注册） |使用户可以在注册该程序期间捕获位置（封闭区域）。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|TEI坐标 |使用户能够在程序注册期间捕获TEI的地理坐标。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|关系：创建和更新|使用户能够创建和更新关系。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|关系-添加亲戚的快捷链接|这使管理员可以为仪表板添加一个特定关系的链接，从而使用户可以直接创建链接的TEI（例如“儿童”患者）。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-na.png)||
|属性：显示在列表中|此设置确定是否可以在列表（例如搜索结果）中查看属性，以及是否可以在仪表板“配置文件”下显示的属性短列表中看到该属性。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)|将显示前三个属性|
|属性：强制|This enables an admin to mark an Attribute as "mandatory";, meaning the enrolment can"t be saved until a value is captured.|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|属性：将来的日期|对于日期属性，这使管理员可以阻止或允许捕获将来的日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|注册表-默认|默认数据输入表单仅列出为TEI定义的所有属性。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|注册表-定制|这使管理员可以为注册表单定义自定义布局（使用HTML）。|--|![](/en/resources/images/admin/icon-na.png)|Android应用程序不支持自定义布局||
|计划通知|您可以设置自动通知，以通知何时进行程序注册或完成，或在事件或注册日期之前/之后的设定间隔。这些可以作为内部DHIS 2消息，电子邮件或SMS发送。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|接收到数据后，将在服务器端执行此功能。当应用程序离线工作时将无法使用。|
|激活/停用注册|停用TEI仪表板将导致TEI变为&ldquo;read-only&rdquo;。这意味着您无法输入数据，注册TEI或编辑TEI配置文件。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|仅当验证通过时才允许完成|选中此复选框可强制该程序创建的事件仅在通过所有验证规则后才完成。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-incomplete.png)||
|组织单位的开/关日期|使管理员能够设置组织单位的开始和结束日期，从而阻止用户在这些日期之外添加或编辑事件。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据共享级别/可以捕获数据|使用户可以在程序中添加新事件，编辑数据和删除事件。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据共享级别/可以查看数据|使用户能够查看程序中的事件列表。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据共享级别/无访问权限|用户将无法看到该程序|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||


### 程序阶段 { #capture_app_programs_supported_features_program_stage }

|特征|功能说明|注册程序|无需注册的程序|实施注意事项|
|-|---|:-:|:-:|---|
|活动表格-默认|默认数据输入表单仅列出了属于程序注册的所有属性|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|活动表格-部分表格|分区表单可让您将现有表单拆分为多个细分|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|活动形式-自定义|将自定义事件表单定义为HTML页面。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-incomplete.png)|Android应用程序不支持自定义布局。|
|程序阶段通知|您可以设置自动通知，以通知程序阶段何时完成，或在计划的事件日期之前/之后的设定间隔。这些可以作为内部DHIS 2消息，电子邮件或SMS消息发送。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)|接收到数据后，将在服务器端执行此功能。当应用程序离线工作时将无法使用。|
|可重复的|如果勾选了Repeatable，则可以在一个程序注册期间重复此阶段。如果t不是，那么该阶段只能在程序注册期间发生一次。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|可重复的|如果勾选了Repeatable，则可以在一个程序注册期间重复此阶段。如果t不是，那么该阶段只能在程序注册期间发生一次。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|可重复+标准间隔天数|系统将建议截止日期作为最后事件+标准间隔日期的计算。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|期间类型|使管理员可以在计划阶段为每个事件配置一组时间段（例如，几周或几个月），而不仅仅是日期。创建事件时，然后要求用户为他们在该程序阶段创建的每个新事件选择一个时间段（而不是日期）。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|自动产生事件|如果选中，则在注册后会根据“计划的开始日期”为该课程阶段生成一个“预订”。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|根据注册日期（不是事件日期）生成事件|选中它可以根据注册日期从该程序的程序阶段自动生成事件的到期日期。如果未选中，则基于事件日期生成截止日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|报名+报告日期后打开数据输入表格以使用|If selected, once an enrolment is complete, an event's data entry form should open directly afterwards.|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|要求用户在阶段完成时完成程序| 如果选择，则在完成程序阶段后，应要求用户完成程序。 （如果同时勾选了“要求用户创建新事件”，则忽略此设置。）|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|阶段结束时要求用户创建新事件|如果选择，则在完成程序阶段后，系统会提示用户预订。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|隐藏截止日期|仅显示事件的实际日期，隐藏截止日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|捕获坐标（事件）/功能类型点|Enables the user to capture geographical coordinates when each event is created ![](/en/resources/images/admin/icon-incomplete.png) particularly useful in devices that have GPS (eg Android), as instead of having to type in coordinates, the user can automatically populate them with the press of a button.|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|捕获多边形（事件）/要素类型-多边形 |创建每个事件时，使用户能够捕获位置（封闭区域）。多边形必须至少包含4个点。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|报告日期说明|Allows an admin to customize the label that is used for the event's date.|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|必填数据元素|这使管理员可以将数据元素标记为“必选”，这意味着直到捕获值后才能保存事件。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据元素-允许在其他地方提供|在表单上，这会在所选数据元素旁边放置一个复选框，并使以前的数据能够被拉入数据元素。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-na.png)||
|数据元素-显示在报告中|在没有注册数据输入功能的情况下，将该数据元素的值显示到单个事件中。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据元素-将来的日期|对于日期数据元素，这使管理员可以阻止或允许捕获将来的日期。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|数据元素-作为无线电的渲染选项|允许管理员选择每个数据元素在屏幕上的显示方式（即下拉列表或单选按钮）。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-incomplete.png)||
|填写完成后填写表格|禁止对事件完成后的所有编辑。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|活动评论|允许用户向事件添加整体注释。这些评论是累积性的（新评论会添加到现有评论下方）。|![](/en/resources/images/admin/icon-incomplete.png)|![](/en/resources/images/admin/icon-na.png)||

### 注册程序：跟踪实体仪表板 { #capture_app_programs_supported_features_program_with_reg }

|特征|功能说明|状态|实施注意事项|
|-|---|:-:|---|
|讯息传递|使用户能够通过SMS或电子邮件向TEI（例如患者）发送临时的自由文本消息。|![](/en/resources/images/admin/icon-incomplete.png)||
|标记为要跟进（带有感叹号三角形的按钮）|使用户可以将TEI（例如患者）标记为需要跟进。|![](/en/resources/images/admin/icon-complete.png)||
|显示TEI审核历史记录|使用户能够查看此TEI（例如患者）对属性的所有编辑的历史记录。|--||
|内联程序指示器|如果选中了程序指示符“在窗体中显示”框，则该指示符将显示在Tracker Capture仪表板上，并在发生数据捕捉时实时更新。|![](/en/resources/images/admin/icon-complete.png)||
|删除活动|使用户能够删除事件。|![](/en/resources/images/admin/icon-complete.png)||
|安排活动|在事件生成对话框中，用户还应该看到安排事件的选项。该过程类似于创建事件，但是在安排事件之后，用户将被发送回TEI仪表板。|![](/en/resources/images/admin/icon-complete.png)||
|转诊病人|在事件生成对话框中，用户还应该看到推荐病人的选项。该过程类似于创建/安排事件，但是用户可以更改组织单位，并且必须指定是一次性还是永久转介。一次只会在指定的OU中创建事件。|![](/en/resources/images/admin/icon-complete.png)||
|重置搜索字段|用户可以通过按搜索屏幕右上角的圆形箭头图标来清理搜索字段。|![](/en/resources/images/admin/icon-complete.png)||
|所有TE类型的搜索屏幕|用户能够搜索一种跟踪实体类型（TET）的所有程序。在“搜索”屏幕中，有一个下拉列表，显示了可用于活动TET的所有程序（活动TET由在主屏幕中选择的程序定义）。该下拉列表还应该带有一个带有TET名称的选项。 （我们服务器中的人员）。当用户选择该选项时，可用的搜索字段将仅是TET属性（没有程序特定的属性）。所有搜索限制均不适用，因为它们属于程序。|![](/en/resources/images/admin/icon-complete.png)||
|TEI仪表盘，无程序|如果搜索没有程序，则用户可以通过在列表中选择TEI来查看没有任何程序的TEI仪表板。仪表板将在详细信息卡中显示TET属性，然后是活动注册的列表。|![](/en/resources/images/admin/icon-complete.png)||
|TEI的注册历史和新注册|用户可以查看TEI的完整历史记录。通过单击右上角的图标，他们将看到有效注册的列表，然后是过去注册的列表（已完成或已取消），然后是可以注册TEI的程序。用户应该能够从列表导航到不同的注册。|![](/en/resources/images/admin/icon-complete.png)||
|访问级别-打破玻璃|如果该程序配置了受访问级别保护的用户，并且用户搜索并找到了该组织单元拥有的跟踪实体实例，而该组织单位对该用户没有数据捕获权限，则该用户可以选择打破常规。用户将找到打破玻璃的原因，然后获得被跟踪实体实例的临时所有权。|![](/en/resources/images/admin/icon-incomplete.png)||

### 无需注册的程序：单事件程序 { #capture_app_programs_supported_features_program_without_reg }

|特征|功能说明|状态|实施注意事项|
|-|---|:-:|---|
|活动列表（网格）|选定程序后将显示的现有事件列表。|![](/en/resources/images/admin/icon-complete.png)||
|在网格中排序和过滤事件|允许用户对列出的事件进行排序，或者根据关键字或日期/数字的特定范围过滤事件。|![](/en/resources/images/admin/icon-complete.png)|事件按时间顺序排序。用户可以按期间和组织单位进行过滤。|
|编辑网格中的事件|允许用户直接编辑事件列表/网格中显示的数据元素。|![](/en/resources/images/admin/icon-incomplete.png)||
|查看事件审核历史记录|Enables the user to see a history of all changes to the event's data elements.|![](/en/resources/images/admin/icon-incomplete.png)||
|显示/隐藏列（在事件列表/网格中）|使用户能够修改事件列表/网格中显示的数据元素（仅适用于该用户）。|![](/en/resources/images/admin/icon-incomplete.png)||
|现场完成率|首次注册后打开的事件的右上角显示了每个事件中完成的数据百分比。百分比应适合表格中程序规则的效果。|![](/en/resources/images/admin/icon-complete.png)|完成百分比未考虑表单中不受支持的值类型。|
|删除活动|使用户能够删除事件。|![](/en/resources/images/admin/icon-complete.png)||



# Android Capture App支持的程序规则 { #capture_app_pr }

The following is a comprehensive list of all Program Rule components (variable types and actions) available in DHIS2, and notes on whether or not these have been implemented in the DHIS2 Android App.

> **Note**
> 
> Any issues around using a particular feature with Android are highlighted with an exclamation mark !.

|传说|描述|
|:--:|:------|
|![](/en/resources/images/admin/icon-complete.png)|值类型已实现|
|![](/en/resources/images/admin/icon-incomplete.png)|值类型未实现，但会被安全忽略（如果不是强制性的） |
|![](/en/resources/images/admin/icon-na.png)|不适用|
|![](/en/resources/images/admin/icon-wip.png)|工作正在进行中。功能尚未完全实施或已报告意外行为 |

## 程序规则支持的变量源类型 { #capture_app_pr_prv }

| 变量类型| 变量类型说明| 注册程序| 无需注册的程序| 实施注意事项|
|-|-----|:-:|:-:|-----|
|Data Element from the newest event for a program stage|此源类型的工作方式与“当前程序中来自最新事件的数据元素”的工作方式相同，只不过它仅评估来自特定程序阶段的值。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|来自当前程序中最新事件的数据元素（已注册）|此源类型填充有为注册中的指定数据元素收集的最新数据值。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|Data Element from the newest event in the current program (without registration)|该程序规则变量将使用在同一组织单位中的10个最新事件中找到的最新数据值填充。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-complete.png)||
|Data Element in current event (with registration)|变量从当前事件中获取数据元素&rsquo;s的值。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|Data Element in current event (without registration)|包含来自用户当前打开的同一事件的数据值。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-complete.png)||
|Data Element from previous event (with registration)|具有这种源类型的程序规则变量将包含指定数据元素的所有先前事件的最新值。当前打开的事件未评估。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|Data Element from previous event (without registration)|该程序规则变量将填充当前事件日期之前的10个事件（即不包括当前事件）中找到的最新数据值。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-complete.png)||
|跟踪实体属性|使用当前TEI（例如当前患者）的指定跟踪实体属性填充程序规则变量。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|计算值|计算值。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||

## 程序规则支持的操作（当前事件中的数据元素） { #capture_app_pr_pra }

| 行动| 动作说明| 注册程序| 无需注册的程序| 实施注意事项|
|-|-----|:-:|:-:|-----|
|隐藏场|如果规则为true，则隐藏单个数据元素。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|！如果在隐藏字段后更改值，它将根据值类型规则引擎默认值还原操作。我们建议将其与hasvalue函数结合使用。|
|隐藏部分|如果规则为true，则隐藏整个节及其数据元素。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|隐藏选项|为给定数据元素/跟踪的实体属性中的选项集隐藏单个选项。当与<b>显示选项组</b>结合使用时，<b>隐藏选项</b>具有优先权|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|隐藏选项组|隐藏给定选项组和数据元素/跟踪的实体属性中的所有选项。当与<b>显示选项组</b>结合使用时，<b>隐藏选项</b>具有优先权 |![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|显示选项组|用于仅显示给定数据元素/跟踪的实体属性中给定选项组中的选项。要显示选项组，将隐式隐藏不属于所显示组的所有选项。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|赋值|如果规则为true，则将值分配给指定的数据元素或属性。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|要添加文本，必须使用单引号引起来。例如：“ 2 + 2”将显示文本2 + 2和2 + 2，不带单引号的文本将显示4。 |
|显示警告|如果规则为true，则向用户显示弹出警告；不会阻止用户继续。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|完成警告|如果在点&lsquo;complete&rsquo;处单击某个规则，则向用户显示弹出警告。这不会阻止用户继续。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|显示错误|在规则为真时立即向用户显示弹出错误消息，并阻止用户继续操作直到规则不再为真。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|该值不会保存，但不会清除文本，以便用户轻松修复它。|
|完成时出错|如果“完成”，则向用户显示弹出警告；单击表示规则为真，并阻止用户继续执行，直到规则不再为真。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|使字段强制|将数据元素设置为“强制”；如果规则为真。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|显示文字（事件程序）|用于显示不是错误或警告的信息，例如反馈。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)| 与源变量类型无关，文本将以形式显示为最后一节的最后一个元素。文本将显示为指示符选项卡中的消息。|
|显示文字（跟踪程序）|用于显示不是错误或警告的信息，例如反馈。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)| <b> 1.程序规则配置为“仅针对程序阶段的触发规则”。 </b>文本将仅以形式显示为最后一节的最后一个元素。文本将显示为指示符选项卡中的消息。 </br>->如果程序规则使用的不是当前阶段的任何变量类型，则该规则将无法评估，并且消息也不会显示。 </br> <b> 2.程序规则未配置为“仅针对程序阶段的触发规则”。 </b>文本将仅在“指示器”选项卡中显示，而不在表格中显示。 </br>->如果程序规则使用“当前事件”类型的任何变量，则该规则将无法评估，并且消息也不会显示。|
|显示键值/对（事件程序）|用于显示从数据元素中提取的信息。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|<b>Variable Type:</b> </br>* Data element from the newest event in the current program</br>* Data element from previous event</br>* Data element in current event</br>* Built-in variable</br>Key/Value Pair will be displayed in the form ONLY in the specified section.|
|显示键值/对（Traker程序）|用于显示从数据元素中提取的信息。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|<b>1. Variable Type:</b></br>* Data element in current event</br>Key/Value Pair will be displayed in the form ONLY in the specified section.</br><b>2. Variable Type:</b></br>* Data element from the newest event in the current program</br>* Data element from previous event</br>* Data element from the newest event for a program stage</br>* Tracked entity attribute</br>* Built-in variable</br>Key/Value Pair will be displayed ONLY in the indicators tab and NOT in the form.|
|隐藏程序阶段|如果规则为真，则向用户隐藏整个程序阶段。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|仅适用于<b>当前程序类型中最新事件和跟踪的实体</b>属性变量中的数据元素的操作规则。|
|发信息|发送消息会根据提供的消息模板触发通知。只要数据值发生更改，就会执行此操作。但是，可以通过在程序规则表达式中提供事件注册状态来控制此行为|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|此功能在服务器端执行。|
|排程讯息|Schedule Message将在Expression在数据字段中提供的日期安排通知。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|此功能在服务器端执行。|

## 程序规则支持的操作（其他变量） { #capture_app_pr_pra_other }

| 行动| 动作说明| 当前程序中最新事件的数据元素（已注册）|当前程序中最新事件的数据元素（无需注册）| 来自上一个事件的数据元素（已注册） |来自上一个事件的数据元素（未注册）| 程序阶段最新事件的数据元素（注册）|跟踪的实体属性（已注册） |实施注意事项|
|-|-----|:-:|:-:|:-:|:-:|:-:|:-:|-----|
|隐藏场|如果规则为true，则隐藏单个数据元素。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|隐藏部分|如果规则为true，则隐藏整个节及其数据元素。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|隐藏选项|为给定数据元素/跟踪的实体属性中的选项集隐藏单个选项。当与<b>显示选项组</b>组合使用时，<b>隐藏选项</b>具有优先权。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|隐藏选项组|隐藏给定选项组和数据元素/跟踪的实体属性中的所有选项。与显示选项组组合时，隐藏选项优先。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|赋值|如果规则为true，则将值分配给指定的数据元素或属性。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|要添加文本，必须使用单引号引起来。例如：“ 2 + 2”将显示文本2 + 2和2 + 2，不带单引号的文本将显示4。|
|显示警告|如果规则为true，则向用户显示弹出警告；不会阻止用户继续。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|完成警告|如果在单击“完成”时，规则为真，则向用户显示弹出警告。这不会阻止用户继续。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|显示错误|在规则为真时立即向用户显示弹出错误消息，并阻止用户继续操作直到规则不再为真。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|该规则将使用户完成注册，但会阻止完成事件，直到规则不再成立为止。该值不会保存，但不会清除文本，以便用户轻松修复它。|
|完成时出错|如果在单击“完成”时，规则为真，则向用户显示弹出警告。这不会阻止用户继续。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)||
|使字段强制|如果规则为true，则将数据元素设置为“强制性”。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)||
|显示文字（事件程序）|用于显示不是错误或警告的信息，例如反馈。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)| 与源变量类型无关，文本将以形式显示为最后一节的最后一个元素。文本将显示为指示符选项卡中的消息。|
|显示文字（跟踪程序）|用于显示不是错误或警告的信息，例如反馈。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)| <b> 1.程序规则配置为“仅针对程序阶段的触发规则”。 </b>文本将仅以形式显示为最后一节的最后一个元素。文本将显示为指示符选项卡中的消息。 </br>->如果程序规则使用的不是当前阶段的任何变量类型，则该规则将无法评估，并且消息也不会显示。 </br> <b> 2.程序规则未配置为“仅针对程序阶段的触发规则”。 </b>文本将仅在“指示器”选项卡中显示，而不在表格中显示。 </br>->如果程序规则使用“当前事件”类型的任何变量，则该规则将无法评估，并且消息也不会显示。|
|显示键值/对（事件程序）|用于显示从数据元素中提取的信息。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|<b>Variable Type:</b> </br>* Data element from the newest event in the current program</br>* Data element from previous event</br>* Data element in current event</br>* Built-in variable</br>Key/Value Pair will be displayed in the form ONLY in the specified section.|
|显示键值/对（Traker程序）|用于显示从数据元素中提取的信息。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-complete.png)|<b>1. Variable Type:</b></br>* Data element in current event</br>Key/Value Pair will be displayed in the form ONLY in the specified section.</br><b>2. Variable Type:</b></br>* Data element from the newest event in the current program</br>* Data element from previous event</br>* Data element from the newest event for a program stage</br>* Tracked entity attribute</br>* Built-in variable</br>Key/Value Pair will be displayed ONLY in the indicators tab and NOT in the form.|
|隐藏程序阶段|如果规则为真，则向用户隐藏整个程序阶段。|![](/en/resources/images/admin/icon-complete.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-complete.png)|仅对于当前程序变量</b>类型中最新事件中的数据元素<b>支持操作规则。如果事件是自动生成的，则该规则将不适用。|
|发信息|发送消息会根据提供的消息模板触发通知。只要数据值发生更改，就会执行此操作。但是，可以通过在程序规则表达式中提供事件注册状态来控制此行为|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|此功能在服务器端执行。|
|排程讯息|Schedule Message将在Expression在数据字段中提供的日期安排通知。|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|![](/en/resources/images/admin/icon-na.png)|此功能在服务器端执行。|

## 程序规则表达式中使用的函数 { #capture_app_pr_pre }

| 功能   | 功能说明 | 状态        | 实施注意事项 |
| ---- | ----------------------------- | :----: | -- |
| d2：ceil    | 将输入参数四舍五入到最接近的整数。   | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：楼层   | 将输入参数四舍五入到最接近的整数。 | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：圆   | 将输入参数四舍五入到最接近的整数。      | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：模数 | 将第一个参数除以第二个参数时产生模数。        | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：zing    | 如果值是负数，则将数字类型的参数评估为零，否则为值本身。   | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：oizp    | 如果值为零或正数，则将类型为number的参数评估为1，否则为零。        | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：串联      | 从输入参数生成字符串连接的字符串。支持任意数量的参数。      | ![](/en/resources/images/admin/icon-complete.png)    |请使用d2：concatenate函数，而不要使用“ +”，因为应用程序中的表达式评估器将添加数字。|
| d2：daysBetween      | Produces the number of days between the first and second argument. If the second argument date is before the first argument,  the return value will be the negative number of days between the two dates. The static date format is 'yyyy-MM-dd'.        | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：星期之间     | Produces the number of full weeks between the first and second argument. If the second argument date is before the first argument,  the return value will be the negative number of weeks between the two dates. The static date format is 'yyyy-MM-dd'. | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：monthsBetween    | 产生第一个参数和第二个参数之间的完整月份数。如果第二个参数日期在第一个参数之前，则返回值为两个日期之间的负月份数。静态日期格式为“ yyyy-MM-dd”。 | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：年之间     | 产生第一个参数和第二个参数之间的年数。如果第二个参数日期在第一个参数之前，则返回值为两个日期之间的负年数。静态日期格式为“ yyyy-MM-dd”。       | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：addDays | 根据第一个参数日期产生一个日期，加上第二个参数天数。    | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：计数   | 计算在参数中为源字段输入的值的数量。      | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：countIfValue     | 计算在第一个参数中为源字段输入的匹配值的数量。仅计算与第二个参数匹配的出现次数。 | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：countIfZeroPos   | 计算在参数中为源字段输入的零或正值的数量。源字段参数是程序中已定义源字段之一的名称。      | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：hasValue         | Evaluates to true of the argument source field contains a value, false if no value is entered.       | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：validatePattern  | 如果输入文本与提供的正则表达式模式完全匹配，则评估为true。正则表达式需要转义。       | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：左    | 从第一个字符开始算起num-chars，计算到文本的左侧。     | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：对   | 从最后一个字符开始计算num-chars，计算到文本的右侧。     | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：子字符串        | 求值到由开始和结束字符号指定的字符串部分。     | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：分割   | 用定界符分割文本，并保留第n个元素（第一个元素为0）。       | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：长度  | 查找字符串的长度。     | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：zpvc    | 返回给定对象参数中数字零和正值的数量。可以提供任意数量的参数。   | ![](/en/resources/images/admin/icon-complete.png)    | |
| d2：inOrgUnitGroup \ * | 评估当前组织单位是否在参数组中。可以使用ID或组织单位组代码定义自变量。 | ![](/en/resources/images/admin/icon-complete.png) | |
| d2:hasUserRole\** |如果当前用户具有此角色，则返回true，否则返回false。| ![](/en/resources/images/admin/icon-complete.png) | |
| d2:zScoreWFA\*** |函数根据WHO年龄加权指标提供的数据计算z得分。根据重量值，其值在-3.5至3.5之间变化。| ![](/en/resources/images/admin/icon-complete.png) | Providing an age less than 0 or greater than 60 will result in the program rule to not be calculated. Also, WFA tables have the age parameter increment in steps of 1, providing a fraction age will floor the value (2.3 months → 2 months).|
| d2:zScoreHFA\*** |Function calculates z-score based on data provided by WHO height-for-age indicator. Its value varies between -3.5 to 3.5 depending upon the value of weight.| ![](/en/resources/images/admin/icon-complete.png) |Providing an age less than 0 or greater than 60 will result in the program rule to not be calculated. Also, HFA tables have the age parameter increment in steps of 1, providing a fraction age will floor the value (2.3 months → 2 months). |
| d2:zScoreWFH\*** |Function calculates z-score based on data provided by WHO weight-for-height indicator. Its value varies between -3.5 to 3.5 depending upon the value of weight.| ![](/en/resources/images/admin/icon-complete.png) | Providing a height less than 45 or greater than 120 will result in the program rule to not be calculated. Also, WFH tables have the height parameter increment in steps of 0.5, providing a fraction height will floor the value (45.3 → 45 | 45.7 → 45.5).|

> **Note**
>
> * Available in DHIS2 v2.30
> ** Available in DHIS2 v2.31 and greater
> *** Available in DHIS2 v2.32 and greater

## 程序规则表达式中使用的标准变量 { #capture_app_pr_standard_vars }

在DHIS2 v2.30中可用

| 变量     | 功能说明       | 状态 | 实施注意事项 |
| --- | -------------------------------------------- | :---: | -- |
| V {current_date}       | 执行规则时包含当前日期。 | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {event_date}         | 包含当前事件执行的事件日期。规则作为注册表格的一部分执行时将没有值。 | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {event_status}         | 包含当前事件或注册的状态。 | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {due_date} \ *        | 执行规则时，此变量将包含当前日期。注意：这意味着该规则可能会在不同时间产生不同的结果，即使没有其他改变。     | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {event_count}        | 包含注册中的事件总数。   | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {enrollment_date} \ * | 包含当前注册的注册日期。对于单个事件程序将没有值。       | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {incident_date} \ *   | 包含当前注册的事件日期。对于单个事件程序将没有值。         | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {enrollment_id} \ *   | 当前注册的通用标识符字符串（UID）。对于单个事件程序将没有值。   | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {event_id}  | 当前事件上下文的通用标识符字符串（UID）。规则作为注册表格的一部分执行时将没有值。   | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {orgunit_code}       | 包含链接到当前注册的组织单位的代码。对于单个事件程序，将改用当前事件组织单元中的代码。  | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {environment}        | 包含代表规则的当前运行时环境的代码。可能的值为“ WebClient”，“ AndroidClient”和“ Server”。当程序规则仅应在一种或多种客户端类型中运行时可以使用。    | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {program_stage_id}   | 包含触发规则的当前程序阶段的ID。这可用于在特定程序阶段运行规则，或避免在某些阶段执行。在TEI注册表单中执行规则时，变量将为空。   | ![](/en/resources/images/admin/icon-complete.png)      | |
| V {program_stage_name} | 包含触发规则的当前程序阶段的名称。这可用于在特定程序阶段运行规则，或避免在某些阶段执行。在TEI注册表单中执行规则时，变量将为空。 | ![](/en/resources/images/admin/icon-complete.png)      | |

> **注意**
>
> \ *仅适用于跟踪器


## 网络版计划规则与Android版之间的区别 { #capture_app_pr_differences_web_android }

As the web and the Android application are currently using a different *program rule engine* there might be programs rule that work in one system and not in the other. In general terms it can be said that the Android *program rule engine* is more strict and so, some Program Rules that work in the web version of DHIS2 will fail in Android. This subsection describes the main differences and how to adapt the rules in order to have them working in both systems.

### 布尔类型的求值 { #capture_app_pr_differences_web_android_bool }


DHIS2 web version considers the type boolean as 0 or 1 (which can be evaluated to true or false), however Android evaluates them only as true or false. While this makes possible the addition of booleans in web, it will fail in Android; in order to fix this an additional *program rule variable* is needed to transform the boolean into an number that can be operated. Check the table below for examples and possible solutions.

对于以下示例，请考虑以下内容：

* yn_prv1：是一个程序规则变量，已配置为获取“是/否”数据元素的值
* yn_prv2：是程序规则变量，已配置为获取“是/否”数据元素的值
* prv_boolean_one：是一个程序规则变量，已配置为获取“是/否”数据元素的值
* prv_boolean_two：是一个程序规则变量，已配置为获取“是/否”数据元素的值
* prv_boolean_one_to_number：是具有计算值的程序规则变量
* prv_boolean_two_to_number：是具有计算值的程序规则变量
* 有时将true用作程序规则条件，表示始终执行该操作
* The following acronyms are used: 
    * DE (Data Elemetn)
    * PR (Program Rule)
    * PRE (Program Rule Expression)
    * PRC (Program Rule Condition)
    * PRV (Program Rule Variable)
    * PRA (Program Rule Action)

| 计划规则条件 | 计划规则动作 | 网络版 | Android版 | 评论 |
| ----------- | ----------- | :---: | :---: | ----- |
| d2：hasValue（'yn_prv1'）\|\| d2：hasValue（'yn_prv2'） | 为DE分配固定值 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | |
| ＃|\| ＃ | 为DE分配固定值 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | |
| d2：hasValue（'yn_prv1'）\|\| d2：hasValue（'yn_prv2'） | 将值分配给DE：＃{yn_prv1} +＃{yn_prv2} + 1 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-negative.png) | Crashes in Android  whenver a boolean is marked as the expression would result in *true*+*false*+1 |
| PR1: #{prv_boolean_one} <br /><br />PR2: #{prv_boolean_two} <br /><br />PR3: #{prv_boolean_one} \|\| ＃ | PRA1。将值“ 1”分配给PRV“＃{prv_bool_one_to_number}” <br /> <br /> PRA2。将值：“ 1”分配给PRV“＃{prv_bool_two_to_number}” <br /> <br /> PRA3。将值分配给DE：“＃{prv_bool_one_to_number} +＃{prv_bool_two_to_number} + 1”| ![](/en/resources/images/admin/icon-negative.png) | ![](/en/resources/images/admin/icon-negative.png) | 布尔值有2个变量，一个通过PRV定义“值形式DE”获取值，另一个通过PRA获得。如果未标记布尔值，则将其视为字符串而不是数字 |
| Four PR to assign 1 or 0 to the booleans and an additional for the addition. Priorities go from top to bottom <br /><br />PRC1: !d2:hasValue('prv_boolean_one')  \|\| !#{prv_boolean_one} <br /><br />PRC2: d2:hasValue('prv_boolean_one') && #{prv_boolean_one}<br /><br />PRC3: !d2:hasValue('prv_boolean_two')  \|\| !#{prv_boolean_two} <br /><br />PRC4: d2:hasValue('prv_boolean_two') && #{prv_boolean_two} <br /><br />PRC5: true | PRA1: Assign value: "0" to PRV "#{prv_bool_one_to_number}" <br /><br />PRA2: Assign value: "1" to PRV "#{prv_bool_one_to_number}" <br /><br />PRA3: Assign value: "0" to PRV "#{prv_bool_two_to_number}" <br /><br />PRA4: Assign value: "1" to PRV "#{prv_bool_two_to_number}" <br /><br />PRA5: Assign value: "#{prv_bool_one_to_number} + #{prv_bool_two_to_number} + 1" to DE <br /> | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | 布尔值有2个变量，一个通过PRV定义“值形式DE”获取值，另一个通过PRA获得。

### 数字评估 { #capture_app_pr_differences_web_android_numbers }


DHIS2 web version evaluate numbers in a more flexible way casting values from integer to floats and viceversa. This can lead to some issues as explained in the examples below.

#### Division of numbers { #division-of-numbers } 

If required for a division web will cast from integer to float, however, Android take numbers as such (literally and without casting) which my end up giving unexpected results. Check the table below for examples and possible solutions.

| 计划规则条件 | 计划规则动作 | 网络版 | Android版 | 评论 |
| ----------- | ----------- | :---: | :---: | ----- |
| 真正 | 将值分配给DE：d2：daysBetween（'2020-05-13'，'2020-05-17'）/ 3 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-negative.png) | 用户期望将除法计算为4/3，结果为1.3333。但是，Android不会将4强制转换为浮点数（与Web版本相同，为4.0），因此Android的结果是纯1，这是整数除法4/3的结果 |
| 真正 | 将值分配给DE：d2：daysBetween（'2020-05-13'，'2020-05-17'）/ 3.0 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | 网页和Android中的除法结果均为1.33333 | 


#### Using the function validatePattern { #using-the-function-validatepattern } 

In the same way, if a DataElement of the type number is used, Android will use that value as float (including decimals) which might lead to validatePattern function not working as expected.

Consider the following:

* temperatue_prv: is a Program Rule Variable containing the value of the Data Element *temperature*.
* User inputs 38 in the Data Element.

| 计划规则条件 | 计划规则动作 | 网络版 | Android版 | 评论 |
| ----------- | ----------- | :---: | :---: | ----- |
| !d2:validatePattern(#{temperature_prv},'\\\\{d}') | Display error if value is not 2 digits | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-negative.png) | The user would expect the program rule to NOT show an error as 38 does match the pattern. However, Android attempts to validate the pattern \\{d} against 38.0 resulting in Android displaying the error. |
| !d2:validatePattern(#{temperature_prv},'(\\\\d{2}\|\\\\d{2}\\\\.\\\\d\|\\\\d{2}\\\\.\\\\d{2})$') | Display error if value is not 2 digits | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | The regular expression used here will match both integeres and floats resulting in being properly evaluated in web and Android and not displaying an error. |

## Changes in Program Rules (as from version 2.2 of the app) { #capture_app_pr_changes }

In the version 2.2 of the application (released on August, 2020) a new rule-engine was included.  This rule-engine requires some optional and some mandatory changes to be performed on the program rules expressions in order to make it work in the new application. A list of those changes, how to detect them and how to fix them is included in the following subsections.

### 评估“ d2：hasValue” { #capture_app_pr_changes_hasvalue }

#### 描述 { #description } 

This is an optional change. *d2:hasValue* now works with both single quotes or full variable expression. The following expressions is valid: `(d2:hasValue('variable_name') and d2:hasValue(#{variable_name}))`

#### 如何通过API进行识别？ { #how-to-identify-via-api } 

获取条件或程序规则操作使用d2：hasValue函数的programRules。

```
https://example.org/api/programRules?fields=program[name],name,programRuleActions[data],condition&filter=programRuleActions.data:like:hasValue&filter=condition:like:hasValue&rootJunction=OR
```

```xml
<programRule name="PR01 - Check variable with hasValue(#{variable})">
<condition>d2:hasValue(#{Age in years})</condition>
<program name="JB_Testing_2.2"/>
<programRuleActions>
<programRuleAction/>
</programRuleActions>
</programRule>
<programRule name="PR01 - Check variable with hasValue('variable')">
<condition>d2:hasValue('Age in years')</condition>
<program name="JB_Testing_2.2"/>
<programRuleActions>
<programRuleAction/>
</programRuleActions>
</programRule>
```

#### 如何解决？ { #how-to-fix-it } 

上面的示例显示了使用hasValue函数的不同方式如何与2.2版产生相同的效果。没有强制性的更改，但是要记住，在编写新程序规则时，保持一致可能有助于避免问题。

### 变量评估 { #capture_app_pr_changes_eval_var }

#### 描述 { #description } 

This is a mandatory change. *!#{variable_name}* can only be used boolean type variables (BOOLEAN and TRUE_ONLY).

#### 如何通过API进行识别？ { #how-to-identify-via-api } 

获取类型为NOT BOOLEAN或TRUE_ONLY的dataElements的programRulesVariables

```
https://example.org/api/programRuleVariables?fields=name&filter=dataElement.valueType:!in:[TRUE_ONLY,BOOLEAN]&paging=False
```

获取所有programRule.conditions
```
https://example.org/api/programRules?fields=displayName,condition&paging=False
```

手动（或通过脚本以编程方式）检查是否在programRule.conditions列表（通过第二个API调用获得）中使用了任何程序规则变量（通过第一个API调用获得）。

例如，从第一个列表中，我们得到：

```xml
<programRuleVariable name="AdditionalMedication"/>
<programRuleVariable name="age"/>
<programRuleVariable name="Age in years"/>
<programRuleVariable name="AgeYears"/>
<programRuleVariable name="allergies"/>
<programRuleVariable name="apgarcomment"/>
```

我们可以与第二个列表进行比较：

```xml
<programRule>
<condition>!#{Pregant}</condition>
<displayName>PR03- !#{varible_name} - BOOLEAN</displayName>
</programRule>
<programRule>
<condition>!#{Age in years}</condition>
<displayName>PR03- !#{varible_name} - NOT BOOLEAN</displayName>
</programRule>
<programRule>
<condition>#{PregnancyStatus} != 'YES'</condition>
<displayName>Pregnancy status : false</displayName>
</programRule>
```

这表明NON BOOLEAN变量被错误地使用。

#### 如何解决？ { #how-to-fix-it } 

确保在您的条件下评估BOOLEAN或TRUE_ONLY变量。如果程序规则变量不是该类型，请使用d2：hasValue（＃{variable_name}）或d2：hasValue（'variable_name'）更新程序规则条件

在上面的示例中，条件应更改为：

```xml
<condition>!#{Age in years}</condition>
```
To:
```xml
<condition>d2:hasValue(‘Age in years’)</condition>
```

### 评估文字 { #capture_app_pr_changes_eval_text }

#### 描述 { #description } 

This is a mdantory change. In program rule actions of the type ASSIGN, DISPLAY TEXT, DISPLAY KEY/VALUE PAIR, SHOW WARNING, SHOW ERROR, WARNING ON COMPLETE or ERROR ON COMPLETE if the Expression to evaluate and assign/display is a text, it must be enclosed with single quotes.

#### 如何通过API进行识别？ { #how-to-identify-via-api } 

获取程序规则，这些操作的类型为文本，并且在字段数据上带有某些内容，并验证其数据内容以查找不带引号的字符串。

```
https://example.org/api/programRules?fields=program[name],name,programRuleActions[programRuleActionType,content,data]&filter=programRuleActions.programRuleActionType:in:[ASSIGN,DISPLAYTEXT,DISPLAYKEYVALUEPAIR,SHOWWARNING,SHOWERROR]&filter=programRuleActions.data:!null&paging=false
```

例如，我们可以在此处检测到第一个“程序规则操作”中没有引号的文本字段错误，而第二个正确。

```xml
<programRule name="PR04- !#{varible_name} - BOOLEAN - Assign text without quotes">
<program name="JB_Testing_2.2"/>
<programRuleActions>
<programRuleAction>
<programRuleActionType>SHOWWARNING</programRuleActionType>
<data>embarazada</data>
<content>PR04 text with quotes is: </content>
</programRuleAction>
</programRuleActions>
</programRule>
```

```xml
<programRule name="PR04- !#{varible_name} - BOOLEAN - Assign text with quotes">
<program name="JB_Testing_2.2"/>
<programRuleActions>
<programRuleAction>
<programRuleActionType>SHOWWARNING</programRuleActionType>
<data>'embarazada'</data>
<content>PR04 text with quotes is: </content>
</programRuleAction>
</programRuleActions>
</programRule>
```

#### 如何解决？ { #how-to-fix-it } 

扫描生成的列表（通过建议的API调用）以查找“程序规则操作”中未引用文本的数据组件，然后转到每个已标识的程序规则并进行更新。

### 字符串和对象的串联 { #capture_app_pr_changes_concat }

#### 描述 { #description } 

This is a mdantory change. In program rule actions of the type ASSIGN, DISPLAY TEXT, DISPLAY KEY/VALUE PAIR, SHOW WARNING, SHOW ERROR, WARNING ON COMPLETE or ERROR ON COMPLETE if the Expression to evaluate and assign/display is a text, it must be enclosed with single quotes (same as previous change); but, on top of that, if it requires to concatenate two strings or a combination of functions it is mandatory to use the *d2:concatenate* function.

#### 如何通过API进行识别？ { #how-to-identify-via-api } 

获取程序规则，这些操作是文本类型的，具有字段数据上的任何内容，并验证其数据内容以检查是否在两个或多个字符串（或其他对象）被合并的情况下使用了d2：concatenate函数

获取程序规则，其中哪些操作为文本类型，并验证其数据内容以查找不带引号的字符串。

```
http://localhost:8034/api/programRules?fields=program[name],name,programRuleActions[programRuleActionType,content,data]&filter=programRuleActions.programRuleActionType:in:[ASSIGN,DISPLAYTEXT,DISPLAYKEYVALUEPAIR,SHOWWARNING,SHOWERROR]&filter=programRuleActions.data:!null&paging=false
```

例如，我们可以在不使用d2：concatenate的情况下在一个动作中检测到两个字符串的错误。

```xml
<programRule name="PR08- Assign text and variable without concatenate">
<program name="JB_Testing_2.2"/>
<programRuleActions>
<programRuleAction>
<programRuleActionType>SHOWWARNING</programRuleActionType>
<data>'Age is 10 and modulus' 'another string'</data>
<content>PR05 text without concat is: </content>
</programRuleAction>
</programRuleActions>
</programRule>
```

#### 如何解决？ { #how-to-fix-it } 

扫描生成的列表（通过建议的API调用）以找到程序规则操作中要串联两个或更多对象的数据组件，并使用d2：concatenate函数对其进行更新。

在上面的示例中，数据应更改为：

```xml
<data>'Age is 10 and modulus' 'another string'</data>
```
To:
```xml
<data>d2:concatenate('Age is 10 and modulus','another string')</data>
```



# 计划指标 { #capture_app_program_ind }

The following is a comprehensive list of all Program indicator variables available in DHIS2, and notes on whether or not these have been implemented in the Android Capture app.

与Android使用特定功能有关的所有问题均以感叹号突出显示。

|传说|描述|
|:--:|:------|
|![](/en/resources/images/admin/icon-complete.png)|组件已实现|
|![](/en/resources/images/admin/icon-incomplete.png)|组件未实现（规则失败） |
|![](/en/resources/images/admin/icon-na.png)|不适用|
|![](/en/resources/images/admin/icon-wip.png)|工作正在进行中。该功能尚未完全实现，或者已经报告了异常行为。|

## 程序指示符表达式或过滤器中使用的常用功能 { #capture_app_program_ind_common_functions }

|功能|描述|状态|实施注意事项|
|-|-----|:-:|-----|
|如果|Evaluates the boolean expression and if true returns the true expression value, if false returns the false expression value. The arguments must follow the rules for any indicator expression.|![](/en/resources/images/admin/icon-complete.png)||
|一片空白|Returns true if the element value is missing (null), otherwise false.|![](/en/resources/images/admin/icon-complete.png)||
|isNotNull|Returns true if the element value is not missing (not null), otherwise false.|![](/en/resources/images/admin/icon-complete.png)||
|firstNonNull|RReturns the value of the first element that is not missing (not null). Can be provided any number of arguments. Any argument may also be a numeric or string literal, which will be returned if all the previous objects have missing values.|![](/en/resources/images/admin/icon-complete.png)||
|最伟大的|Returns the greatest (highest) value of the expressions given. Can be provided any number of arguments.|![](/en/resources/images/admin/icon-complete.png)||
|最小|Returns the least (lowest) value of the expressions given. Can be provided any number of arguments.|![](/en/resources/images/admin/icon-complete.png)||

## （d2）在程序指示符表达式或过滤器中使用的函数 { #capture_app_program_ind_d2_functions }

|功能|描述|状态|实施注意事项|
|-|-----|:-:|-----|
|addDays|根据第一个参数日期产生一个日期，加上第二个参数天数。|![](/en/resources/images/admin/icon-complete.png)||
|细胞|将输入参数四舍五入到最接近的整数。|![](/en/resources/images/admin/icon-complete.png)||
|健康）状况|Evaluates the boolean expression and if true returns the true expression value, if false returns the false expression value. The conditional expression must be quoted. The true-expr and false-expr arguments must follow the rules of any program indicator expression (including functions).|![](/en/resources/images/admin/icon-complete.png)||
|计数|Counts the number of data values that has been collected for the given program stage and data element in the course of the enrollment. The argument data element is supplied with the #{programStage.dataElement} syntax.|![](/en/resources/images/admin/icon-complete.png)||
|countIfCondition|Counts the number of data values that matches the given condition criteria for the given program stage and data element in the course of the enrollment. The argument data element is supplied with the #{programStage.dataElement} syntax. The condition is supplied as a expression in single quotes.|![](/en/resources/images/admin/icon-complete.png)||
|countIfValue|Counts the number of data values that matches the given literal value for the given program stage and data element in the course of the enrollment. The argument data element is supplied with the #{programStage.dataElement} syntax. The value can be a hard coded text or number.|![](/en/resources/images/admin/icon-complete.png)||
|countIfZeroPos|Counts the number of values that is zero or positive entered for the source field in the argument.|![](/en/resources/images/admin/icon-complete.png)||
|天之间|Produces the number of days between two data elements/attributes of type date.|![](/en/resources/images/admin/icon-complete.png)||
|地板|将输入参数四舍五入到最接近的整数。|![](/en/resources/images/admin/icon-complete.png)||
|hasUserRole|Returns true if current user has this role otherwise false.|![](/en/resources/images/admin/icon-complete.png)||
|hasValue|Returns true if the data element/attribute has a value.|![](/en/resources/images/admin/icon-complete.png)||
|inOrgUnitGroup|Evaluates whether the current organisation unit is in the argument group. The argument can be defined with either ID or organisation unit group code.|![](/en/resources/images/admin/icon-complete.png)||
|剩下|从第一个字符开始算起num-chars，计算到文本的左侧。|![](/en/resources/images/admin/icon-complete.png)||
|长度|查找字符串的长度。|![](/en/resources/images/admin/icon-complete.png)||
|分钟之间|Produces the number of minutes between two data elements/attributes of type “date and time”.|![](/en/resources/images/admin/icon-complete.png)||
|模数|将第一个参数除以第二个参数时产生模数。|![](/en/resources/images/admin/icon-complete.png)||
|月份之间|Produces the number of full months between the first and second argument.|![](/en/resources/images/admin/icon-complete.png)||
|奥兹普|Returns one if the expression is zero or positive, otherwise returns zero.|![](/en/resources/images/admin/icon-complete.png)||
|RelationshipCount|Produces the number of relationships of the given type that is connected to the enrollment or event. When no type is given, all types are counted.|![](/en/resources/images/admin/icon-incomplete.png)||
|对| 从最后一个字符开始计算num-chars，计算到文本的右侧。|![](/en/resources/images/admin/icon-complete.png)||
|回合| 将输入参数四舍五入到最接近的整数。|![](/en/resources/images/admin/icon-complete.png)||
|分裂|RSplit the text by delimiter, and keep the nth element(0 is the first).|![](/en/resources/images/admin/icon-complete.png)||
|子串|求值到由开始和结束字符号指定的字符串部分。|![](/en/resources/images/admin/icon-complete.png)||
|validatePatten|Evaluates to true if the input text is an exact match with the supplied regular expression pattern.|![](/en/resources/images/admin/icon-complete.png)||
|周之间|Produces the number of full weeks between two data elements/attributes of type date.|![](/en/resources/images/admin/icon-complete.png)||
|年份之间|Produces the number of years between the first and second argument.|![](/en/resources/images/admin/icon-complete.png)||
|zing|Returns zero if the expression is negative, otherwise returns the expression value.|![](/en/resources/images/admin/icon-complete.png)||
|聚氯乙烯|Returns the number of numeric zero and positive values among the given object arguments.|![](/en/resources/images/admin/icon-complete.png)||

## 程序指示符表达式或过滤器中使用的变量 { #capture_app_program_ind_variables }


| 变量类型| 变量类型说明|状态|实施注意事项|
|-|-----|:-:|-----|
|Event Date <br />event_date|事件发生的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Creation Date* <br />creation_date|在系统中创建事件或注册的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Due Date<br />due_date|事件到期的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Sync Date\*<br />sync_date|事件或注册最后一次与Android应用程序同步的日期。|![](/en/resources/images/admin/icon-incomplete.png)||
|Incident Date<br />incident_date|事件发生的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Enrollment Date (not visible on UI)<br />enrollment_date|跟踪的实体实例在程序中注册的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Enrollment Status<br />enrollment_status|可用于包括或排除某些状态的注册。|![](/en/resources/images/admin/icon-complete.png)||
|Current Date<br />current_date|当前日期。|![](/en/resources/images/admin/icon-complete.png)||
|完成日期|活动完成的日期。|![](/en/resources/images/admin/icon-complete.png)||
|Value Count<br />value_count|事件的表达式部分中非空值的数量。|![](/en/resources/images/admin/icon-complete.png)||
|Zero or positive value count<br />zero_pos_value_count|事件的表达式部分中的正数值。|![](/en/resources/images/admin/icon-complete.png)||
|Event Count<br />event_count|事件计数（与过滤器结合使用）。|![](/en/resources/images/admin/icon-complete.png)||
|Enrollment Count<br />enrollment_count|注册计数（与过滤器结合使用）。|![](/en/resources/images/admin/icon-complete.png)|Android应用程序中的指标是在一个TEI注册范围内计算的。永远价值1。|
|TEI Count<br />tei_count|跟踪的实体实例的计数（与过滤器结合使用）。|![](/en/resources/images/admin/icon-na.png)|Android应用程序中的指标是在一个TEI注册范围内计算的。永远价值1。|
|Program Stage Name<br />program_stage_name|可以在过滤器中使用，以仅将某些程序阶段包括在跟踪程序的过滤器中。|![](/en/resources/images/admin/icon-incomplete.png)||
|Program Stage ID<br />program_stage_id|可以在过滤器中使用，以仅将某些程序阶段包括在跟踪程序的过滤器中。|![](/en/resources/images/admin/icon-incomplete.png)||
|Reporting Period Start<br />reporting_period_start|可以在过滤器或表达式中使用，以将每个报告期中的任何日期与第一个日期进行比较。|![](/en/resources/images/admin/icon-na.png)|Android应用程序中的指标是在一个TEI注册范围内计算的。|
|Reporting Period End<br />reporting_period_end|可以在过滤器或表达式中使用，以将任何日期与每个报告期间的最后一个包含日期进行比较。|![](/en/resources/images/admin/icon-na.png)|Android应用程序中的指标是在一个TEI注册范围内计算的。|
|Organisation Unit Count<br />organisationunit_count|。|![](/en/resources/images/admin/icon-na.png)||

[Documentation Reference](https://docs.dhis2.org/master/en/user/html/configure_program_indicator.html%23program_indicator_functions_variables_operators&sa=D&ust=1557433016643000)



# 支持的值类型 { #capture_app_value_types }

以下是DHIS 2中可用的所有值类型的完整列表，并说明了这些值是否已在Android Capture应用中实现。

与Android一起使用特定功能时遇到的所有问题均以感叹号\！突出显示。

|传说|描述|
| :-: | :------ |
| ![](/en/resources/images/admin/icon-complete.png) | 值类型已实现 |
| ![](/en/resources/images/admin/icon-incomplete.png) | 值类型未实现，但会被安全忽略（如果不是强制性的） |
| ![](/en/resources/images/admin/icon-wip.png) | 工作正在进行中。功能尚未完全实施或已报告意外行为 |


| 值类型 | 值类型说明 | 注册程序 | 注册程序 | 无需注册的程序 | 数据集| 实施注意事项 |
| :--| :----|:-:|:-:|:-:|:-:|:--|
| | | **属性** | **数据元素** | **数据元素** | **数据元素** | |
| 时间 | 只有时间 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 约会时间 | 日期加时间 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 日期 | 仅日期 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | |
| 年龄 | 可以输入以年/月/日为单位的年龄或出生日期（两者都存储为出生日期） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 电话号码 | 有效的电话号码 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 电子邮件 | 有效格式的电子邮件地址 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 是/否 | 布尔值是/否（或无响应） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 仅是 | 是或否回应 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 数 | 任何有效数字，包括小数 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 整数 | 任意整数（整数，无小数） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 正整数 | 仅正整数（无零或负值） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 正整数或零整数 | 仅零个或正整数（无负值） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 负整数 | 仅负整数（无零或正值） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 百分比 | 0到100之间的任何十进制值 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 单位间隔 | 0到1之间的任何十进制值 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 文本 | 文字（文字长度不超过50,000个字符） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| Multi_Text (New in 3.0) | Option set for multiple choice | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-incomplete.png) | |
| 长文字 | 文字（长度不受限制） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 信件 | 一个字母 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 文件 | 启用各种格式的文件上传（需要配置适当的存储空间） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-incomplete.png) | |
| 组织单位 | 允许选择DHIS2组织单位作为所选值 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |  ![](/en/resources/images/admin/icon-incomplete.png)| |
| 跟踪助理 | 启用选择现有Tracker“被跟踪实体实例”（例如人）作为值 | ![](/en/resources/images/admin/icon-incomplete.png) | ![](/en/resources/images/admin/icon-incomplete.png) | ![](/en/resources/images/admin/icon-incomplete.png) | ![](/en/resources/images/admin/icon-incomplete.png) | |
| 用户名 | 允许选择有效的DHIS2用户名作为值 | ![](/en/resources/images/admin/icon-wip.png) | ![](/en/resources/images/admin/icon-wip.png) | ![](/en/resources/images/admin/icon-wip.png) |  ![](/en/resources/images/admin/icon-incomplete.png) | |
| 坐标 | 启用手动输入地理坐标（不启用自动捕获坐标） | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png)| |
| 网址 | 启用手动输入URL。 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) |![](/en/resources/images/admin/icon-complete.png) | |
| 图片 | 启用图像上传。 | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-complete.png) | ![](/en/resources/images/admin/icon-incomplete.png) | |




# Android Settings Web App { #capture_app_android_settings_webapp }
## Overview { #capture_app_android_settings_webapp_overview }

This section focuses on the [Android Settings Web App](https://apps.dhis2.org/app/a1bd6b5b-de8c-4998-8d34-56c18a139683) implementation.


The [Android Settings Web App](https://apps.dhis2.org/app/a1bd6b5b-de8c-4998-8d34-56c18a139683) allows admins to configure synchronization parameters for the DHIS2 Android App, encrypt the local database of the Android devices, customize the appearance of Programs, Data sets, and Home screen, and add TEI Analytics items. The configuration parameters defined within this web app will overwrite the settings of all Android devices using the DHIS2 Android Capture App.

Please note that in this version of the Web App (2.3), if the DHIS2 version is equal to or higher than 2.40, only users with "M_androidsettingsapp" or "ALL" authority can define those parameters in the configuration. Other users accessing the web app can see the value of the parameters but cannot edit them.

> **Warning**
>
> If the DHIS2 version is not above 2.40, only users with 'ALL' authority can define those parameters in the configuration.
> 


## General settings { #capture_app_android_settings_webapp_general }

Includes configurations such as the Matomo URL and project ID, the number of reserved values to download per TEI, and encrypt the device database.

![](resources/images/capture-app-general-settings.png)

### Matomo configuration { #capture_app_android_settings_webapp_general_matomo }

The DHIS2 Android App sends anonymize analytics that can be used to evaluate performance and/or detect problems at an early stage. [Matomo](https://matomo.org) is the tool used for this and running in a specific server not accessible to the general public. However, implementations can set up their own
 Matomo instance (or using the cloud version) in order to collect and analyse the statistics. 

Once you have your Matomo instance ready you should get the URLs and the project ID like shown in the picture below (left). The ID can be introduced directly but the URL needs to be followed with */matomo.php* and start with *https* or *http* as shown below (right).

![](resources/images/capture-app-matomo-instance.png){width=33%}
![](resources/images/capture-app-matomo-settings.png){width=33%}


### Mobile configuration { #capture_app_android_settings_webapp_generalmobile_configuration }
This section allows admin users to edit the SMS gateway ad result sender phone number.
This configuration can be found in the Android app.
- Click on Settings
- Click on SMS Settings

![](resources/images/capture-app-sms-settings.png){width=33%}

### Reserved values { #capture_app_android_settings_webapp_general_reserved_values }
This will specify the number of values per TEI attribute reserved to download in the devices. By default, the Android App reserves 100 Ids, but it is possible to add or reduce this number.

To find this configuration in the Android app:
- Click on Settings
- Click on Reserved Values
- To refill them click on *Manage Reserved Values*

![](resources/images/capture-app-reserved-values.png){width=33%}
![](resources/images/capture-app-reserved-values-refill.png){width=33%}

### Encrypt device database { #capture_app_android_settings_webapp_general_encrypt_database }
This will force all the devices to store the database encrypted increasing the security level against data theft attacks.

By default, the DHIS2 Android App database is not encrypted, but an admin can check the *Encrypt device database* to encrypt the metadata and data stored in every device. Encrypting the database will have an impact on the database volume and performance (degradation between 10-15%) of the Android app. Note that at the moment of selecting or unselecting this option, no data is lost (even if it hasn't been previously synchronized with the server)

> **Warning**
>
> This is a critical action and will affect the local database of all Android devices synchronizing with the server (it won't affect the server DHIS2 database).
>
> By default, the Android app database is not encrypted, but an admin can check the *Encrypt device database* to encrypt the metadata and data stored in every device. Encrypting the database will have an impact on the database volume and performance of the Android app. Note that at the moment of selecting or unselecting this option, no data is lost (even if it hasn't been previously synchronized with the server)

### Allow screenshots { #capture_app_android_settings_webapp_general_screenshots }
This section allows to configure the possibility to take screenshots or screen sharing using the Android Capture App (which is required to remote support with applications like Teamviewer, Teams, etc.). Please note that the default behavior is deactivated screenshots.

> **Warning**
>
> The DHIS2 Android App disables the possibility of taking screenshots (and capturing the screen from other apps) by default following security and privacy recommendations. Allowing screenshots might be useful for support and/or sharing purposes in same cases but make sure you understand the security and privacy implications of this setting before enabling it.
>


### Skip DHIS2 version validation (**New 2.4**) { #capture_app_android_settings_webapp_general_skip_version_validation }
When connecting to DHIS2 instances, the app typically verifies compatibility with supported versions. However, in some cases, connecting to unsupported instances may be necessary or useful. Please note that the default behavior is to enforce strict version validation. To skip the validation process for DHIS2 version compatibility, select the checkbox.

![](resources/images/capture-app-skip-version-validation.png)

> **Warning**
>
> This option is only applicable when using Android Capture app version 3.0 or later.
>


### Opt-in Features (**v2.3.1**) { #capture_app_android_settings_webapp_general_optin_features }
Opt-in features are additional functionalities or settings within the application that the user can choose to enable based on preferences. Unlike default settings, these features require an explicit consent or action ('opting in') to activate.
Opting in allows the user to customize the experience by adding extra capabilities to the app. Keep in mind that these features might come with specific considerations, so it is recommended to review any associated information before opting in.

To enable a feature:

- Click on *Opt-in Features*. 
- A list of available opt-in settings will appear.
- Click on the feature's checkbox to enable it.

**Data entry Form (**New 2.4**):** The inputs for all value types have been redesigned in the Android Capture App with an improved selection mode and increased tappable areas and texts to offer a cleaner and more intuitive user experience. By default, the Android Capture App will display the new forms. Admin users can opt out of using the new version of forms by clicking the checkbox option.

![](resources/images/capture-app-optin-features.png)

### Disable all settings { #capture_app_android_settings_webapp_general_disable_settings }
By clicking this button, the user will remove all Android configuration settings. No configuration will be applied to the Android App (if this is the case, the sync parameters applied are the ones defined in the Android Capture app).


## Synchronization { #capture_app_android_settings_webapp_synchronization }

It offers additional parameters to control metadata/data synchronization.


### Global { #capture_app_android_settings_webapp_synchronization_global }

Metadata sync
:   Admin users can choose how often the metadata will sync. e.g. Sync metadata every 24 hours.

Data sync
:   Admin users can choose how often the data will sync. e.g. Syncing data every 6 hours.

![](resources/images/capture-app-sync-global.png){width=50%}
![](resources/images/capture-app-sync-global-app.png){width=33%}


Use the new Tracker Importer
:   Admin users can choose which tracker importer endpoint will be used.

> **Warning**
>
> This option is only available if the Android Settings Webapp is used from version 2.38 DHIS2 API onwards.
>
> By default, if the DHIS2 API version is 2.38 or higher, the Android app will use the importer introduced in 2.37 */api/tracker* endpoint but an admin can deselect this option and the legacy tracker importer */api/trackedEntityInstances* will be used.
> 
> ![](resources/images/capture-app-sync-global-importer.png){width=50%}
>

Use the new Tracker Exporter (**v2.3**)
:   Admin users can choose which tracker exporter endpoint will be used.

> **Warning**
>
> This option is only available if the Android Settings Webapp is used from version 2.40 DHIS2 API onwards. 
> 
> By default, if the DHIS2 API version is 2.40 or higher, the Android app will use the exporter introduced in the 2.37 */api/tracker* endpoint, but an admin can deselect this option, and the legacy tracker importer */api/trackedEntityInstances* will be used.
>
>
> ![](resources/images/capture-app-sync-global-exporter.png){width=50%}
>

Limit the file size to download (**v2.3**)
:   Admin users can limit the maximum size of the file resources downloaded in KB.

![](resources/images/capture-app-sync-download-file-size.png){width=33%}



### Program { #capture_app_android_settings_webapp_synchronization_program }

This section controls the program data synchronization parameters. It has a section to define global or default parameters to be used in the synchronization of all programs.

#### Global settings { #capture_app_android_settings_webapp_synchronization_program_global }

Global settings apply to all programs that an Android user has access to. The settings can be enabled globally, per Org Unit, per program or per OU and program.

![](resources/images/capture-app-program-global-settings.png){width=50%}

TEI to download
:   Maximum number of TEIs to download from the server.

TEI download period
:   It downloads the TEIs that have been updated within a period. e.g. TEIs that have been updated within last month

Event to download
:   Maximum number of Events to download (from events programs, see note below).

Event download period
:   It downloads Events which event date belongs to a specific period.

> **Note**
>
> User might find misleading the amount of data downloaded When setting a number of TEIs and a number of Event. The Android App will download the number of TEIs and all their events following the number of TEI set in the field. The Android App will limit the number of Event to download only for the *event programs* (and not *tracker programs*) according to the field. 
>
> For example, imagine there is *tracker program* in the server with several program stages and each TEI has 5 events (enrollments and program stages). The *TEI to download* value is set to 100. Also, in the server there is an *event program* which contains 1000 events. The *Event to download* value has been set to 200. The Android App will download the following: 100 x 5 events from the tracker program, 200 events from the event program, therefore the Android App will end up downloading 700 events.
>


#### Specific settings { #capture_app_android_settings_webapp_synchronization_program_specific }

This section allows the admin users to specify the behaviour of a particular program/s when syncing the data. The specific configuration overwrites the general settings for the programs listed in this section. To add a setting for a specific program:

- Click on *Add a Program-specific setting*, a Dialog will appear. 
- Bellow "Values per Program" title, click and find a list of programs.
- Clicking on a program will show the different parameters to configure. The number of parameters depends on the program type (with or without registration). 

**无需注册的程序设置**

![](resources/images/capture-app-program-specific-dialog-without_registration.png){width=50%}

**注册程序的设置**

![](resources/images/capture-app-program-specific-dialog-with_registration.png){width=50%}

In the case that any specific settings has been saved, a table will show a summary with the specific configuration per program, and the options to edit or delete these settings.

![](resources/images/capture-app-program-specific-table.png){width=50%}

> **Caution**
>
> Using specific settings per program might have unexpected results in the number of TEIs downloaded and the total amount might exceed the one defined in the Global Settings. This is due to how the application download the TEIs from the server. The Android client will first download a max number of TEIs from the server based on the Organisation Units where the user has access and based on the lastUpdate field. Afterwards it will download a max number of TEIs from the specific programs. Therefore, if the TEIs downloaded from the Global setting (500 in the example above) have been updated more recently than any of the TEIs from a specific program (500 for Malaria case diagnosis, treatment and investigation) the Android client will end up downloading 1000 TEI.
> 
> This might look confusing at first, but once understood can be used to ensure a minimum (and maximum) number of TEIs for a specific program will be downloaded which can be very useful in specific implementations.
>
> Imagine an implementation where it must be ensured that the Android user has all the TEIs of a specific program in a server where the same user has access to other Organisation Units where other TEIs might be enrolled in another program. The program is called Community Care, and it has 17 TEIs which have been updated very long time ago. The administrator can ensure that the 17 TEIs will be downloaded by setting anything in Global Settings (if needed to reduce bandwidth a very low value should be set) and an at least 17 for the specific program as show in the image below:
>
> ![](resources/images/capture-app-program-specific-example-web.png){width=50%}
>
> When the initial synchronization is triggered the Android device will first download the last TEIs updated on the server (which according to our example do not belong to the specific program) and secondly up to 20 TEI from the specific program resulting in the following (notice all the TEIs for the program were downloaded):
>
> ![](resources/images/capture-app-program-specific-example-mobile1.png){width=33%}
>
> And by going to the settings it can be appreciated how the total number of TEIs is the expected 37, 20 from the Global Setting, and 17 from the program specific.
>
> ![](resources/images/capture-app-program-specific-example-mobile2.png){width=33%}
>

#### Reset all values { #capture_app_android_settings_webapp_synchronization_program_reset_all }

By clicking on *Reset all values*, the admin user will restore the default settings values of the program section. Please note that in this case it means no specific settings per program. 

To save any configuration, the admin user needs to click on the *Save* button (this button is disabled for the users who don't have "ALL" or "M_androidsettingsapp" authority)


### Data set { #capture_app_android_settings_webapp_synchronization_data }

This section controls the aggregated data synchronization parameters.

#### Global settings { #capture_app_android_settings_webapp_synchronization_data_global }

The first part is for global settings that apply to all data sets an Android user has access to. 

![](resources/images/capture-app-dataset-global-settings.png){width=50%}

The maximum number of periods defines the amount of past periods the app will download in the data synchronization process.

If a data set has future periods ("open future periods" configuration) the app won't take them into consideration in the restriction of the amounts of periods to download.

For example, in a data set with "open future periods" = 2 and a "maximum number of periods to download" = 1, the app will download 3 periods.

#### Specific Settings { #capture_app_android_settings_webapp_synchronization_data_specific }

要添加特定设置：

- Click on *Add a Data set specific setting*, a dialog with a list of data sets will appear. 
- Click on a data set, and this field will be autocompleted with the default value based on the dataset period type.

![](resources/images/capture-app-dataset-specific-dialog.png){width=50%}

![](resources/images/capture-app-dataset-specific-table.png){width=50%}


### User Sync Test { #capture_app_android_settings_webapp_synchronization_user_sync_test }

This section checks the amount of data and metadata a user would sync to his/her device. You can run this test on any user that you have access to. This test shows up the number of organisation units, data sets, program rules, programs, etc., that an android user has access to (so the resources that the android app will download), and the metadata and data download size (approx estimation). Please note that a user doesn't need to have the "ALL" or "M_androidsettingsapp" authority to run this test.

![](resources/images/capture-app-user-sync-test.png){width=50%}

> **Note:** 
>
> The values that are highlighted in red are because the value is considered greater than the maximum recommended value.


## Appearance { #capture_app_android_settings_webapp_appearance }

These settings give control over the appearance of the data entry and list forms.

- Filter: it defines the filters that can be enabled in the different app menus.
- Completion spinner: it turns on/off the completion spinner that shows the progress in the data entry form.

These settings refer to visual components, so they must be consumed by the app.
For more information about filters feel free to review filters [documentation](https://docs.dhis2.org/en/use/android-app/android-specific-features.html#capture_app_generic_filter). 

### Home screen { #capture_app_android_settings_webapp_appearance_home_screen }

It allows the admin user to enable or disable the option to show the filters related to Date, Organisation Unit, Sync Status, and Assigned to me on the Home screen.

![](resources/images/capture-app-appearance-home.png){width=75%}


### Program { #capture_app_android_settings_webapp_appearance_program }

Program appearance allows to hide/show features within the program according to the configuration needs. These changes can happen globally, applying to ALL the programs, or specifically to a single one.

#### Global settings { #capture_app_android_settings_webapp_appearance_program_global }

全局设置适用于android用户有权访问的所有程序。

![](resources/images/capture-app-appearance-program-global.png){width=75%}

Percentage (%) complete in Program: 
Enable or disable the option to show the completion percentage of the data entry form.

TEI referrals (**v2.3.1**): 
It allows to switch off/on the TEI referral option.

Collapse sections in form (**v2.3.1**):  
Current behavior lets the sections collapse and expand in an accordion style. This option overrides the behavior by keeping all the sections of the form (registration and events) open and removing the "next" button in each section. 


#### Specific settings { #capture_app_android_settings_webapp_appearance_program_specific }

This section allows the admin user to customize features such as filter, completion percentage, mandatory search, referrals, TEI headers, referral options and collapse sections in form. Each explained in the section below.

要添加特定设置：

- Click on *Add a Program Settings*, and a dialog will appear.
- Click on the dropdown that will show a list of programs.
- Clicking on a program will show the different filters to configure. The category combo filter depends on the category combo name.

![](resources/images/capture-app-appearance-program-specific.png){width=75%}

![](resources/images/capture-app-appearance-program-specific-advanced.png){width=75%}

TEI without searching:
Offer online and offline search, as well as allow the user to create a TEI without a prior search.

TEI Header (**v2.3.1**):
Assign a specific attribute or expression that will be displayed as a header in TEI cards. 

To add a TEI Header:

- Select a Program Indicator
- An expression related to the program indicator will be displayed

![](resources/images/capture-app-appearance-program-specific-tei-header.png)


> **Note:**
>
> A notice box will be displayed if the selected program lacks expressions related to program indicators that are valid for Android. 
> 
> An expression is considered valid for Android only if it is composed exclusively of attributes and/or functions.
> 
> ![](resources/images/capture-app-appearance-program-specific-expression-valid.png)
> 
> ![](resources/images/capture-app-appearance-program-specific-expression-invalid.png)
> 


If any specific settings have been saved, a table will summarize the particular configuration per program, and the options to edit or delete these settings. 

![](resources/images/capture-app-appearance-program-table.png)

The option "Show percentage (%) complete in Program toolbar" refers to: 
![](resources/images/capture-app-appearance-programs-spinner.png){width=50%}

**Search Tracked Entity (v2.2)**

Searching before entering a new TEI is mandatory to avoid possible duplicates, and the DHIS2 Android App has been designed as such. This new version gives the possibility to choose to keep this process or allow the user to create a TEI without searching first.
By default, allowing the user to create a TEI without searching is disabled.



### Data set { #capture_app_android_settings_webapp_appearance_data }

It allows admins to enable/disable filters for the Data set section

#### Global settings { #capture_app_android_settings_webapp_appearance_data_global }

第一部分是适用于android用户有权访问的所有数据集的全局设置。

![](resources/images/capture-app-appearance-dataset-global.png){width=75%}

#### Specific settings { #capture_app_android_settings_webapp_appearance_data_specific }

要添加特定设置：

- Click on *Add a Data set Settings*. A dialog box will pop up with a dropdown with a list of data sets.
- Click on a data set, and a list of options to enable or disable filters will be displayed.

![](resources/images/capture-app-appearance-dataset-specific.png){width=75%}

![](resources/images/capture-app-appearance-dataset-table.png){width=75%}


## Analytics { #capture_app_android_settings_webapp_analytics }

Analytics settings define TEI, Home, Program and Data Set analytics items (charts, tables) that will be displayed to the user. Any item defined in the settings app will overwrite the default behaviour of the android app, only showing the items defined in the settings app. 

Also, even though these analytics are created using the android settings web app, the data aggregation happens offline using only data stored in the device.

### TEI { #capture_app_android_settings_webapp_analytics_tei }

The scope of the analysis is the TEI, so the visualizations will be displayed in the TEI dashboard of the android app.

The purpose of this section is to define visualizations to show evolution of *data elements* and *program indicators* over time. Based on that, it will only take into consideration data elements that belongs to a repeatable program stage, or program indicators which formula contains at least one data element that belongs to a repeatable program stage.

To create a **TEI Analytics** item:

1. Click on *Add TEI Analytics*. A dialog box will pop up with a small form.
2. Choose a program and a repeatable program stage, and fill the form. The **Short name** is the only optional field.
3. If an item visualization other than WHO Nutrition has been chosen, the next fields to select are the period type (monthly, weekly, daily), an element type (Program Indicator, Data Element), and an element that will be based on the element type previously selected. Remember that these elements are related to the program and repeatable program stage chosen at the beginning.

![](resources/images/capture-app-analytics-item.png)

To create a **WHO Nutrition Analytics** item:

1. Select a program, a program stage, and WHO nutrition as visualization type.
2. Choose a WHO visualization type that can be Height for Age (HFA), Weight for Age (WFA) or Weight for Height (WFH).
3. Select the tracked entity attribute that represents the gender. You have then to specify the option for Male 'Male title' and the option for Female 'Female title'. Normally they will be option codes.
4. Choose the data element/program indicator that will be displayed in the Horizontal (x) axis
5. Choose the data element/program indicator that will be displayed in the Vertical (y) axis


![](resources/images/capture-app-analytics-who-item.png)

If any TEI Analytics item has been created, a table will show the item's title and program name, and action buttons to delete or edit that item.

![](resources/images/capture-app-analytics-table.png)

### Home { #capture_app_android_settings_webapp_analytics_home }

Home visualizations are displayed in the home screen (Analytics tab) of the android app.

All items available are first created in the Data visualizer or Line Listing app in DHIS2 and configured in the Android Settings app.

> **Note:**
>
> Visualization items can be sourced either from the **Data Visualizer** or the **Line Listing** app. 
> 
> When choosing a visualization type, the items shown automatically change; if "Data Visualization" is selected, only visualizations created in the Data Visualization app will be displayed. 
> 
> When selecting "Event Visualization" (**New 2.4**), only elements created in the Line Listing app will appear in the Visualization search box.
>

To create a **Home** item:

1. Click on "Add Home Visualization" Button.
2. Choose a "Visualization Type" (**New 2.4**)
3. Click on the search box and select the visualization from the list or type the name of the visualization item.
4. Add an alternative title, otherwise, the app will display the name of the visualization.
5. By default, the app will enable the group visualization setting.
   1. Create a new group: A free text box will pop up to type the name or
   2. Select a created group visualization: Choose an option from the list to add the visualization or
   3. Disable the group visualization by clicking on the checkbox.
6. Click on the "Save" button.

![](resources/images/capture-app-analytics-home-newGroup.png)

![](resources/images/capture-app-analytics-home-createdGroup.png)

> **Note:**
>
> Visualizations that are added with no group selected, will be displayed in a common "group"
>
> ![](resources/images/capture-app-analytics-default-group.png)
>

To edit the title of a **Home** item (**v2.2.1**):

1. Search for the item by expanding the groups.
2. Click the "Edit" button next to the item's name.
3. A pop-up with only the visualization title available will be available, the other fields will be disabled. If wanted change the visualization title.
4. Click on the "Save" button.

![](resources/images/capture-app-analytics-home-editVisualization.png)


To remove a **Home** item:

1. Search for the item by expanding the groups
2. Click the "Delete" button next to the item's name
3. Click on "Delete"
4. Click on the "Save" button

![](resources/images/capture-app-analytics-home-deleteVisualization.png)

To remove a **Home** group:

1. Search for the specific group to delete
2. Click on "Delete Group"
3. Click on "Delete"
4. Click on the "Save" button

All the items associated to that group will be deleted

![](resources/images/capture-app-analytics-home-deleteGroup.png)

To reset all values:

1. Click on "Reset all values to default"
2. Click on the "Save" button

### Program { #capture_app_android_settings_webapp_analytics_program }

Program visualizations are displayed in the search screen (Analytics tab) in tracker programs or in the list screen (Analytics tab) in event programs of the android app.

All items available are first created in the Data visualizer or Line Listing (**New 2.4**) app in DHIS2 and configured in the Android Settings app.

> **Note:**
>
> Visualization items can be sourced either from the **Data Visualizer** or the **Line Listing** app.
>
> When choosing a visualization type, the items shown automatically change; if "Data Visualization" is selected, only visualizations created in the Data Visualization app will be displayed.
>
> When selecting "Event Visualization" (**New 2.4**), only elements created in the Line Listing app will appear in the Visualization search box.
>
> ![](resources/images/capture-app-analytics-program-visualization-type.png)
> 

To create a **Program** item:

1. Click on "Add Program Visualization" Button.
2. Choose a Visualization Type (**New 2.4**).
3. Select a Program.
4. Click on the search box and select the visualization from the list or type the name of the visualization item.
5. Add an alternative title, otherwise, the app will display the name of the visualization
6. By default, the app will enable the group visualization setting.
   1. Create a new group: A free text box will pop up to type the name or
   2. Select a created group visualization: Choose an option from the list to add the visualization or
   3. Disable the group visualization by clicking on the checkbox.
7. Click on the "Save" button.

![](resources/images/capture-app-analytics-program-add.png)

To edit the title of a **Program** item (**v2.2.1**):

1. Search for the item by expanding the groups.
2. Click the "Edit" button next to the item's name.
3. A pop-up with only the visualization title available will be available, the other fields will be disabled. If wanted change the visualization title.
4. Click on the "Save" button.

![](resources/images/capture-app-analytics-program-editVisualization.png)

To remove a **program** item:

1. Search for the item by expanding the program and group
2. Click the "Delete" button next to the item's name
3. Click on "Delete"
4. Click on the "Save" button

![](resources/images/capture-app-analytics-program-deleteVisualization.png)

To remove a **program** group:

1. Search for the specific group to delete in the corresponding program
2. Click on "Delete Group"
3. Click on "Delete"
4. Click on the "Save" button

All the items associated to that group will be deleted

![](resources/images/capture-app-analytics-program-deleteGroup.png)

To reset all values:

1. Click on "Reset all values to default"
2. Click on the "Save" button

### Data Set { #capture_app_android_settings_webapp_analytics_data }

Data Set visualizations are displayed in the list screen (Analytics tab) in a Data Set of the android app.

All items available are first created in the Data visualizer app in DHIS2 and configured in the android settings app.

To create a **Data Set** item:

1. Click on "Add Data Set Visualization"
2. Select a Data Set
3. Click on the search box and select the visualization from the list or type the name of the visualization item.
4. Add an alternative title, otherwise, the app will display the name of the visualization
5. By default, the app will enable the group visualization setting.
   1. Create a new group: A free text box will pop up to type the name or
   2. Select a created group visualization: Choose an option from the list to add the visualization or
   3. Disable the group visualization by clicking on the checkbox.
6. Click on the "Save" button.

![](resources/images/capture-app-analytics-dataset-add.png)

To edit the title of a **Data set** item (**v2.2.1**):

1. Search for the item by expanding the groups.
2. Click the "Edit" button next to the item's name.
3. A pop-up with only the visualization title available will be available, the other fields will be disabled. If wanted change the visualization title.
4. Click on the "Save" button.

![](resources/images/capture-app-analytics-dataset-editVisualization.png)

To remove a **Data Set** item:

1. Search for the item by expanding the Data Set and group
2. Click the "Delete" button next to the item's name
3. Click on "Delete"
4. Click on the "Save" button

![](resources/images/capture-app-analytics-dataset-deleteVisualization.png)

To remove a **Data Set** group:

1. Search for the specific group to delete in the corresponding Data Set
2. Click on "Delete Group"
3. Click on "Delete"
4. Click on the "Save" button

All the items associated to that group will be deleted

![](resources/images/capture-app-analytics-dataset-deleteGroup.png)

To reset all values:

1. Click on "Reset all values to default"
2. Click on the "Save" button

### Visualization user test { #capture_app_android_settings_webapp_analytics_visualization_user_test }

The visualization user test is a feature available in Home, Program and Data Set Analytic setting that helps the admin user to identify if any particular user will be able to see the visualization.

The android settings app checks for at least one of these three permissions:

1. Visualization is public
2. User has individual access to the visualization
3. User is in a group that has access to the visualization

To run the test:

1. Select the user from the list
2. Click on "Run test"

![](resources/images/capture-app-analytics-usertest-access.png)

![](resources/images/capture-app-analytics-usertest-access-visualization.png)

![](resources/images/capture-app-analytics-usertest-noaccess.png)

![](resources/images/capture-app-analytics-usertest-noaccess-visualization.png)

### Analytics Limitations { #capture_app_android_settings_analytics_limitations }

Since the aggregations and calculations displayed are calculated in the device, the implementation of analytics is limited compared to web. 

In summary the compatible and supported objects and features for Data Visualizations are:

- Well-formed analytic objects (series, categories, filters)
- Use of relative periods (Fix periods are not supported)
- User has view access
- Limitations for Pivot Tables
  - Number of header lines: 1 or 2 (*v2.3*)
  - Number of header columns: 2
- Limitations for Charts
  - Number of Series: No limit (but remember you are rendering in a small screen)
  - Number of Categories (doesn't apply for pie chart): No limit

There are many more restrictions which apply to Android Analytics regarding the many configuration options available in the Web Visualizer as well as the supported functions and calculations related to indicators and program indicators. [This table](https://docs.google.com/spreadsheets/d/1127cz7M0K4fux5CU0V54V2Z77NZWCr0BTrZ6jcCec4Q) summarises all supported features.

In the same way, Event visualizations are considered valid if:

- Visualization was created using Line Listing app
- Visualization type is Line List
- Use of relative periods
- Limitations for Table
  - Number of columns: 15


> **Note (v2.2.1)**
>
> When searching for a visualization to add as part of the Analytics visualizations, all visualizations will be listed, but visualizations that don't meet the above restrictions will be disabled. 
>
> ![](resources/images/capture-app-analytics-visualization-search.png)
>


## Installation { #capture_app_android_settings_webapp_installation }

用户可以登录DHIS2并转到**应用程序管理**来轻松安装Android设置网络应用程序。

- Click on **App Hub**
- Go to *Android Settings App*
- Click on *Install V2.X.X*

![](resources/images/capture-app-app-hub-install.png)
![](resources/images/capture-app-app-hub-install-webapp.png)


## Log in and first time setup { #capture_app_android_settings_webapp_login }

After a user installs and launches the Android Settings Web App for the first time, the web app will require setting and saving the default values of the configuration. This will apply default settings to all android devices connected to the instance. 

![](resources/images/capture-app-first-time-setup.png){width=50%}

> **Warning**
>
> Be aware that previous versions are deprecated, so you will start with a new default configuration.

![](resources/images/capture-app-first-setup-with-deprecation-message.png){width=50%}

> **Warning (v2.3)** 
>
> When using DHIS2 version equal to or higher to 2.40, only users with "M_androidsettingsapp" or "ALL" authority can *save or update* the configuration, but any user will have *view* access once it is created.
> 


![](resources/images/capture-app-first-setup-no-authorities.png){width=50%}


## Enter and save configuration parameters { #capture_app_android_settings_webapp_enter_and_save }

### Datastore { #capture_app_android_settings_webapp_datastore }

Internally all settings are stored in [Datastore](https://docs.dhis2.org/en/develop/using-the-api/dhis-core-version-240/data-store.html) in JSON format.

数据存储结构：

| 项目      | 描述                                 | 数据类型 |
|-----------|---------------------------------------------|-----------|
| 命名空间 | 条目组织的命名空间       | 串    |
| 键       | 识别价值的钥匙            | 串    |
| 值     | 包含条目信息的值 | JSON格式      |

### Save configuration parameters { #capture_app_android_settings_webapp_save_config }

At the form footer of all settings sections, admin users can find a *Save* button.

![](resources/images/capture-app-save_button.png)

Only when an admin user clicks on this button, all changes made on the current section are saved on the Datastore. These changes will apply to the Android Capture App when they synchronize their configuration.

Unsaved changes
:   In case an admin user wants to go to another section when there are still some unsaved changes, an alert will be displayed before navigating away from the current section. In case the user accepts leaving the page, the unsaved changes will be lost.

![](resources/images/capture-app-unsaved-changes.png)

#### Reset all values to default { #capture_app_android_settings_webapp_reset_all }

An admin user can restore the settings at any time. There is a *Reset all values to default* button at the form footer of all settings sections. 

![](resources/images/capture-app-reset-default.png)

The default values will be only restored on Datastore and applied after clicking on *Save*. 


## Uninstall the app { #capture_app_android_settings_webapp_uninstall_app }

In case of needing to uninstall the Android Settings App it is recommended to also delete all the data from the reserved datastore namespace.

#### Delete data { #capture_app_android_settings_webapp_delete_data }

- Go to *General* section
- Click on *Disable all settings*
- A modal will pop up, click on *Disable*

![](resources/images/capture-app-unistall-delete-namespace.png)

![](resources/images/capture-app-unistall-delete-namespace-modal.png)

#### Uninstall app { #capture_app_android_settings_webapp_uninstall_app }

- Go to **App Management**
- Click on **Custom Apps**
- Go to *Android Settings App*
- Click on *Uninstall V2.X.X*

![](resources/images/capture-app-unistall-custom-app.png)

![](resources/images/capture-app-unistall-aswa.png)

> **Warning**
>
> This is a critical action, be aware that by doing this, all previous configurations will be permanently deleted.


# Use Case Configuration Web App { #capture_app_use_case_configuration_webapp }
## Overview { #capture_app_use_case_configuration_webapp_overview }

This section focuses on the [Use Case Configuration Web App](https://apps.dhis2.org/app/7df6f344-0487-469c-abe6-53c6e729abcf) implementation.


The [Use Case Configuration Web App](https://apps.dhis2.org/app/7df6f344-0487-469c-abe6-53c6e729abcf) will connect the components of use cases, like Pharmacy stock management (LMIS), such as the Tracker Program and Data elements, to the Android Capture App. This app ensures configuration flexibility and avoids hard coding various metadata in the actual mobile application.

Based on the configuration, any program of the DHIS2 server can be set as a stock management system or any other use case.

Please note that in this version of the Web App, only users with "ALL" authority are able to define the configuration. Other users will not have access to the web app or see the configuration.

> **Warning**
>
> Be aware that the app can only be used in instances using the 2.39.1 DHIS2 API version onward.
> 
> ![](resources/images/capture-app-use-case-configure-api-no-access.png)
>


## Installation { #capture_app_use_case_configuration_webapp_installation }

A user can easily install the Use Case Configuration Web App by logging into the DHIS2 and going to **App Management**.

- Click on **App Hub**
- Go to *Use Case Configuration App*
- Click on *Install V1.X.X*

![](resources/images/capture-app-use-case-configure-app-hub-install.png)
![](resources/images/capture-app-use-case-configure-app-hub-install-webapp.png)


## Log in and first time setup { #capture_app_use_case_configuration_webapp_login }

After a user installs and launches the Use Case Configuration Web App for the first time, the web app will require saving the default values of the configuration. This will allow android devices connect to the instance.


![](resources/images/capture-app-use-case-configure-first-setup.png){width=50%}

> **Warning**
>
> Only users with 'ALL' authority are able to *save or update* the configuration, users with no authority will not have view access to the app even if it is already created.
>


![](resources/images/capture-app-use-case-configure-no-authorities.png)


## Configure Program { #capture_app_use_case_configuraton_webapp_configure }

It allows admin users to configure programs to use the stock management system use case.

![](resources/images/capture-app-use-case-configure.png)


> **Note: (New 1.1)**
>
>    - Effective from version 1.1.0 of this web application, it is mandatory that Data Elements such as "Stock on Hand" and "Corrected Stock" possess a value type of "Positive or Zero Integer."
>    - To modify the value type of these Data Elements, users must use the Maintenance app.
>    - Following the adjustment of the value type, users are required to update or edit the program configuration via the Use Case Configuration web application. This ensures synchronization and coherence across the system.
>
> This ensures that these crucial data elements maintain consistency and accuracy within the system.
>


### Create configuration { #create-configuration } 

The DHIS2 Use Case Configuration App assigns the use case, like Real Time Stock Management, to any Tracker Program.
When the user opens the application in the Android Capture app the DHIS2 RTS is started instead of a conventional Tracker Program.

To create a **Program Configuration**:

1. Select a program type, a program, and add a description.
2. Click on *Next* button or *Details* tab.

![](resources/images/capture-app-use-case-configure-program-general.png)

3. Select the tracked entity attributes and data elements that represent Item code, Item Description and Stock on Hand. You have then to click on *Next* button or *Transactions* Tab.

![](resources/images/capture-app-use-case-configure-program-details.png)

4. Choose the data element/tracked entity attribute that will represent the Distributed Transaction.
5. Choose the data element/tracked entity attribute that will represent the Corrected Transaction.
6. Choose the data element/tracked entity attribute that will represent the Discarded Transaction.
7. Click on the "Done" button.

![](resources/images/capture-app-use-case-configure-program-transactions.png)


> **Note:**
>
> When all the valid programs are already configured, the Add Program button will be disabled.
>
> ![](resources/images/capture-app-use-case-configure-unavailable-program.png)
>
> The compatible and supported programs for a RTSM use case are:
> - Tracker program with one repeatable program stage.
> - Program rules to provide the real time stock on hand update.
> - Data elements and Tracker Entity Attributes assign to program and program stage.
>

The following is a comprehensive list of the main metadata configurations and settings for the Tracker
Program on which the customized DHIS2-RTS is based on.

| CATEGORY                 | SYSTEM DEFAULT SETTINGS                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 组织单位        | According to national protocols and policies and/or existing DHIS2 configuration                                                                                                                                                                                                                                                                                                                                                                                            |
| 数据元素             | Name: <br/>- "Deliver to": Text / Option set = "Deliver to" <br/>- "Previous stock balance": Positive integer <br/>- "Stock correction": Positive or Zero integer (**New 1.1**) <br/>- "Stock count": Positive integer <br/>- "Stock discard": Positive integer <br/>- "Stock distribution": Positive integer <br/>- "Stock on hand": Positive or Zero integer (**New 1.1**) <br/>- "Stock received": Positive integer <br/>Domain type: Tracker <br/>Value type: see above |
| Option set               | Name: "Deliver to" <br/>Value type: Text                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| 跟踪实体属性 | Name: <br/>- "Item barcode" <br/>- "Item code" <br/>- "Item description" <br/>"Value type": Text <br/>"Aggregation type": None                                                                                                                                                                                                                                                                                                                                              |
| 追踪实体类型      | Name: Item <br/>"Feature type": None                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 程序                  | Type: Tracker <br/>Tracked entity type: Item <br/>Program tracked entity attributes: <br/>- Item barcode <br/>- Item code <br/>- Item description <br/>Program stages: <br/>Name: "Stock on Hand" <br/>Scheduled days from start: 0 <br/>Repeatable                                                                                                                                                                                                                         |
| Program rule             | *Name*: "Assign Stock correction" <br/>Condition: "d2:hasValue( #{Stock count} )” <br/>Action: "Assign value"  <br/>*Name*: "Assign Stock on Hand" <br/>Condition: "true" <br/>Action: "Assign value"  <br/>*Name*: "Assign previous stock balance" <br/>Condition: "d2:hasValue( #{Initial stock on hand - Previous event} )" <br/>Action: "Assign value"                                                                                                                  |

More information related to DHIS2 for logistic in the [user guide](https://drive.google.com/file/d/1x6HoG75zMPCA823mdY87rb9hEJqxUz22/view).

### Edit configuration { #edit-configuration } 

To edit a **Program Configuration**:

1. Search for the program configuration to edit.
2. Click the "Edit" button next to the program's name.
3. A pop-up with only the description field in the General tab will be available, the other fields will be disabled. If wanted, change the visualization title.
4. All fields in Details and Transactions tabs will be available to edit if needed.
5. Click on the "Done" button.

![](resources/images/capture-app-use-case-configure-edit-general.png)

![](resources/images/capture-app-use-case-configure-edit-details.png)

> **Note: (New 1.1)**
>
> - While editing the configuration of a program containing Data Elements with a previously accepted value type, users will encounter a warning indicating the need for attention to these fields. These flagged fields will need reconfiguration by selecting new Data Elements.
> - The "Next" and "Done" buttons within the configuration interface will remain disabled until users have selected Data Elements that comply with the new valid value type. This precaution ensures that only compatible Data Elements are used. 
> 
> This process ensures seamless transition and adherence to updated system requirements, minimizing errors and ensuring data accuracy.
>
> ![](resources/images/capture-app-use-case-configure-program-stock-hand.png)
>

### Delete configuration { #delete-configuration } 

To remove a **Program Configuration**:

1. Search for the program configuration to delete.
2. Click on "Delete".
3. Click on the "Delete" button.

![](resources/images/capture-app-use-case-configure-delete-program.png)


## Enter and save configuration parameters { #capture_app_use_case_configuration_webapp_enter_and_save }

### Datastore { #capture_app_use_case_configuration_webapp_datastore }

Internally all program configurations are stored in [Datastore](https://docs.dhis2.org/en/develop/using-the-api/dhis-core-version-240/data-store.html) in JSON format.

数据存储结构：

| 项目      | 描述                                 | 数据类型 |
|-----------|---------------------------------------------|-----------|
| 命名空间 | 条目组织的命名空间       | 串    |
| 键       | 识别价值的钥匙            | 串    |
| 值     | 包含条目信息的值 | JSON格式      |


### Save configuration parameters { #capture_app_use_case_configuration_webapp_save_config }

At the footer of the configuration section, admin users can find a *Save* button.

![](resources/images/capture-app-use-case-configure-save-button.png)

Only when an admin user clicks on this button, all changes made are saved on the Datastore. These changes will apply to the Android Capture Apps when they synchronize their configuration.


## Uninstall the app { #uninstall-the-app } 

In case of needing to uninstall the Use Case Configuration App it is recommended to also delete all the data from the datastore namespace.

#### Delete data { #delete-data } 

- Click on *Erase all settings*
- A modal will pop up, click on *Erase*

![](resources/images/capture-app-use-case-configure-unistall-delete-namespace.png)

![](resources/images/capture-app-use-case-configure-unistall-delete-namespace-modal.png)

#### Uninstall app { #uninstall-app } 

- Go to **App Management**
- Click on **Custom Apps**
- Go to *Use Case Configuration*
- Click on *Uninstall V1.X.X*

![](resources/images/capture-app-use-case-configure-unistall-custom-app.png)

![](resources/images/capture-app-use-case-configure-unistall-use-case.png)

> **Warning**
>
> This is a critical action, be aware that by doing this, all previous configurations will be permanently deleted.   



# APK Distribution Web App { #capture_app_apk_distribution_webapp }
## Overview { #capture_app_apk_distribution_webapp_overview }

This section focuses on the [APK Distribution Web App](https://apps.dhis2.org/app/dff273fc-909e-48af-b151-c4d7e9c8a12c) implementation.

The [APK Distribution Web App](https://apps.dhis2.org/app/dff273fc-909e-48af-b151-c4d7e9c8a12c) enables implementation administrators to manage and control the version of the Android app, making it easier to manage app updates and ensure compatibility with the DHIS2 system. 

Admins will be able to upload the desired version and users will get a prompt message to update when they are not in the last updated version.

Please note that in this version of the Web App, only users with "ALL" authority are able to define the Android app versions. Other users having access to the web app can see the version history list and download the latest version, but cannot edit them.

## Installation { #capture_app_apk_distribution_webapp_installation }

A user can easily install the Use Case Configuration Web App by logging into the DHIS2 and going to **App Management**.

- Click on **App Hub**
- Go to *APK Distribution App*
- Click on *Install V1.X.X*

![](resources/images/capture-app-apk-distribution-app-hub-install.png)
![](resources/images/capture-app-apk-distribution-app-hub-install-webapp.png)


## Log in and first time setup { #capture_app_apk_distribution_webapp_webapp_login }

After a user installs and launches the APK Distribution Web App for the first time, the web app will require saving the default values of the configuration. This will allow android devices connect to the instance.


![](resources/images/capture-app-apk-distribution-first-setup.png){width=50%}

> **Warning**
>
> Only users with 'ALL' authority are able to *upload or delete* APK versions, but any user will have view access once it's created.
>


![](resources/images/capture-app-apk-distribution-no-authorities.png){width=50%}

## APK Versions { #capture_app_apk_distribution_webapp_versions }

The APK Distribution Web App allows the admin users to update or remove versions of the Android app.

![](resources/images/capture-app-apk-distribution.png)

### Upload version { #upload-version } 

Follow the steps below to upload an **Android app version**:

1. Click on *Upload new version* button.
2. Assign a version number.
3. Choose the minimum and/or recommend Android OS version.
4. Add a URL that contains the APK of the Android app.
5. Optionally, select one or more "user groups" to grant them access. (**New 1.1**)
6. Click on the "Create app version" button.


![](resources/images/capture-app-apk-distribution-upload.png)


> **Note:**
>
> App versions must follow semantic versioning. Read more about [semantic versions](https://docs.npmjs.com/about-semantic-versioning). 
>
> When uploading a new apk, make sure that the app version is higher than the current/latest version.
> 
> ![](resources/images/capture-app-apk-distribution-alert-version-higher.png)
> 
> To choose the minimum or recommended Android OS version for the app version, it is suggested to review the [Mobile Device Specification documentation](https://docs.dhis2.org/en/implement/android-implementation/mobile-device-specifications.html).
>


### Grant access to User Groups (**New 1.1**) { #grant-access-to-user-groups-new-11 } 

To give access to one or more User Groups:

1. Click on "Access".
2. A pop-up will appear with a search field.
3. Search a User Group.
4. Click on "Give access" button.
5. Click on "Close".

![](resources/images/capture-app-apk-distribution-version-list.png)

![](resources/images/capture-app-apk-distribution-grant-access.png)


> **Note:**
>
> The APK Distribution web application empowers administrators to allocate access to user groups for specific "Android App" versions.
> - User groups can be assigned to multiple "Android app" versions, yet individual users within those groups will only have access to the latest version allocated to their group. 
> - It's feasible to refrain from assigning a user group to an "Android app" version. In such cases, all users within that instance will automatically gain access to that version. 
> - In instances where no user group is assigned to any "Android app" version, the latest version will be designated as the *Default*. Consequently, only the latest version will be accessible to all users within the instance.
>
>

### Remove access to User Groups (**New 1.1**) { #remove-access-to-user-groups-new-11 } 

To give access to one or more User Groups:

1. Click on "Access".
2. A pop-up will appear with a search field and a list of User groups that currently have access.
3. Find the User group whose access will be removed.
4. Click on "Remove access" button.
5. Click on "Close".

![](resources/images/capture-app-apk-distribution-remove-access.png)

### Delete version { #delete-version } 

To remove an **Android App version**:

1. Search for the Android app version to delete.
2. Click on "Delete".
3. Click on the "Delete" button.

![](resources/images/capture-app-apk-distribution-upload-delete.png)


### Using mobile device { #using-mobile-device } 

This Web App can also be manipulated from a mobile device. To use it, open DHIS2 in the browser from a mobile or tablet device.

The mobile version allows the administrator user to **upload** and **download** app versions.

![](resources/images/capture-app-apk-distribution-upload-mobile.png)


When downloading a version, the APK will be stored in the device.

![](resources/images/capture-app-apk-distribution-version-list-mobile.png)


## Uninstall the app { #uninstall-the-app } 

In case of needing to uninstall the APK Distribution App it is recommended to also delete all the data from the datastore namespace.

#### Delete data { #delete-data } 

- Click on *Erase settings*
- A modal will pop up, click on *Erase*

![](resources/images/capture-app-apk-distribution-unistall-delete-namespace.png)

![](resources/images/capture-app-apk-distribution-unistall-delete-namespace-modal.png)

#### Uninstall app { #uninstall-app } 

- Go to **App Management**
- Click on **Custom Apps**
- Go to *APK Distribution*
- Click on *Uninstall V1.X.X*

![](resources/images/capture-app-apk-distribution-unistall-custom-app.png)

![](resources/images/capture-app-apk-distribution-unistall-apk.png)

> **Warning**
>
> This is a critical action, be aware that by doing this, all previous configurations will be permanently deleted.   
